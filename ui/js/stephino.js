/**
 * JS Tools
 * 
 * @title      Tools
 * @desc       Common RPG tools
 * @copyright  (c) 2021, Stephino
 * @author     Mark Jivko <stephino.team@gmail.com>
 * @package    stephino-rpg
 * @license    GPL v3+, https://gnu.org/licenses/gpl-3.0.txt
 */
/* global stephino_rpg_data, URL, Hammer, parseFloat, firebase, self, top, define, Node, define, global, this */
// Stephino RPG Tools
var stephino_rpg_tools = { ajax: function(methodName, data, callback, showPopup) { if ("undefined" === typeof showPopup) { showPopup = true; } else { showPopup = !!showPopup; } jQuery.ajax({ method: 'POST', url: stephino_rpg_data.ajax_url, data: { 'data' : stephino_rpg_tools.utils.base64.encode(JSON.stringify(data)), 'method' : methodName }, dataType: 'JSON', timeout: 9000, cache: false, success: function (msg) { "function" === typeof callback && callback(msg); if (!(methodName + "").match(/^admin/ig) && "object" === typeof msg && null !== msg && "object" === typeof msg.result && null !== msg.result) { if ("object" === typeof msg.result.settings && null !== msg.result.settings) { stephino_rpg_tools.settings.ui(msg.result.settings); } if (null !== msg.result.entities) { stephino_rpg_tools.entities.ui(msg.result.entities); } if ((methodName + "").match(/^cells/ig)) { if ("object" === typeof msg.result.navigation && null !== msg.result.navigation) { stephino_rpg_tools.navigation.ui(msg.result.navigation); } } if ("object" === typeof msg.result.resources && null !== msg.result.resources) { stephino_rpg_tools.resources.ui(msg.result.resources); } if ("object" === typeof msg.result.messages && null !== msg.result.messages) { stephino_rpg_tools.messages.ui(msg.result.messages); } if ("number" === typeof msg.result.convoys) { stephino_rpg_tools.convoys.ui(msg.result.convoys); } if ("number" === typeof msg.result.premium) { stephino_rpg_tools.premium.ui(msg.result.premium); } if ("number" === typeof msg.result.queues) { stephino_rpg_tools.queues.ui(msg.result.queues); } if ((methodName + "").match(/^(?:cells|actionTutorial)/ig)) { if ("object" === typeof msg.result.tutorial && null !== msg.result.tutorial) { if ("boolean" !== typeof msg.result.language || !msg.result.language) { stephino_rpg_tools.tutorial.ui(msg.result.tutorial, methodName.match(/^cells/ig) ? 500 : 50); } } } if ("object" === typeof msg.result.building_upgs && jQuery.isArray(msg.result.building_upgs)) { jQuery.each(jQuery('[data-role="map-holder"] [cell-type="buildings"]'), function() { var buildingConfigId = parseInt(jQuery(this).attr('cell-config-id'), 10); jQuery(this).attr('data-upg', -1 !== msg.result.building_upgs.indexOf(buildingConfigId) ? 'true' : 'false'); }); } if ("object" === typeof msg.result.building_unlk && jQuery.isArray(msg.result.building_unlk) && msg.result.building_unlk.length) { var cityConfigId = parseInt(jQuery('[data-role="map-holder"]').attr('city-config-id'), 10); if (isFinite(cityConfigId)) { jQuery.each(jQuery('[data-role="map-holder"] [cell-type="buildings"][cell-vacant="true"]'), function() { var buildingConfigId = parseInt(jQuery(this).attr('cell-config-id'), 10); if (-1 !== msg.result.building_unlk.indexOf(buildingConfigId)) { jQuery(this).find('.cell-item').css({ 'background-image': 'url("' + stephino_rpg_tools.media.getUrl( 'img/story/cities/' + cityConfigId + '/512-vacant-ready.png' ) + '")' }); } }); } } if ("object" === typeof msg.result.building_lvls) { jQuery.each(msg.result.building_lvls, function(buildingConfigId, buildingInfo) { if (jQuery.isArray(buildingInfo) && 2 === buildingInfo.length) { var cellObject = jQuery(`[data-role="map-holder"] [cell-type="buildings"][cell-config-id="${buildingConfigId}"]`); if (cellObject.length) { cellObject.find('.cell-item').css({ 'background-image': 'url("' + stephino_rpg_tools.media.getUrl( 'img/story/buildings/' + buildingConfigId + '/512' + (1 === buildingInfo[1] ? '' : '-' + buildingInfo[1]) + '.png' ) + '")' }); cellObject.find('.cell-item').children('i').html(buildingInfo[0] > 0 ? buildingInfo[0] : ''); cellObject.attr('cell-level', buildingInfo[0]); } } }); } do { if ("boolean" === typeof msg.result.language && msg.result.language) { window.setTimeout(function() { stephino_rpg_tools.dialog.show("dialogSettingsLanguage"); }, 1000); break; } if ("object" !== typeof msg.result.tutorial || null === msg.result.tutorial) { if ("boolean" === typeof msg.result.announcement && msg.result.announcement) { window.setTimeout(function() { stephino_rpg_tools.dialog.show("dialogSettingsAnnouncement"); }, 1000); break; } if ("boolean" === typeof msg.result.changelog && msg.result.changelog) { window.setTimeout(function() { stephino_rpg_tools.dialog.show("dialogSettingsAbout"); }, 1000); break; } } } while(false); } }, error: function(msg) { if ("undefined" === typeof msg.responseJSON) { msg.responseJSON = {status: false, result: stephino_rpg_data.i18n.ajax_timeout, content: ""}; var loadingTextObject = jQuery('.loading-text'); if (loadingTextObject.length) { loadingTextObject.addClass('error').html( `${stephino_rpg_data.i18n.ajax_no_net_title} <span>${stephino_rpg_data.i18n.ajax_no_net_content}</span>` ); console && console.log('%cstephino-rpg', 'color:orange', 'No internet connection'); window.setTimeout(function() {window.location.reload();}, 3000); } } showPopup && stephino_rpg_tools.toast.show(msg.responseJSON.result, false); console && console.log('%cstephino-rpg', 'color:orange', msg.responseJSON); "function" === typeof callback && callback(msg.responseJSON); } }); }, media: { getUrl: function(imagePath) { var result = null; if ("string" === typeof imagePath) { result = `${stephino_rpg_data.ajax_url}&method=media&mediaPath=/${imagePath.replace(/(?:^[\\\/]+|[\\\/]+$)/g, '')}`; } return result; } }, buttons: { _objects: null, init: function() { do { if (null !== stephino_rpg_tools.buttons._objects) { break; } stephino_rpg_tools.buttons._objects = jQuery('[data-btn-dialog]'); if (!stephino_rpg_tools.buttons._objects.length) { break; } stephino_rpg_tools.buttons._objects.click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show(jQuery(this).attr('data-btn-dialog')); return false; }).tooltip('dispose').tooltip('update'); } while(false); } }, chat: { _objects: { toggle: null, panel: null, firebase: null }, _limits: { text: 500, msg_latest: 50, msg_total: 1000 }, _active: false, _toggleReady: false, init: function() { do { if ("undefined" === typeof firebase) { break; } if (null !== stephino_rpg_tools.chat._objects.toggle || null !== stephino_rpg_tools.chat._objects.panel) { break; } if (!jQuery.isArray(stephino_rpg_data.game_chat) || stephino_rpg_data.game_chat.length < 6) { break; } if ('string' !== typeof stephino_rpg_data.game_chat[0] || 0 === stephino_rpg_data.game_chat[0].length || 'string' !== typeof stephino_rpg_data.game_chat[1] || 0 === stephino_rpg_data.game_chat[1].length || 'string' !== typeof stephino_rpg_data.game_chat[2] || 0 === stephino_rpg_data.game_chat[2].length || 'string' !== typeof stephino_rpg_data.game_chat[4] || 0 === stephino_rpg_data.game_chat[4].length) { break; } var firebaseUserId = parseInt(stephino_rpg_data.game_chat[3], 10); var firebaseUserName = stephino_rpg_data.game_chat[4]; if (isNaN(firebaseUserId) || firebaseUserId < 1 || firebaseUserId > 99999999) { break; } stephino_rpg_tools.chat._objects.toggle = jQuery('[data-role="chat-room-toggle"]').click(function() { stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.chat.toggle(); }).tooltip('dispose').tooltip('update').addClass('d-none'); firebase.initializeApp({ projectId: stephino_rpg_data.game_chat[0], databaseURL: stephino_rpg_data.game_chat[1], apiKey: stephino_rpg_data.game_chat[2] }); firebase.auth().onAuthStateChanged(function (user) { if (user) { stephino_rpg_tools.chat._objects.panel = jQuery('<div class="stephino-console stephino-console-chat"></div>'); var formObject = jQuery( '<form method="post">' + '<div class="console-header">' + '<b>' + stephino_rpg_data.app_name + ' - ' + stephino_rpg_data.i18n.chat_title + '</b>' + '</div>' + '<div data-role="console-output"></div>' + '<input data-role="console-input" />' + '</form>' ); stephino_rpg_tools.chat._objects.panel.append(formObject); var formInput = formObject.find('[data-role="console-input"]') .attr('placeholder', stephino_rpg_data.i18n.chat_hint) .attr('maxlength', stephino_rpg_tools.chat._limits.text); var formOutput = formObject.find('[data-role="console-output"]') .unbind('mousewheel').bind('mousewheel', function(e) {e.stopPropagation();}); var escapedDomain = window.location.host.replace(/[^\w\.\-:]+/g, ''); formObject.submit(function(e) { e.preventDefault(); e.stopPropagation(); if (formInput.val().length > 0 && formInput.val().length <= stephino_rpg_tools.chat._limits.text) { firebase.database().ref('chat').push({ i: firebaseUserId, n: firebaseUserName, d: escapedDomain, t: formInput.val(), u: user.uid }); formOutput.scrollTop(formOutput[0].scrollHeight); } formInput.val(''); return false; }); stephino_rpg_tools.chat._objects.firebase = firebase.database().ref('chat').limitToLast( stephino_rpg_tools.chat._limits.msg_latest ); stephino_rpg_tools.chat._objects.firebase.once('value', function (lastMessages) { if (null !== lastMessages.val() && Object.keys(lastMessages.val()).length >= stephino_rpg_tools.chat._limits.msg_latest) { var lastMessageKey = Object.keys(lastMessages.val())[0]; stephino_rpg_tools.chat._objects.firebase.orderByKey().endAt(lastMessageKey).once('value', function (olderMessages) { if (null !== olderMessages.val() && Object.keys(olderMessages.val()).length >= stephino_rpg_tools.chat._limits.msg_total) { var updates = {}; Object.keys(olderMessages.val()).forEach(function (k) { updates[k] = null; }); delete updates[lastMessageKey]; stephino_rpg_tools.chat._objects.firebase.ref.update(updates); } }); } var welcomeMessage = jQuery('<div class="welcome"></div>').html(stephino_rpg_data.i18n.chat_welcome); if ('string' === typeof stephino_rpg_data.discord_url && stephino_rpg_data.discord_url.length) { welcomeMessage.append( '<br/>' + stephino_rpg_data.i18n.chat_discord.replace( /%s/g, `<a rel="noreferrer" target="_blank" href="${stephino_rpg_data.discord_url}">Discord</a>` ) ); } formOutput.append(welcomeMessage); formOutput.scrollTop(formOutput[0].scrollHeight); }); stephino_rpg_tools.chat._objects.firebase.on('child_removed', function (snapshot) { formOutput.find(`[data-key="${snapshot.getRef().key}"]`).fadeOut(function() { jQuery(this).remove(); if (!formOutput.is(':hover')) { formOutput.scrollTop(formOutput[0].scrollHeight); } }); }); stephino_rpg_tools.chat._objects.firebase.on('child_added', function (snapshot) { var message = snapshot.val(); if (null !== message && "object" === typeof message && "number" === typeof message.i && "string" === typeof message.d && "string" === typeof message.n && "string" === typeof message.t) { var escapedI = Math.abs(parseInt(message.i, 10)); var escapedD = jQuery('<div>').text(message.d).html(); var escapedN = jQuery('<div>').text(message.n).html(); var escapedT = jQuery('<div>').text(message.t).html(); var messageAuthor = jQuery('<div class="author" data-placement="right"></div>').html(escapedN + ':'); if (message.d === escapedDomain) { !isNaN(escapedI) && messageAuthor.click(function() { stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog._coreActions.userViewProfile([escapedI]); }).attr('data-auth-id', escapedI); } else { messageAuthor .attr('title', `${escapedD}, user #${escapedI}`) .attr('data-other', 'true') .tooltip(); } var messageObject = jQuery('<div class="message"></div>') .attr('data-key', snapshot.getRef().key) .append(messageAuthor) .append(jQuery('<div class="content"></div>').html(escapedT)); if (message.d === escapedDomain && escapedI === firebaseUserId) { messageObject.attr('data-msg-self', 'true'); } if (stephino_rpg_data.game_chat[5] || "string" === typeof message.u && message.u === user.uid) { messageObject.append(jQuery('<div class="btn btn-danger">&#10006;</div>').click(function() { snapshot.getRef().remove(); })); } formOutput.append(messageObject); var messageObjects = formOutput.children('.message'); if (messageObjects.length > stephino_rpg_tools.chat._limits.msg_latest) { messageObjects.slice(0, messageObjects.length - stephino_rpg_tools.chat._limits.msg_latest).each(function(){ jQuery(this).children('.author').off('click'); jQuery(this).remove(); }); } if (!formOutput.is(':hover')) { formOutput.scrollTop(formOutput[0].scrollHeight); } } }); stephino_rpg_tools.chat._toggleReady = true; stephino_rpg_tools.chat._objects.toggle.removeClass('d-none'); if ('1' === stephino_rpg_tools.utils.getCookie('stephino-rpg-chat-room-visible')) { window.setTimeout(function() {stephino_rpg_tools.chat.show();}, 250); } } }); firebase.auth().signInAnonymously(); } while(false); }, toggle: function() { if (stephino_rpg_tools.chat._toggleReady) { if (stephino_rpg_tools.chat._active) { stephino_rpg_tools.chat.hide(); } else { stephino_rpg_tools.chat.show(); } } }, show: function() { if (null === stephino_rpg_tools.chat._objects.toggle || null === stephino_rpg_tools.chat._objects.panel) { return; } if (!stephino_rpg_tools.chat._active) { stephino_rpg_tools.chat._active = true; stephino_rpg_tools.chat._toggleReady = false; stephino_rpg_tools.utils.setCookie('stephino-rpg-chat-room-visible', '1'); stephino_rpg_tools.map.sound.manager.trigger('dialogAction'); var formOutput = stephino_rpg_tools.chat._objects.panel.find('[data-role="console-output"]'); jQuery('body').append(stephino_rpg_tools.chat._objects.panel); window.setTimeout(function() { stephino_rpg_tools.chat._objects.panel.addClass('active'); stephino_rpg_tools.chat._objects.toggle.addClass('active'); formOutput.scrollTop(formOutput[0].scrollHeight); stephino_rpg_tools.chat._toggleReady = true; }, 500); } }, hide: function() { if (null === stephino_rpg_tools.chat._objects.toggle || null === stephino_rpg_tools.chat._objects.panel) { return; } if (stephino_rpg_tools.chat._active) { stephino_rpg_tools.utils.setCookie('stephino-rpg-chat-room-visible', '0'); stephino_rpg_tools.map.sound.manager.trigger('hudClose'); stephino_rpg_tools.chat.collapse(); } }, collapse: function() { if (null === stephino_rpg_tools.chat._objects.toggle || null === stephino_rpg_tools.chat._objects.panel) { return; } if (stephino_rpg_tools.chat._active) { stephino_rpg_tools.chat._active = false; stephino_rpg_tools.chat._toggleReady = false; stephino_rpg_tools.chat._objects.panel.removeClass('active'); stephino_rpg_tools.chat._objects.toggle.removeClass('active'); window.setTimeout(function() { stephino_rpg_tools.chat._toggleReady = true; stephino_rpg_tools.chat._objects.panel.detach(); }, 500); } } }, console: { _object: null, _active: false, _history: [], _historyPointer: null, init: function() { if (!stephino_rpg_data.is_admin && !stephino_rpg_data.is_demo) { return; } document.addEventListener('keyup', function (event) { if (event.defaultPrevented) { return; } var key = event.key || event.keyCode; if (event.ctrlKey && event.altKey && ('c' === key || 67 === key)) { stephino_rpg_tools.console.toggle(); } }, {passive: true}); if ('1' === stephino_rpg_tools.utils.getCookie('stephino-rpg-console-visible')) { stephino_rpg_tools.console.show(); } }, toggle: function() { if (!stephino_rpg_data.is_admin && !stephino_rpg_data.is_demo) { return; } if (stephino_rpg_tools.console._active) { stephino_rpg_tools.console.hide(); } else { stephino_rpg_tools.console.show(); } }, show: function() { if (null === stephino_rpg_tools.console._object) { stephino_rpg_tools.console._object = jQuery('<div class="stephino-console"></div>'); var formObject = jQuery( '<form method="post">' + '<div class="console-header">' + '<b>' + 'Stephino RPG Console' + '</b>' + '</div>' + '<div data-role="console-output">' + '<div class="w-100 text-center">' + '&copy; ' + ((new Date()).getFullYear()) + ' <a rel="noreferrer" target="_blank" href="https://twitter.com/markjivko"><div class="signature"></div></a><br/>' + '</div>' + '</div>' + '<input data-role="console-input" />' + '</form>' ); formObject.find('[data-role="console-output"] > div').append(stephino_rpg_data.i18n.console_help.replace('%s', '<b>help</b>')); formObject.find('[data-role="console-input"]').attr('placeholder', stephino_rpg_data.i18n.console_hint); formObject.find('[data-role="console-input"]').keyup(function(event) { if (!stephino_rpg_tools.console._history.length) { return; } var key = event.key || event.keyCode; var arrowUp = ('ArrowUp' === key || 38 === key); var arrowDown = ('ArrowDown' === key || 40 === key); if (arrowUp || arrowDown) { if (null === stephino_rpg_tools.console._historyPointer) { stephino_rpg_tools.console._historyPointer = arrowUp ? (stephino_rpg_tools.console._history.length - 1) : 0; } else { stephino_rpg_tools.console._historyPointer += (arrowUp ? -1 : 1); if (stephino_rpg_tools.console._historyPointer < 0) { stephino_rpg_tools.console._historyPointer = 0; } if (stephino_rpg_tools.console._historyPointer > stephino_rpg_tools.console._history.length - 1) { stephino_rpg_tools.console._historyPointer = stephino_rpg_tools.console._history.length - 1; } } jQuery(this).val(stephino_rpg_tools.console._history[stephino_rpg_tools.console._historyPointer]); } }); formObject.submit(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); var objectInput = jQuery(this).find('[data-role="console-input"]'); var objectOutput = jQuery(this).find('[data-role="console-output"]'); objectOutput.unbind('mousewheel').bind('mousewheel', function(e) { e.stopPropagation(); }); objectInput.removeAttr('placeholder'); var inputText = objectInput.val().trim(); if (inputText.match(/^\?/g)) { inputText = inputText.replace(/^\?+/g, 'help'); } if (inputText.match(/^\#/g)) { inputText = inputText.replace(/^\#+/g, 'history'); var historyArgumentMatch = inputText.match(/^history\s*(\d)/); if (historyArgumentMatch) { var historyArgument = stephino_rpg_tools.console._history.length - parseInt(historyArgumentMatch[1], 10) - 1; if ("string" === typeof stephino_rpg_tools.console._history[historyArgument]) { inputText = stephino_rpg_tools.console._history[historyArgument]; } } } if (inputText.match(/^cls\b/ig)) { inputText = inputText.replace(/^cls\b/ig, 'clear'); } objectInput.val(""); stephino_rpg_tools.console._historyPointer = null; if (inputText.length) { if ( !inputText.match(/^(?:history|exit|quit)\b/ig) && ( !stephino_rpg_tools.console._history.length || stephino_rpg_tools.console._history[stephino_rpg_tools.console._history.length - 1] !== inputText ) ) { if (stephino_rpg_tools.console._history.length >= 10) { stephino_rpg_tools.console._history.shift(); } stephino_rpg_tools.console._history.push(inputText); stephino_rpg_tools.utils.setCookie( 'stephino-rpg-console', stephino_rpg_tools.utils.base64.encode( JSON.stringify( stephino_rpg_tools.console._history ) ) ); } var localCommand = inputText.match(/^(pwd|history|clear|cls|exit|quit)\b(?!\s+(?:\-\-help|\/\?))/i); if (localCommand) { switch(localCommand[1].toLowerCase()) { case 'exit': case 'quit': stephino_rpg_tools.console.hide(); break; case 'cls': case 'clear': objectOutput.html( '<span class="console-input"><span class="badge badge-secondary">&gt;</span> ' + jQuery('<div></div>').text(inputText).html() + '</span><br/>' ); break; case 'history': case 'pwd': objectOutput.append( '<span class="console-input"><span class="badge badge-secondary">&gt;</span> ' + jQuery('<div></div>').text(inputText).html() + '</span><br/>' ); if ('history' === localCommand[1].toLowerCase()) { stephino_rpg_tools.console._history.forEach(function(historyItem, historyKey) { objectOutput.append( '<span class="console-output"><span class="badge badge-info">' + (stephino_rpg_tools.console._history.length - historyKey - 1) + '</span> ' + historyItem + '</span><br/>' ); }); } else { var pwd = '<i>unknown</i>'; var mapHolderObject = jQuery('[data-role="map-holder"]'); do { if (jQuery('body').hasClass('view-city')) { pwd = '/world/<b>' + mapHolderObject.attr('island-x') + '</b>&times;<b>' + mapHolderObject.attr('island-y') + '</b>/island <b>' + mapHolderObject.attr('island-id') + '</b>/city <b>' + mapHolderObject.attr('city-id') + '</b>'; break; } if (jQuery('body').hasClass('view-island')) { pwd = '/world/<b>' + mapHolderObject.attr('island-x') + '</b>x<b>' + mapHolderObject.attr('island-y') + '</b>/island-<b>' + mapHolderObject.attr('island-id') + '</b>'; break; } var pwdVisible = stephino_rpg_tools.navigation.getMapHandler().map.visible; var pwdVisibleCenterX = parseInt((pwdVisible.from.cellX + pwdVisible.to.cellX) / 2, 10); var pwdVisibleCenterY = parseInt((pwdVisible.from.cellY + pwdVisible.to.cellY) / 2, 10); pwd = '/world/<b>' + pwdVisibleCenterX + '</b>x<b>' + pwdVisibleCenterY + '</b>'; } while (false); objectOutput.append( '<span class="console-output">' + pwd + '</span><br/>' ); } objectOutput.scrollTop(objectOutput[0].scrollHeight); break; } } else { objectOutput.append( '<span class="console-input"><span class="badge badge-secondary">&gt;</span> ' + jQuery('<div></div>').text(inputText).html() + '</span><br/>' ); var resultObject = jQuery('<span class="console-output"><span data-role="console-loader"></span><br/></span>'); objectOutput.append(resultObject).append('<br/>'); objectOutput.scrollTop(objectOutput[0].scrollHeight); stephino_rpg_tools.ajax( 'actionSettingsConsole', { command: inputText }, function(msg) { stephino_rpg_tools.map.sound.manager.trigger('cellTap'); resultObject.html(''); if ('string' === typeof msg.content && msg.content.length) { resultObject.append(msg.content + '<br/>'); } if (false === msg.status) { if ('string' === typeof msg.result) { resultObject.append( '<span class="badge badge-danger">' + msg.result + '</span><br/>' ); } else { resultObject.append( '<span class="badge badge-danger">Server error</span><br/>' ); } } else { var badgeText = null; if ('string' !== typeof msg.content || !msg.content.length) { badgeText = 'OK'; } if (null !== msg.result && 'undefined' !== typeof msg.result.data) { badgeText = JSON.stringify(msg.result.data); } if (null !== badgeText) { resultObject.append( '<span class="badge badge-success">' + badgeText + '</span><br/>' ); } } objectOutput.scrollTop(objectOutput[0].scrollHeight); setTimeout(stephino_rpg_tools.heartbeat.run, 250); }, false ); } } return false; }); stephino_rpg_tools.console._object.append(formObject); jQuery('body').append(stephino_rpg_tools.console._object); } if (!stephino_rpg_tools.console._active) { stephino_rpg_tools.console._active = true; stephino_rpg_tools.utils.setCookie('stephino-rpg-console-visible', '1'); stephino_rpg_tools.tutorial.collapse(); stephino_rpg_tools.navigation.collapse(); stephino_rpg_tools.console._object.addClass('active'); stephino_rpg_tools.console._object.find('[data-role="console-input"]').focus(); stephino_rpg_tools.map.sound.manager.trigger('hudOpen'); var historyBase64 = stephino_rpg_tools.utils.getCookie('stephino-rpg-console'); if ('string' === typeof historyBase64 && historyBase64.length) { stephino_rpg_tools.console._history = JSON.parse( stephino_rpg_tools.utils.base64.decode( unescape(historyBase64) ) ); if (!jQuery.isArray(stephino_rpg_tools.console._history)) { stephino_rpg_tools.console._history = []; stephino_rpg_tools.utils.setCookie('stephino-rpg-console', ''); } } } }, hide: function() { if (stephino_rpg_tools.console._active) { stephino_rpg_tools.console._active = false; stephino_rpg_tools.utils.setCookie('stephino-rpg-console-visible', '0'); stephino_rpg_tools.console._object.removeClass('active'); stephino_rpg_tools.map.sound.manager.trigger('hudClose'); } } }, paypal: { init: function() { var params = stephino_rpg_tools.utils.getParams(window.location.href); if ("undefined" !== typeof params['paymentId'] && "undefined" !== typeof params['PayerID'] && "undefined" !== typeof params['token']) { stephino_rpg_tools.toast.show(stephino_rpg_data.i18n.paypal_validating); window.history.pushState("paypal", stephino_rpg_data.app_name, stephino_rpg_data.ajax_url); stephino_rpg_tools.ajax('actionPremiumPackageBuyConfirm', { packagePaymentId: params['paymentId'], packagePayerId: params['PayerID'], packageToken: params['token'] }, function(msg) { if (msg.status) { stephino_rpg_tools.toast.show(msg.content); } }); } } }, pwa: { init: function() { stephino_rpg_tools.pwa.manifest(); stephino_rpg_tools.pwa.workers(); stephino_rpg_tools.pwa.history(); stephino_rpg_tools.pwa.installer(); }, prompt: null, history: function() { history && history.pushState(null, null, location.href); window.onpopstate = function () { if (null !== stephino_rpg_tools.dialog._objects.modal && stephino_rpg_tools.dialog._objects.modal.hasClass('show')) { if (stephino_rpg_tools.dialog._objects.modalBack.hasClass('visible')) { stephino_rpg_tools.dialog._objects.modalBack.click(); } else { stephino_rpg_tools.dialog.hide(); } history.pushState(null, null, location.href); history.go(1); } }; }, installer: function() { window.addEventListener('beforeinstallprompt', function(event) { event.preventDefault(); stephino_rpg_tools.pwa.prompt = event; }); }, workers: function() { if ('serviceWorker' in navigator) { navigator.serviceWorker .register(stephino_rpg_data.ajax_url + '&method=js&view=pwa', { scope: stephino_rpg_data.ajax_url, useCache: true }).then(function () {}).catch(function () {}); } }, manifest: function() { var linkObject = jQuery('link#stephino_rpg_manifest'); if (!linkObject.length) { return; } if ("undefined" !== typeof linkObject.attr('href')) { return; } var myDynamicManifest = { "description": stephino_rpg_data.app_name + ' was built using Stephino RPG v.' + stephino_rpg_data.game_ver + ' by Mark Jivko', "short_name": stephino_rpg_data.app_name, "name": stephino_rpg_data.app_name + " - Stephino RPG", "theme_color": "#ffffff", "background_color": "#23282d", "dir": "ltr", "lang": "en-US", "start_url": stephino_rpg_data.ajax_url, "scope": stephino_rpg_data.ajax_url + "*", "icons": [ { "src": stephino_rpg_tools.media.getUrl("img/ui/192.png"), "sizes": "192x192", "type": "image/png", "purpose": "any maskable" }, { "src": stephino_rpg_tools.media.getUrl("img/ui/512.png"), "sizes": "512x512", "type": "image/png", "purpose": "any maskable" } ], "display": "fullscreen", "orientation": "landscape" }; var manifestURL = URL.createObjectURL( new Blob( [JSON.stringify(myDynamicManifest)], {type: 'application/json'} ) ); jQuery('link#stephino_rpg_manifest').attr('href', manifestURL); } }, heartbeat: { _data: { delay: null, timeout: null, cityId: null, ticker: null }, run: function() { stephino_rpg_tools.ajax('actionSettingsHeartbeat', { cityId: stephino_rpg_tools.heartbeat._data.cityId }, function(msg) { if (null !== msg && "undefined" !== typeof msg.result) { if ("string" === typeof msg.result.heartBeatLang && stephino_rpg_data.game_lang !== msg.result.heartBeatLang) { window.location.reload(); } else { if ("function" === typeof stephino_rpg_tools.dialog.actions.heartBeatCallback) { stephino_rpg_tools.dialog.actions.heartBeatCallback(msg, stephino_rpg_tools.heartbeat._data.cityId); } } } }); }, step: function() { if (null !== this._data.timeout) { window.clearTimeout(this._data.timeout); } if (this._data.delay > 0) { this._data.timeout = window.setTimeout(function() { stephino_rpg_tools.heartbeat.run(); stephino_rpg_tools.heartbeat.step(); }, this._data.delay); } }, init: function() { if (null === this._data.timeout) { this._data.cityId = parseInt(jQuery('[data-role="map-holder"]').attr('city-id'), 10); if (!isFinite(this._data.cityId) || this._data.cityId <= 0) { this._data.cityId = null; } this.setDelay(); this.step(); } }, setDelay: function(delay) { do { if ("undefined" === typeof delay) { this._data.delay = 60000; break; } if ("number" === typeof delay && !isNaN(parseInt(delay, 10))) { delay = parseInt(delay, 10); this._data.delay = delay < 0 ? 0 : delay; } } while(false); this.step(); }, stop: function() { this.setDelay(0); } }, tutorial: { _objects: { data: null, tooltip: null, dialog: null, dialogToggle: null, dialogTitle: null, dialogStepsBar: null, dialogContent: null, dialogActionArea: null, dialogActionAreaNext: null, dialogActionAreaSkip: null, marker: null, timer: null }, updateTooltip: function(delay) { delay = "undefined" !== typeof delay ? parseInt(delay, 10) : 0; if (!isFinite(delay) || delay < 0) { delay = 0; } window.setTimeout(function() { if (null !== stephino_rpg_tools.tutorial._objects.tooltip) { var visibility = false; if (null !== stephino_rpg_tools.tutorial._objects.tooltip.reference && jQuery(stephino_rpg_tools.tutorial._objects.tooltip.reference).is(':visible') && parseInt(jQuery(stephino_rpg_tools.tutorial._objects.tooltip.reference).css('opacity'), 10) > 0) { visibility = true; } jQuery(stephino_rpg_tools.tutorial._objects.tooltip.popper).css({ display: visibility ? 'block' : 'none' }); visibility && stephino_rpg_tools.tutorial._objects.tooltip.update(); } }, delay); }, hideMarker: function() { if (null !== stephino_rpg_tools.tutorial._objects.marker) { stephino_rpg_tools.tutorial._objects.marker.css({display: 'none'}); } if (null !== stephino_rpg_tools.tutorial._objects.tooltip) { stephino_rpg_tools.tutorial._objects.tooltip.destroy(); } stephino_rpg_tools.tutorial._objects.tooltip = null; }, collapse: function() { if (null !== stephino_rpg_tools.tutorial._objects.dialog) { if (!stephino_rpg_tools.tutorial._objects.dialog.hasClass('collapsed')) { stephino_rpg_tools.tutorial._objects.dialog.addClass('collapsed'); } } }, hide: function() { if (null === stephino_rpg_tools.tutorial._objects.data) { return; } if (jQuery('body').hasClass('tutorial')) { jQuery('body').removeClass('tutorial'); } stephino_rpg_tools.tutorial.hideMarker(); if (!stephino_rpg_tools.tutorial._objects.dialog.hasClass('collapsed')) { stephino_rpg_tools.tutorial._objects.dialog.addClass('collapsed'); } stephino_rpg_tools.tutorial._objects.dialog.removeClass('active'); stephino_rpg_tools.tutorial._objects.dialogActionAreaNext.removeClass('active'); if ('string' === typeof stephino_rpg_tools.tutorial._objects.data.tutorialTarget && stephino_rpg_tools.tutorial._objects.data.tutorialTargetClick) { stephino_rpg_tools.navigation._bodyObject.off( 'click', stephino_rpg_tools.tutorial._objects.data.tutorialTarget ); jQuery('body > .tooltip').remove(); } if (null !== stephino_rpg_tools.tutorial._objects.timer) { window.clearInterval(stephino_rpg_tools.tutorial._objects.timer); } stephino_rpg_tools.tutorial._objects.timer = null; }, show: function() { if (null === stephino_rpg_tools.tutorial._objects.data) { return; } if (!jQuery('body').hasClass('tutorial')) { jQuery('body').addClass('tutorial'); } stephino_rpg_tools.map.sound.manager.trigger('dialogOpen'); var advance = { next: function() { stephino_rpg_tools.tutorial.hide(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.ajax( 'actionTutorialNext', {tutorialId: stephino_rpg_tools.tutorial._objects.data.id}, function(msg) { if ('string' === typeof msg.content && msg.content.length) { stephino_rpg_tools.dialog.show(null, msg); } } ); }, skip: function() { stephino_rpg_tools.tutorial.hide(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.ajax('actionTutorialSkip', {}, function(msg) { if ('string' === typeof msg.content && msg.content.length) { stephino_rpg_tools.dialog.show(null, msg); } }); } }; if (null === stephino_rpg_tools.tutorial._objects.dialog) { stephino_rpg_tools.tutorial._objects.dialog = jQuery('[data-role="tutorial-dialog"]'); stephino_rpg_tools.tutorial._objects.dialogToggle = stephino_rpg_tools.tutorial._objects.dialog.find('[data-role="toggle"]'); stephino_rpg_tools.tutorial._objects.dialogTitle = stephino_rpg_tools.tutorial._objects.dialog.find('.title'); stephino_rpg_tools.tutorial._objects.dialogStepsBar = stephino_rpg_tools.tutorial._objects.dialog.find('.steps-bar'); stephino_rpg_tools.tutorial._objects.dialogContent = stephino_rpg_tools.tutorial._objects.dialog.find('.content'); stephino_rpg_tools.tutorial._objects.dialogActionArea = stephino_rpg_tools.tutorial._objects.dialog.find('.action-area'); stephino_rpg_tools.tutorial._objects.dialogActionAreaNext = stephino_rpg_tools.tutorial._objects.dialogActionArea.find('[data-role="next"]'); stephino_rpg_tools.tutorial._objects.dialogActionAreaSkip = stephino_rpg_tools.tutorial._objects.dialogActionArea.find('[data-role="skip"]'); stephino_rpg_tools.tutorial._objects.marker = jQuery('[data-role="tutorial-marker"]'); stephino_rpg_tools.tutorial._objects.dialogActionAreaNext.click(advance.next); stephino_rpg_tools.tutorial._objects.dialogActionAreaSkip.click(advance.skip); stephino_rpg_tools.tutorial._objects.dialogToggle.click(function() { stephino_rpg_tools.map.sound.manager.trigger('cellTap'); if (stephino_rpg_tools.tutorial._objects.dialog.hasClass('collapsed')) { stephino_rpg_tools.map.sound.manager.trigger('dialogOpen'); } else { stephino_rpg_tools.map.sound.manager.trigger('hudClose'); } stephino_rpg_tools.tutorial._objects.dialog.toggleClass('collapsed'); }); } stephino_rpg_tools.tutorial._objects.dialogTitle.html(stephino_rpg_tools.tutorial._objects.data.name); stephino_rpg_tools.tutorial._objects.dialogContent.html(stephino_rpg_tools.tutorial._objects.data.description); if (stephino_rpg_tools.tutorial._objects.data.tutorialCanSkip) { stephino_rpg_tools.tutorial._objects.dialogActionAreaSkip.show(); } else { stephino_rpg_tools.tutorial._objects.dialogActionAreaSkip.hide(); } stephino_rpg_tools.tutorial._objects.dialogStepsBar.css( {width: (stephino_rpg_tools.tutorial._objects.data.id / stephino_rpg_tools.tutorial._objects.data.total * 140) + 'px'} ); var tutorialTarget = ('string' === typeof stephino_rpg_tools.tutorial._objects.data.tutorialTarget && stephino_rpg_tools.tutorial._objects.data.tutorialTarget.length ? jQuery(stephino_rpg_tools.tutorial._objects.data.tutorialTarget) : [] ); var tutorialWaitForElement = ('string' === typeof stephino_rpg_tools.tutorial._objects.data.tutorialTargetWaitForElement && stephino_rpg_tools.tutorial._objects.data.tutorialTargetWaitForElement.length ? stephino_rpg_tools.tutorial._objects.data.tutorialTargetWaitForElement : null ); if (tutorialTarget.length) { if (stephino_rpg_tools.tutorial._objects.data.tutorialTargetClick) { jQuery(document) .off('click touchstart', stephino_rpg_tools.tutorial._objects.data.tutorialTarget) .on('click touchstart', stephino_rpg_tools.tutorial._objects.data.tutorialTarget, function() { stephino_rpg_tools.map.sound.manager.trigger('dialogButton'); if (null === tutorialWaitForElement) { advance.next(); } else { stephino_rpg_tools.tutorial.hideMarker(); } jQuery(document).off('click touchstart', stephino_rpg_tools.tutorial._objects.data.tutorialTarget); }); } stephino_rpg_tools.tutorial.hideMarker(); stephino_rpg_tools.tutorial._objects.tooltip = new Popper( tutorialTarget, stephino_rpg_tools.tutorial._objects.marker, { placement: 'top', modifiers: { keepTogether: {enabled: false}, arrow: {enabled: false}, flip: {enabled: false}, customAngle: { enabled: true, order: 860, fn: function(data, opt) { var angleOffset = 90; var angleOffScreen = 0; var triangleHeight = ((data.offsets.reference.top + data.offsets.reference.height/2) - (data.offsets.popper.top + data.offsets.popper.height/2)); var triangleLength = ((data.offsets.reference.left + data.offsets.reference.width/2) - (data.offsets.popper.left + data.offsets.popper.width/2)); var angleOffScreenRad = Math.atan(triangleHeight / triangleLength); angleOffScreen = (data.offsets.reference.left < 0 ? 360 : 180) - (angleOffScreenRad * 180 / Math.PI) - 180; data.styles.transform += ' rotate(' + parseFloat(angleOffset - angleOffScreen).toFixed(2) + 'deg)'; return data; } } } } ); jQuery(stephino_rpg_tools.tutorial._objects.tooltip.popper).attr( 'data-over-modal', tutorialTarget.length && stephino_rpg_tools.tutorial._objects.data.tutorialTarget.match(/^\.modal\b/g) ? 'true' : 'false' ); stephino_rpg_tools.tutorial._objects.marker.fadeIn(); } if (null === tutorialWaitForElement && (!tutorialTarget.length || !stephino_rpg_tools.tutorial._objects.data.tutorialTargetClick)) { if (!stephino_rpg_tools.tutorial._objects.dialogActionAreaNext.hasClass('active')) { stephino_rpg_tools.tutorial._objects.dialogActionAreaNext.addClass('active'); } } if (null !== tutorialWaitForElement) { if (null !== stephino_rpg_tools.tutorial._objects.timer) { window.clearInterval(stephino_rpg_tools.tutorial._objects.timer); } stephino_rpg_tools.heartbeat.setDelay(5000); stephino_rpg_tools.tutorial._objects.timer = window.setInterval(function() { var foundElement = stephino_rpg_tools.navigation._bodyObject.find(tutorialWaitForElement); if (foundElement.length > 0 && foundElement.is(':visible') && parseInt(foundElement.css('opacity'), 10) > 0) { if (null !== stephino_rpg_tools.tutorial._objects.timer) { window.clearInterval(stephino_rpg_tools.tutorial._objects.timer); } stephino_rpg_tools.tutorial._objects.timer = null; stephino_rpg_tools.heartbeat.setDelay(); advance.next(); } }, 1000); } stephino_rpg_tools.tutorial._objects.dialog.addClass('active'); window.setTimeout(function() { stephino_rpg_tools.tutorial._objects.dialog.removeClass('collapsed'); }, 250); stephino_rpg_tools.tutorial.updateTooltip(500); }, ui: function(data, delay) { stephino_rpg_tools.tutorial._objects.data = null; if (null === data || "object" !== typeof data) { return; } if ('string' !== typeof data.tutorialView || 'undefined' === typeof data.id || 'undefined' === typeof data.total) { return; } if ('string' !== typeof data.name) { data.name = stephino_rpg_data.i18n.tutorial_step + ' ' + data.id + '/' + data.total; } if ('string' !== typeof data.description) { data.description = '&#8230;'; } if (!jQuery('body').hasClass('view-' + data.tutorialView)) { return; } stephino_rpg_tools.tutorial._objects.data = data; var checkPageLoaded = function() { if (!jQuery('body').hasClass('loaded-final')) { return window.setTimeout(checkPageLoaded, 500); } window.setTimeout(function() { stephino_rpg_tools.tutorial.show(); }, delay); }; checkPageLoaded(); } }, settings: { _objects: { button: null, fullscreen: null, refresh: null }, ui: function(info) { if (null === stephino_rpg_tools.settings._objects.button) { stephino_rpg_tools.settings._objects.button = jQuery('[data-role="settings"]'); stephino_rpg_tools.settings._objects.fullscreen = jQuery('[data-role="fullscreen"]'); stephino_rpg_tools.settings._objects.refresh = jQuery('[data-role="refresh"]'); if ("object" === typeof info && null !== info) { window.setTimeout(function(){ jQuery.each(info, function(setKey, setValue) { stephino_rpg_tools.map.sound.manager.setMasterVolume.object(setKey, setValue); }); }, 500); } stephino_rpg_tools.settings._objects.button.click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogSettingsInfo'); return false; }).tooltip('dispose').tooltip('update'); stephino_rpg_tools.settings._objects.fullscreen.click(function() { if (window.innerHeight !== screen.height && jQuery('body').hasClass('full-screen')) { jQuery('body').removeClass('full-screen'); } try { if (screenfull && screenfull.isEnabled) { !screenfull.isFullscreen && screenfull.request(); } stephino_rpg_tools.settings._objects.fullscreen.tooltip('dispose'); } catch (e) { try { top.location.href = self.location.href; } catch (e) {} } }).tooltip('dispose').tooltip('update'); if (window.innerHeight === screen.height && !jQuery('body').hasClass('full-screen')) { jQuery('body').addClass('full-screen'); } if (stephino_rpg_tools.settings._objects.refresh.length) { stephino_rpg_tools.settings._objects.refresh.click(function(){ window.location.reload(); }).tooltip('dispose').tooltip('update'); } } } }, entities: { _objects: { button: null }, ui: function(info) { if (null === stephino_rpg_tools.entities._objects.button) { stephino_rpg_tools.entities._objects.button = jQuery('[data-role="entities"]'); if (stephino_rpg_tools.entities._objects.button.length) { var cityId = parseInt(jQuery('[data-role="map-holder"]').attr('city-id'), 10); if (isFinite(cityId)) { stephino_rpg_tools.entities._objects.button.click(function(e){ e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogCityGarrison', {cityId: cityId}); return false; }).tooltip('dispose').tooltip('update'); } } } if (null !== info && stephino_rpg_tools.entities._objects.button.length) { var spanObject = stephino_rpg_tools.entities._objects.button.find('span'); var spanCount = parseInt(info, 10); if (spanCount > 0) { spanObject.html(stephino_rpg_tools.utils.isuFormat(spanCount)); if (spanObject.hasClass('d-none')) { spanObject.removeClass('d-none'); } } else { if (!spanObject.hasClass('d-none')) { spanObject.addClass('d-none').html(''); } } } } }, messages: { _types: { MESSAGE_TYPE_DIPLOMACY : 'd', MESSAGE_TYPE_RESEARCH : 'r', MESSAGE_TYPE_ECONOMY : 'e', MESSAGE_TYPE_MILITARY : 'm' }, _objects: {}, ui: function(info) { if ("undefined" === typeof stephino_rpg_tools.messages._objects.holder) { stephino_rpg_tools.messages._objects.holder = jQuery('[data-role="messages-holder"]'); stephino_rpg_tools.messages._objects.toggle = jQuery('[data-role="messages-holder-toggle"]'); stephino_rpg_tools.messages._objects.toggle.click(function(e) { e.preventDefault(); e.stopPropagation(); if (stephino_rpg_tools.messages._objects.holder.hasClass('active')) { stephino_rpg_tools.messages._objects.holder.removeClass('active'); stephino_rpg_tools.messages._objects.toggle.removeClass('active'); stephino_rpg_tools.map.sound.manager.trigger('hudClose'); } else { stephino_rpg_tools.messages._objects.holder.addClass('active'); stephino_rpg_tools.messages._objects.toggle.addClass('active'); stephino_rpg_tools.map.sound.manager.trigger('dialogAction'); } stephino_rpg_tools.tutorial.updateTooltip(250); return false; }).tooltip('dispose').tooltip('update'); } var messageCounter = {}; var messageTitles = {}; var newMessagesFlag = false; var getMessageTitle = function(messageType) { var title = stephino_rpg_data.i18n.msg_diplomacy; switch(messageType) { case stephino_rpg_tools.messages._types.MESSAGE_TYPE_ECONOMY: title = stephino_rpg_data.i18n.msg_economy; break; case stephino_rpg_tools.messages._types.MESSAGE_TYPE_MILITARY: title = stephino_rpg_data.i18n.msg_military; break; case stephino_rpg_tools.messages._types.MESSAGE_TYPE_RESEARCH: title = stephino_rpg_data.i18n.msg_research; break; } return title; }; jQuery.each(stephino_rpg_tools.messages._types, function(k, messageType) { if ("undefined" === typeof stephino_rpg_tools.messages._objects[messageType]) { stephino_rpg_tools.messages._objects[messageType] = jQuery( '<div data-html="true" data-placement="left" data-role="message">' + '<div class="icon"><span>' + getMessageTitle(messageType) + '</span></div>' + '<div class="count"></div>' + '</div>' ).attr('data-message-type', messageType); stephino_rpg_tools.messages._objects[messageType].click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogMessagesList', { messageType: messageType }); jQuery(this).tooltip('hide'); stephino_rpg_tools.messages._objects.toggle.click(); return false; }); stephino_rpg_tools.messages._objects.holder.append(stephino_rpg_tools.messages._objects[messageType]); } messageCounter[messageType] = 0; messageTitles[messageType] = null; }); if ("object" === typeof info && null !== info) { jQuery.each(info, function(k, message){ if ("undefined" === typeof messageCounter[message.message_type]) { return true; } messageCounter[message.message_type]++; newMessagesFlag = true; if ('0' === ('' + message.message_read) && null === messageTitles[message.message_type]) { messageTitles[message.message_type] = message; } }); } if (newMessagesFlag) { if (!stephino_rpg_tools.messages._objects.toggle.hasClass('new')) { stephino_rpg_tools.messages._objects.toggle.addClass('new'); } } else { if (stephino_rpg_tools.messages._objects.toggle.hasClass('new')) { stephino_rpg_tools.messages._objects.toggle.removeClass('new'); } } var newMessageSound = false; jQuery.each(messageCounter, function(messageType, count) { var countObject = stephino_rpg_tools.messages._objects[messageType].find('.count'); if (count > 0) { if (!countObject.hasClass('visible')) { countObject.addClass('visible'); } if (!newMessageSound && (0 === countObject.text().length || parseInt(countObject.text(), 10) < count)) { newMessageSound = true; } countObject.html(count); } else { if (countObject.hasClass('visible')) { countObject.removeClass('visible'); } countObject.empty(); } }); if (newMessageSound) { stephino_rpg_tools.map.sound.manager.trigger('messageNew'); } jQuery.each(messageTitles, function(messageType, data) { var title = getMessageTitle(messageType); var messageTitle = '<b>' + title + '</b>'; if (null !== data) { messageTitle += '<br/>' + data.message_subject; } stephino_rpg_tools.messages._objects[messageType] .attr('data-original-title', messageTitle) .tooltip('dispose').tooltip('update'); }); }, collapse: function() { if ("object" === typeof stephino_rpg_tools.messages._objects.holder) { if (stephino_rpg_tools.messages._objects.holder.hasClass('active')) { stephino_rpg_tools.map.sound.manager.trigger('hudClose'); stephino_rpg_tools.messages._objects.holder.removeClass('active'); stephino_rpg_tools.messages._objects.toggle.removeClass('active'); } } } }, convoys: { _objects: { button: null, buttonCounter: null }, ui: function(convoyCount) { if (null === stephino_rpg_tools.convoys._objects.button) { stephino_rpg_tools.convoys._objects.button = jQuery('[data-role="convoys"]'); stephino_rpg_tools.convoys._objects.buttonCounter = stephino_rpg_tools.convoys._objects.button.children('span'); stephino_rpg_tools.convoys._objects.button.click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogConvoyList', {}); return false; }).tooltip('dispose').tooltip('update'); } if (convoyCount > 0) { stephino_rpg_tools.convoys._objects.buttonCounter.html(convoyCount); if (stephino_rpg_tools.convoys._objects.buttonCounter.hasClass('d-none')) { stephino_rpg_tools.convoys._objects.buttonCounter.removeClass('d-none'); } } else { if (!stephino_rpg_tools.convoys._objects.buttonCounter.hasClass('d-none')) { stephino_rpg_tools.convoys._objects.buttonCounter.html('').addClass('d-none'); } } } }, premium: { _objects: { button: null, buttonCounter: null }, ui: function(activeModifiers) { if (null === stephino_rpg_tools.premium._objects.button) { stephino_rpg_tools.premium._objects.button = jQuery('[data-role="premium-modifiers"]'); stephino_rpg_tools.premium._objects.buttonCounter = stephino_rpg_tools.premium._objects.button.children('span'); stephino_rpg_tools.premium._objects.button.click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogPremiumModifiersList'); return false; }).tooltip('dispose').tooltip('update'); } if (activeModifiers > 0) { stephino_rpg_tools.premium._objects.buttonCounter.html(activeModifiers); if (!stephino_rpg_tools.premium._objects.button.hasClass('active')) { stephino_rpg_tools.premium._objects.button.addClass('active'); stephino_rpg_tools.premium._objects.buttonCounter.removeClass('d-none'); } } else { if (stephino_rpg_tools.premium._objects.button.hasClass('active')) { stephino_rpg_tools.premium._objects.button.removeClass('active'); stephino_rpg_tools.premium._objects.buttonCounter.html('').addClass('d-none'); } } } }, queues: { _objects: { button: null }, ui: function(info) { if (null === stephino_rpg_tools.queues._objects.button) { stephino_rpg_tools.queues._objects.button = jQuery('[data-role="queues"]'); if (stephino_rpg_tools.queues._objects.button.length) { var cityId = parseInt(jQuery('[data-role="map-holder"]').attr('city-id'), 10); if (isFinite(cityId)) { stephino_rpg_tools.queues._objects.button.click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogCityQueuesList', {cityId: cityId}); return false; }).tooltip('dispose').tooltip('update'); } } } if (null !== info && stephino_rpg_tools.queues._objects.button.length) { var spanObject = stephino_rpg_tools.queues._objects.button.children('span'); var spanCount = parseInt(info, 10); if (spanCount > 0) { spanObject.html(stephino_rpg_tools.utils.isuFormat(spanCount)); if (spanObject.hasClass('d-none')) { spanObject.removeClass('d-none'); } } else { if (!spanObject.hasClass('d-none')) { spanObject.addClass('d-none').html(''); } } } } }, resources: { objects: { gold: null, gem: null, research: null, alpha: null, beta: null, gamma: null, extra1: null, extra2: null }, ui: function(info) { var mapHolder = jQuery('[data-role="map-holder"]'); var currentCityId = null; if ("undefined" !== typeof mapHolder.attr('city-id')) { currentCityId = parseInt(mapHolder.attr('city-id'), 10); } jQuery.each(info, function(k, v) { if (null === stephino_rpg_tools.resources.objects[k]) { stephino_rpg_tools.resources.objects[k] = jQuery('.res.res-' + k); if (stephino_rpg_tools.resources.objects[k].length) { stephino_rpg_tools.resources.objects[k].html('<div class="icon" data-html="true"></div><span data-html="true"></span>'); stephino_rpg_tools.resources.objects[k].unbind('click').click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogSettingsResources', { cityId: currentCityId, resKey: k }); return false; }); } } if (stephino_rpg_tools.resources.objects[k].length) { stephino_rpg_tools.resources.objects[k].children('.icon, span').attr( 'title', '<b>' + v[1] + '</b>: ' + stephino_rpg_tools.php.number_format(parseInt(v[0], 10), 0) + ('undefined' !== typeof v[2] && parseFloat(v[0]) >= parseFloat(v[2]) ? ' (max)' : '') ).tooltip('dispose').tooltip('update'); var spanObject = stephino_rpg_tools.resources.objects[k].children('span').html( stephino_rpg_tools.utils.isuFormat(parseInt(v[0], 10)) ); if ('undefined' !== typeof v[2] && parseFloat(v[0]) >= parseFloat(v[2])) { !spanObject.hasClass('text-warning') && spanObject.addClass('text-warning'); } else { spanObject.hasClass('text-warning') && spanObject.removeClass('text-warning'); } } }); } }, navigation: { _mapHandler: null, _bodyObject: null, _domeObject: null, _initObjects: function() { if (null === this._bodyObject) { this._bodyObject = jQuery('body'); } }, getMapHandler: function() { return stephino_rpg_tools.navigation._mapHandler; }, setMapHandler: function(mapHandler) { stephino_rpg_tools.navigation._mapHandler = mapHandler; }, ui: function(info) { if (null !== this._domeObject) { return; } this._domeObject = jQuery('.bottom-bar .dome'); ["cities", "islands"].forEach(function(altitude) { var altitudeObject = jQuery( '<div class="dome-' + altitude + '">' + ('cities' === altitude ? '<span class="arrow arrow-down"></span>' : '') + '<span class="arrow arrow-left"></span>' + '<span class="arrow arrow-right"></span>' + '<div class="dome-inner"></div>' + '</div>' ); altitudeObject.find('.arrow-left').attr('title', stephino_rpg_data.i18n.nav_prev); altitudeObject.find('.arrow-right').attr('title', stephino_rpg_data.i18n.nav_next); jQuery.each(info[altitude], function(itemId, itemData) { var iconObject = jQuery('<div class="icon"></div>').attr('data-id', itemId); var iconFileName = '512.png'; if ('cities' === altitude) { iconFileName = '512' + (1 === itemData.level ? '' : '-' + itemData.level) + '.png'; } iconObject.css({ backgroundImage: 'url("' + stephino_rpg_tools.media.getUrl( 'img/story/' + altitude + '/' + itemData.icon + '/' + iconFileName ) + '")' }); iconObject.append( '<span class="label"><span>' + ("boolean" === typeof itemData.capital && itemData.capital ? stephino_rpg_data.symbol_capital + ' ' : '') + itemData.name + '</span></span>' ); if (itemData.current) { iconObject.addClass('current').addClass('active'); } if ("undefined" !== typeof itemData.coords) { iconObject.attr('data-coords', itemData.coords.join('x')); } iconObject.click(function(e) { stephino_rpg_tools.tutorial.updateTooltip(500); if (!stephino_rpg_tools.navigation._domeObject.hasClass('active')) { return true; } stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.navigation.collapse(); if (itemData.current && ( (stephino_rpg_tools.navigation._bodyObject.hasClass('view-city') && 'cities' === altitude) || (stephino_rpg_tools.navigation._bodyObject.hasClass('view-island') && 'islands' === altitude) )) { return false; } stephino_rpg_tools.navigation.start('cities' === altitude ? 'city' : 'island', itemId, 200); }); altitudeObject.find('.dome-inner').append(iconObject); }); if (!altitudeObject.find('.icon.active').length) { altitudeObject.find('.icon').eq(0).addClass('active'); } if (altitudeObject.find('.icon').length <= 1) { altitudeObject.addClass('single'); } stephino_rpg_tools.navigation._domeObject.append(altitudeObject); }); var worldObject = jQuery( '<div class="dome-world">' + '<div class="dome-inner"></div>' + '</div>' ).click(function(e) { jQuery(this).tooltip('hide'); if (!stephino_rpg_tools.navigation._domeObject.hasClass('active')) { return true; } stephino_rpg_tools.tutorial.updateTooltip(500); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.navigation.collapse(); var currentIsland = stephino_rpg_tools.navigation._domeObject.find('.dome-islands .icon.active'); var coordinates = null; if (currentIsland.length) { coordinates = currentIsland.attr('data-coords'); } if (!stephino_rpg_tools.navigation._bodyObject.hasClass('view-world')) { stephino_rpg_tools.navigation.start('world', coordinates, 200); } else { if (null !== stephino_rpg_tools.navigation._mapHandler) { if ("function" === typeof stephino_rpg_tools.navigation._mapHandler.centerMap) { stephino_rpg_tools.navigation._mapHandler.centerMap(true); } } } return false; }); this._domeObject.append(worldObject); this._domeObject.find('[title]').tooltip('dispose').tooltip('update'); this._domeObject.find('.arrow-left, .arrow-right').click(function(e) { if (!stephino_rpg_tools.navigation._domeObject.hasClass('active')) { return true; } stephino_rpg_tools.tutorial.updateTooltip(500); stephino_rpg_tools.map.sound.manager.trigger('dialogButton'); e.preventDefault(); e.stopPropagation(); var direction = jQuery(this).hasClass('arrow-right'); var elements = jQuery(this).siblings('.dome-inner').children(); var currentIndex = 0; jQuery.each(elements, function(k) { if (jQuery(this).hasClass('active')) { currentIndex = k; return false; } }); var newIndex = currentIndex + (direction ? 1 : -1); if (newIndex >= elements.length) { newIndex = 0; } if (newIndex < 0) { newIndex = elements.length - 1; } elements.removeClass('active').eq(newIndex).addClass('active'); return false; }); this._domeObject.click(function() { stephino_rpg_tools.map.sound.manager.trigger( jQuery(this).hasClass('active') ? 'hudClose' : 'hudOpen' ); jQuery(this).toggleClass('active'); stephino_rpg_tools.tutorial.updateTooltip(500); }); }, start: function(view, viewData, delay) { this._initObjects(); stephino_rpg_tools.navigation._bodyObject.removeClass('loaded-final'); if ("undefined" === typeof view) { view = 'city'; } if ("undefined" === typeof viewData) { viewData = null; } delay = "undefined" === typeof delay ? 0 : parseInt(delay, 10); var url = stephino_rpg_data.ajax_url + "&view=" + view + (null !== viewData ? ("&viewData=" + viewData) : ''); window.setTimeout(function() { if (null !== stephino_rpg_tools.map.sound.howler._objects) { jQuery.each(stephino_rpg_tools.map.sound.howler._objects, function(fileName, howler) { stephino_rpg_tools.map.sound.manager.setVolume(fileName, howler, 0); }); } stephino_rpg_tools.dialog.hide(); stephino_rpg_tools.messages.collapse(); stephino_rpg_tools.tutorial.collapse(); stephino_rpg_tools.chat.collapse(); stephino_rpg_tools.navigation._bodyObject.removeClass('loaded'); stephino_rpg_tools.navigation._domeObject.removeClass('active'); }, delay); window.setTimeout(function() { window.location.href = url; }, delay + 500); }, finish: function(delay) { this._initObjects(); delay = "undefined" === typeof delay ? 500 : parseInt(delay, 10); window.setTimeout(function() { !stephino_rpg_tools.navigation._bodyObject.hasClass('loaded') && stephino_rpg_tools.navigation._bodyObject.addClass('loaded'); }, delay); window.setTimeout(function() { !stephino_rpg_tools.navigation._bodyObject.hasClass('loaded-final') && stephino_rpg_tools.navigation._bodyObject.addClass('loaded-final'); }, delay + 500); }, collapse: function() { if (null !== stephino_rpg_tools.navigation._domeObject) { if (stephino_rpg_tools.navigation._domeObject.hasClass('active')) { stephino_rpg_tools.map.sound.manager.trigger('hudClose'); stephino_rpg_tools.navigation._domeObject.removeClass('active'); } } stephino_rpg_tools.tutorial.updateTooltip(500); } }, toast: { _objects: { infoBadge: null }, _timer: null, show: function(message, status, duration) { if (null === stephino_rpg_tools.toast._objects.infoBadge) { stephino_rpg_tools.toast._objects.infoBadge = jQuery('[role="info-badge"]'); } if (!stephino_rpg_tools.toast._objects.infoBadge.length) { return; } if ("undefined" === typeof status) { status = true; } else { status = !!status; } if ("undefined" === typeof message) { message = null; } else { message += ""; } if ("undefined" === typeof duration) { duration = 3000; } if (!status) { if (!stephino_rpg_tools.toast._objects.infoBadge.hasClass('badge-error')) { stephino_rpg_tools.toast._objects.infoBadge.addClass('badge-error'); } } else { if (stephino_rpg_tools.toast._objects.infoBadge.hasClass('badge-error')) { stephino_rpg_tools.toast._objects.infoBadge.removeClass('badge-error'); } } stephino_rpg_tools.toast._objects.infoBadge.find('.message').html(message); stephino_rpg_tools.toast._objects.infoBadge.stop(true).fadeIn(500); if (!stephino_rpg_tools.toast._objects.infoBadge.hasClass('active')) { stephino_rpg_tools.toast._objects.infoBadge.addClass('active'); } if (null !== stephino_rpg_tools.toast._timer) { window.clearTimeout(stephino_rpg_tools.toast._timer); } stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.toast._timer = window.setTimeout(function() { if (stephino_rpg_tools.toast._objects.infoBadge.hasClass('active')) { stephino_rpg_tools.toast._objects.infoBadge.removeClass('active'); } stephino_rpg_tools.toast._objects.infoBadge.fadeOut(500); if (null !== stephino_rpg_tools.toast._timer) { window.clearTimeout(stephino_rpg_tools.toast._timer); } }, duration); } }, dialog: { _coreActions: { goBack: function() { null !== stephino_rpg_tools.dialog._objects.modalBack && stephino_rpg_tools.dialog._objects.modalBack.click(); }, sound: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var soundName = ("" + args[0]).trim(); if (soundName.length) { stephino_rpg_tools.map.sound.manager.trigger(soundName); } } }, navigate: function(args) { if (jQuery.isArray(args) && 2 === args.length) { var needToNavigate = true; switch (args[0]) { case 'city': case 'island': if ("undefined" !== typeof jQuery('[data-role="map-holder"]').attr(args[0] + '-id') && parseInt(args[1], 10) === parseInt(jQuery('[data-role="map-holder"]').attr(args[0] + '-id'), 10)) { needToNavigate = false; } break; } if (needToNavigate) { stephino_rpg_tools.navigation.start(args[0], args[1], 400); } else { stephino_rpg_tools.dialog.hide(); } } }, fetch: function(args) { if (jQuery.isArray(args) && args.length >= 1) { var methodName = args.shift(); var objectItem = jQuery(this); objectItem.html('&#8230;'); stephino_rpg_tools.ajax(methodName, {commonArgs: args}, function(msg) { if (msg.status) { objectItem.html(msg.result); } else { objectItem.html('&dot;&dot;&dot;'); } }); } }, dialog: function(args) { if (jQuery.isArray(args) && args.length >= 1) { var methodName = args.shift(); stephino_rpg_tools.dialog.show(methodName, {commonArgs: args}); } }, dialogNH: function(args) { if (jQuery.isArray(args) && args.length >= 1) { var methodName = args.shift(); stephino_rpg_tools.dialog.show(methodName, {commonArgs: args}, null, null, true); } }, ptfPreview: function(args) { var previewSlotWH = 64; var previewSizeWH = 15; var previewFinalWH = 16; if (jQuery.isArray(args)) { args = stephino_rpg_tools.utils.getIntListZip(args, false); if (args.length === previewSizeWH * previewSizeWH) { var canvasObject = jQuery('<canvas></canvas>'); var imgObject = jQuery('<img/>') .on('load', function() { var context = canvasObject[0].getContext('2d'); context.canvas.width = previewSizeWH * previewFinalWH; context.canvas.height = previewSizeWH * previewFinalWH; args.forEach(function(id, key) { var sourceY = Math.floor((parseInt(id, 10) - 1) / 11); var sourceX = parseInt(id, 10) - 11 * sourceY - 1; var destY = Math.floor(key / previewSizeWH); var destX = key - previewSizeWH * destY; context.drawImage( imgObject[0], sourceX * previewSlotWH, sourceY * previewSlotWH, previewSlotWH, previewSlotWH, destX * previewFinalWH, destY * previewFinalWH, previewFinalWH, previewFinalWH ); }); }) .attr('src', stephino_rpg_tools.media.getUrl('img/ui/ptfs/ptf-tiles.png')); jQuery(this).append(canvasObject); } } }, ptfStars: function(args) { if (jQuery.isArray(args) && args.length) { var objectHolder = jQuery(this); var ptfStars = parseFloat(args[0]); ptfStars = ptfStars < 0 ? 0 : (ptfStars > 5 ? 5 : ptfStars); var objectTop = jQuery('<div></div>'); var objectBottom = jQuery('<div></div>'); for (var i = 1; i <= 5; i++) { objectTop.append('<i></i>'); objectBottom.append('<i></i>'); } var objectTopWrapper = jQuery('<div></div>') .css({width: `${parseFloat(100 * ptfStars / 5).toFixed(2)}%`}) .append(objectTop); objectHolder.append(objectTopWrapper).append(objectBottom); } }, ptfListener: function() { if ("function" !== typeof stephino_rpg_data.ptf_listener) { stephino_rpg_data.ptf_send = function(msgType, msgData) { var iFrame = jQuery('[data-effect="ptfListener"] iframe'); if (iFrame.length) { jQuery('[data-effect="ptfListener"] iframe')[0].contentWindow.postMessage( {msgType: msgType, msgData: msgData}, '*' ); } }; stephino_rpg_data.ptf_listener = function (e) { if ("object" === typeof e.data && null !== e.data && "string" === typeof e.data.msgType && "undefined" !== typeof e.data.msgData) { var ptfId = parseInt(jQuery('[data-effect="ptfListener"]').attr('data-effect-args'), 10); switch (e.data.msgType) { case 'sound': if ('string' === typeof e.data.msgData) { stephino_rpg_tools.map.sound.manager.trigger(e.data.msgData); } break; case 'start': stephino_rpg_tools.ajax('actionUserPtfStarted', { ptfId: e.data.msgData }, function(msg) { if (msg.status) { jQuery('[data-effect="ptfListener"]').attr('data-effect-args', e.data.msgData); } if (msg.status) { var objectDetails = jQuery('[data-role="ptf-details"]'); objectDetails.html(msg.content); stephino_rpg_tools.dialog._coreActionsHandler(objectDetails); } stephino_rpg_data.ptf_send( 'start', msg.status ? e.data.msgData : ptfId ); }); break; case 'end': stephino_rpg_tools.map.sound.manager.trigger(e.data.msgData ? 'queueEntity' : 'attackDefeat'); stephino_rpg_tools.ajax('actionUserPtfFinished', { ptfId: ptfId, ptfWon: !!e.data.msgData }, function(msg) { stephino_rpg_data.ptf_send( 'end', msg.status && !!e.data.msgData && msg.result ? parseInt(msg.result, 10) : 0 ); }); break; case 'rate': var ptfRating = parseInt(e.data.msgData, 10); if (!isNaN(ptfRating) && ptfRating >= 1 && ptfRating <= 5) { stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.ajax('actionUserPtfRate', { ptfId: ptfId, ptfRating: ptfRating }, function(msg) { if (msg.status && "string" === typeof msg.content && msg.content.length) { stephino_rpg_tools.toast.show(msg.content); } }); } break; } } }; window.addEventListener("message", stephino_rpg_data.ptf_listener, {passive: true}); } }, ptfCreator: function(args, modalData) { if (jQuery.isArray(args) && args.length) { switch (args[0]) { case 'canvas': var gridWidth = parseInt(args[1], 10); var gridHeight = parseInt(args[2], 10); stephino_rpg_data.ptf = { tileSet: stephino_rpg_tools.utils.getIntListZip( jQuery(this).attr('data-tile-set').split(','), false ), tileSetWidth: parseInt(jQuery(this).attr('data-tile-set-width'), 10), tileSetHeight: parseInt(jQuery(this).attr('data-tile-set-height'), 10), tileSide: parseInt(jQuery(this).attr('data-tile-side'), 10), gridWidth: gridWidth, gridHeight: gridHeight, pointer: {x: 0, y: 0}, brush: {x: 1, y: 1}, objects: { grid: jQuery('<div class="d-grid" tabindex="1"></div>'), hud: jQuery('<div class="ptf-hud"><span></span></div>'), imgTiles: jQuery('<img/>'), canvas: jQuery('<canvas></canvas>'), context: null, navigation: null, brushes: null }, init: false, paint: function(gridX, gridY, cellValue, updateTileSet, dynamicPaint) { updateTileSet = ("undefined" === typeof updateTileSet ? false : !!updateTileSet); if (!!dynamicPaint) { var getCellValue = function(cellGridX, cellGridY) { var cellTop = stephino_rpg_data.ptf.tileSet[ ((cellGridY - 1) + stephino_rpg_data.ptf.pointer.y - 1) * stephino_rpg_data.ptf.tileSetWidth + (cellGridX + stephino_rpg_data.ptf.pointer.x - 1) ]; var cellLeft = stephino_rpg_data.ptf.tileSet[ (cellGridY + stephino_rpg_data.ptf.pointer.y - 1) * stephino_rpg_data.ptf.tileSetWidth + ((cellGridX - 1) + stephino_rpg_data.ptf.pointer.x - 1) ]; var cellBottom = stephino_rpg_data.ptf.tileSet[ ((cellGridY + 1) + stephino_rpg_data.ptf.pointer.y - 1) * stephino_rpg_data.ptf.tileSetWidth + (cellGridX + stephino_rpg_data.ptf.pointer.x - 1) ]; var cellRight = stephino_rpg_data.ptf.tileSet[ (cellGridY + stephino_rpg_data.ptf.pointer.y - 1) * stephino_rpg_data.ptf.tileSetWidth + ((cellGridX + 1) + stephino_rpg_data.ptf.pointer.x - 1) ]; var cellDef = [ cellTop >= 2 && cellTop <= 17 ? 1 : 0, cellLeft >= 2 && cellLeft <= 17 ? 1 : 0, cellBottom >= 2 && cellBottom <= 17 ? 1 : 0, cellRight >= 2 && cellRight <= 17 ? 1 : 0 ].join(','); var newValue = { '0,0,0,0': 8, '0,0,0,1': 3, '0,0,1,0': 6, '0,0,1,1': 12, '0,1,0,0': 4, '0,1,0,1': 2, '0,1,1,0': 9, '0,1,1,1': 16, '1,0,0,0': 7, '1,0,0,1': 11, '1,0,1,0': 5, '1,0,1,1': 15, '1,1,0,0': 10, '1,1,0,1': 14, '1,1,1,0': 13, '1,1,1,1': 17 }; return newValue[cellDef]; }; this.paint(gridX, gridY, 8 === cellValue ? getCellValue(gridX, gridY) : cellValue, true); [[gridX - 1, gridY], [gridX, gridY - 1], [gridX + 1, gridY], [gridX, gridY + 1]].forEach(function(nCell) { if (nCell[0] >= 1 && nCell[0] <= gridWidth && nCell[1] >= 1 && nCell[1] <= gridHeight) { var nValue = stephino_rpg_data.ptf.tileSet[ (nCell[1] + stephino_rpg_data.ptf.pointer.y - 1) * stephino_rpg_data.ptf.tileSetWidth + (nCell[0] + stephino_rpg_data.ptf.pointer.x - 1) ]; if (nValue >= 2 && nValue <= 17) { stephino_rpg_data.ptf.paint(nCell[0], nCell[1], getCellValue(nCell[0], nCell[1]), true); } } }); return; } var slotWH = stephino_rpg_data.ptf.tileSide; var sourceY = Math.floor((parseInt(cellValue, 10) - 1) / 11); var sourceX = parseInt(cellValue, 10) - 11 * sourceY - 1; stephino_rpg_data.ptf.objects.context.clearRect( (gridX - 1) * slotWH, (gridY - 1) * slotWH, slotWH, slotWH ); stephino_rpg_data.ptf.objects.context.drawImage( stephino_rpg_data.ptf.objects.imgTiles[0], sourceX * slotWH, sourceY * slotWH, slotWH, slotWH, (gridX - 1) * slotWH, (gridY - 1) * slotWH, slotWH, slotWH ); if (updateTileSet) { var tileSetKey = (gridY + stephino_rpg_data.ptf.pointer.y - 1) * stephino_rpg_data.ptf.tileSetWidth + (gridX + stephino_rpg_data.ptf.pointer.x - 1); stephino_rpg_data.ptf.tileSet[tileSetKey] = cellValue; } }, render: function() { if (this.pointer.x < 0) { this.pointer.x = 0; } if (this.pointer.x > this.tileSetWidth - this.gridWidth) { this.pointer.x = this.tileSetWidth - this.gridWidth; } if (this.pointer.y < 0) { this.pointer.y = 0; } if (this.pointer.y > this.tileSetHeight - this.gridHeight) { this.pointer.y = this.tileSetHeight - this.gridHeight; } var draw = function() { for (var gridY = 1; gridY <= stephino_rpg_data.ptf.gridHeight; gridY++) { for (var gridX = 1; gridX <= stephino_rpg_data.ptf.gridWidth; gridX++) { var tileSetKey = (gridY + stephino_rpg_data.ptf.pointer.y - 1) * stephino_rpg_data.ptf.tileSetWidth + (gridX + stephino_rpg_data.ptf.pointer.x - 1); var cellValue = stephino_rpg_data.ptf.tileSet[tileSetKey]; stephino_rpg_data.ptf.paint(gridX, gridY, cellValue); } } var hudRatio = stephino_rpg_data.ptf.tileSetWidth / stephino_rpg_data.ptf.tileSetHeight; stephino_rpg_data.ptf.objects.hud.css({ width: Number.parseFloat(hudRatio >= 1 ? 200 : 200 * (hudRatio)).toPrecision(1) + 'px', height: Number.parseFloat(hudRatio >= 1 ? 200 / hudRatio : 200).toPrecision(1) + 'px' }).children().css({ width: Number.parseFloat(100 * stephino_rpg_data.ptf.gridWidth / stephino_rpg_data.ptf.tileSetWidth).toPrecision(2) + '%', height: Number.parseFloat(100 * stephino_rpg_data.ptf.gridHeight / stephino_rpg_data.ptf.tileSetHeight).toPrecision(2) + '%', top: Number.parseFloat(100 * stephino_rpg_data.ptf.pointer.y / stephino_rpg_data.ptf.tileSetHeight).toPrecision(2) + '%', left: Number.parseFloat(100 * stephino_rpg_data.ptf.pointer.x / stephino_rpg_data.ptf.tileSetWidth).toPrecision(2) + '%' }); }; if (this.init) { draw(); } else { if ("undefined" === typeof stephino_rpg_data.ptf.objects.imgTiles.attr('src')) { this.objects.imgTiles.on('load', function() { stephino_rpg_data.ptf.init = true; draw(); }).attr('src', stephino_rpg_tools.media.getUrl('img/ui/ptfs/ptf-tiles.png')); } } } }; stephino_rpg_data.ptf.objects.context = stephino_rpg_data.ptf.objects.canvas[0].getContext('2d'); stephino_rpg_data.ptf.objects.context.canvas.width = gridWidth * stephino_rpg_data.ptf.tileSide; stephino_rpg_data.ptf.objects.context.canvas.height = gridHeight * stephino_rpg_data.ptf.tileSide; for (var gridY = 1; gridY <= gridHeight; gridY++) { var gridRow = jQuery('<div class="row"></div>'); for (var gridX = 1; gridX<= gridWidth; gridX++) { var gridCell = jQuery('<div class="col"></div>').attr('grid-x', gridX).attr('grid-y', gridY).click(function() { var cellValue = stephino_rpg_data.ptf.brush.x + (stephino_rpg_data.ptf.brush.y - 1) * 11; stephino_rpg_data.ptf.paint( parseInt(jQuery(this).attr('grid-x'), 10), parseInt(jQuery(this).attr('grid-y'), 10), cellValue, true, true ); switch (cellValue) { case 1: stephino_rpg_tools.map.sound.manager.trigger('hudClose'); break; default: stephino_rpg_tools.map.sound.manager.trigger('cellTap'); break; } }); gridRow.append(gridCell); } stephino_rpg_data.ptf.objects.grid.append(gridRow); } jQuery(this) .append(stephino_rpg_data.ptf.objects.grid) .append(stephino_rpg_data.ptf.objects.hud) .append(stephino_rpg_data.ptf.objects.canvas); stephino_rpg_data.ptf.render(); break; case 'nav': if ("undefined" === typeof stephino_rpg_data.ptf) { break; } var navButton = jQuery(this); navButton.click(function() { switch (args[1]) { case 'w': stephino_rpg_data.ptf.pointer.y--; break; case 'a': stephino_rpg_data.ptf.pointer.x--; break; case 's': stephino_rpg_data.ptf.pointer.y++; break; case 'd': stephino_rpg_data.ptf.pointer.x++; break; } if (!navButton.hasClass('active')) { navButton.addClass('active'); window.setTimeout(function() {navButton.removeClass('active');}, 150); } stephino_rpg_data.ptf.render(); stephino_rpg_data.ptf.objects.grid.focus(); }); stephino_rpg_data.ptf.objects.grid.bind('keydown', function(event) { if (args[1] === `${event.key}`.toLowerCase()) { navButton.click(); } }).focus(); break; case 'brushes': if ("undefined" === typeof stephino_rpg_data.ptf) { break; } stephino_rpg_data.ptf.objects.brushes = jQuery('<div class="ptf-brushes"><div></div><span></span></div>'); var brushListObject = stephino_rpg_data.ptf.objects.brushes.children('div'); var brushDescObject = stephino_rpg_data.ptf.objects.brushes.children('span'); if ("object" === typeof modalData.data && null !== modalData.data) { jQuery.each(modalData.data, function(tileId, tileData) { var gridY = Math.floor((parseInt(tileId, 10) - 1) / 11) + 1; var gridX = parseInt(tileId, 10) - 11 * (gridY - 1); var bkgX = (1 - gridX) * stephino_rpg_data.ptf.tileSide; var bkgY = (1 - gridY) * stephino_rpg_data.ptf.tileSide; var brush = jQuery('<div></div>') .css('background-position', `${bkgX}px ${bkgY}px`) .attr('grid-x', gridX).attr('grid-y', gridY) .data('data', tileData) .click(function() { var brushData = jQuery(this).data('data'); stephino_rpg_data.ptf.brush = { x: parseInt(jQuery(this).attr('grid-x'), 10), y: parseInt(jQuery(this).attr('grid-y'), 10) }; brushListObject.children('div').removeClass('active'); jQuery(this).addClass('active'); brushDescObject.html(`<p><b>${brushData[0]}</b>: ${brushData[1]}</p>`); stephino_rpg_tools.map.sound.manager.trigger('dialogButton'); stephino_rpg_data.ptf.objects.grid.focus(); }); brushListObject.append(brush); if (1 === gridY && 1 === gridX) { brush.click(); } }); } jQuery(this) .append(stephino_rpg_data.ptf.objects.navigation) .append(stephino_rpg_data.ptf.objects.brushes); break; } } }, ptfCreatorResize: function() { do { if ("undefined" === typeof stephino_rpg_data.ptf) { break; } var newSize = { width: stephino_rpg_data.ptf.tileSetWidth, height: stephino_rpg_data.ptf.tileSetHeight }; switch (jQuery(this).attr('name')) { case 'ptf_width': newSize.width = parseInt(jQuery(this).val(), 10); if (newSize.width < stephino_rpg_data.ptf.gridWidth) { newSize.width = stephino_rpg_data.ptf.gridWidth; } break; case 'ptf_height': newSize.height = parseInt(jQuery(this).val(), 10); if (newSize.height < stephino_rpg_data.ptf.gridHeight) { newSize.height = stephino_rpg_data.ptf.gridHeight; } break; } var newTileSet = []; for (var tsY = 0; tsY < newSize.height; tsY++) { for (var tsX = 0; tsX < newSize.width; tsX++) { var newValue = 1; if (tsX < stephino_rpg_data.ptf.tileSetWidth && tsY < stephino_rpg_data.ptf.tileSetHeight) { newValue = stephino_rpg_data.ptf.tileSet[tsY * stephino_rpg_data.ptf.tileSetWidth + tsX]; } newTileSet.push(newValue); } } stephino_rpg_data.ptf.tileSet = newTileSet; stephino_rpg_data.ptf.tileSetWidth = newSize.width; stephino_rpg_data.ptf.tileSetHeight = newSize.height; if (stephino_rpg_data.ptf.pointer.x > stephino_rpg_data.ptf.tileSetWidth - stephino_rpg_data.ptf.gridWidth) { stephino_rpg_data.ptf.pointer.x = stephino_rpg_data.ptf.tileSetWidth - stephino_rpg_data.ptf.gridWidth; } if (stephino_rpg_data.ptf.pointer.y > stephino_rpg_data.ptf.tileSetHeight - stephino_rpg_data.ptf.gridHeight) { stephino_rpg_data.ptf.pointer.y = stephino_rpg_data.ptf.tileSetHeight - stephino_rpg_data.ptf.gridHeight; } stephino_rpg_data.ptf.render(); stephino_rpg_data.ptf.objects.grid.focus(); } while(false); }, ptfCreatorSave: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var ptfId = parseInt(args[0], 10); var ptfForm = jQuery(this).parents('.modal-body').find('[data-role="ptfForm"]'); stephino_rpg_tools.ajax('actionUserPtfSave', { ptfId: ptfId, ptfTileSet: stephino_rpg_tools.utils.getIntListZip(stephino_rpg_data.ptf.tileSet), ptfWidth: stephino_rpg_data.ptf.tileSetWidth, ptfHeight: stephino_rpg_data.ptf.tileSetHeight, ptfName: ptfForm.find('[name="ptf_name"]').val(), ptfVisibility: ptfForm.find('[name="ptf_visibility"]').val() }, function(msg) { if (msg.status) { stephino_rpg_tools.dialog.show('dialogUserArenaPlay', {commonArgs: [ptfId]}, null, null, true); } }); } }, ptfArenaList: function(args) { var objectItem = jQuery(this); var objectParent = objectItem.parents('.modal-body'); var objectListPage = objectParent.find('[data-role="arena-list-page"]') .html('<div class="loading"></div>') .attr('data-loaded', 'false'); var arenaPage = 1; if (jQuery.isArray(args) && args.length && objectItem.hasClass('page-link')) { arenaPage = parseInt(args[0], 10); if (arenaPage < 0) { arenaPage = 0; } } if (objectItem.is('button')) { objectItem.toggleClass('active'); } stephino_rpg_tools.ajax('dialogUserArenaListPage', { arenaCategory: objectParent.find('select[data-change="ptfArenaList"]').val(), arenaOrder: objectParent.find('button[data-click="ptfArenaList"]').hasClass('active'), arenaPage: arenaPage, arenaAuthorId: parseInt(objectListPage.attr('data-author'), 10) }, function(msg) { if (!msg.status) { msg.content = '<span class="badge badge-danger mb-2 p-2 w-100 text-center">' + msg.result + '</span>'; } objectListPage.attr('data-loaded', 'true'); objectListPage.html(msg.content); stephino_rpg_tools.dialog._coreActionsHandler(objectListPage); }); }, ptfArenaDelete: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var ptfId = parseInt(args[0], 10); stephino_rpg_tools.ajax('actionUserPtfDelete', { ptfId: ptfId }, function(msg) { if (msg.status) { stephino_rpg_tools.dialog._coreActions.goBack(); } }); } }, ptfArenaReview: function(args) { if (jQuery.isArray(args) && 3 === args.length) { var ptfId = parseInt(args[0], 10); var ptfReview = `${args[1]}`.replace(/\W+/g, ''); var ptfAuthor = parseInt(args[2], 10); var ptfVisibility = ptfReview.match(/^[pas]$/ig) || 0 === ptfAuthor ? 'l' : 'p'; var objectOption = jQuery(this); var objectParent = objectOption.parents('.dropdown-menu'); var objectLabelsVis = objectOption.parents('.modal-body').find('[data-role="ptf-visibility"]'); var objectLabelsRev = objectOption.parents('.modal-body').find('[data-role="ptf-review"]'); if (!isNaN(ptfId) && ptfId > 0 && ptfReview.length && !objectOption.hasClass('active')) { stephino_rpg_tools.ajax('actionUserPtfReview', { ptfId: ptfId, ptfReview: ptfReview }, function(msg) { if (msg.status) { objectParent.find('.dropdown-item').removeClass('active'); objectOption.addClass('active'); if (objectLabelsVis.length) { objectLabelsVis.children('[data-vis]').removeClass('d-inline-block'); if ('l' !== ptfVisibility || 'a' !== ptfReview) { objectLabelsVis.children('[data-vis="' + ptfVisibility + '"]').addClass('d-inline-block'); } } if (objectLabelsRev.length) { objectLabelsRev.children('[data-rev]').removeClass('d-inline-block'); if ('l' !== ptfVisibility || 'a' !== ptfReview) { objectLabelsRev.children('[data-rev="' + ptfReview + '"]').addClass('d-inline-block'); } } } }); } } }, pwaInstall: function() { var holder = jQuery(this).html(''); var txtInstall = holder.attr('data-txt-install'); var txtPrepare = holder.attr('data-txt-prepare'); if ('string' === typeof txtInstall && txtInstall.length && 'string' === typeof txtPrepare && txtPrepare.length) { var button = jQuery('<button class="btn btn-danger w-100"></button>'); if (null !== stephino_rpg_tools.pwa.prompt) { button.append(jQuery('<span></span>').html(txtInstall)).click(function() { stephino_rpg_tools.pwa.prompt.prompt(); stephino_rpg_tools.pwa.prompt.userChoice.then(function(choiceResult) { if (choiceResult.outcome === 'accepted') { stephino_rpg_tools.pwa.prompt = null; stephino_rpg_tools.toast.show(stephino_rpg_data.i18n.pwa_installed, true, 5000); button.remove(); } }); }); holder.append(button); } else { if ('https:' === location.protocol) { var insideIframe = true; try { insideIframe = (top.location.href !== self.location.href); } catch (e) {} if (insideIframe) { button.append(jQuery('<span></span>').html(txtPrepare)).click(function() { try { top.location.href = self.location.href; } catch (e) {} }); holder.append(button); } } } } }, parallax: function(args) { if (jQuery.isArray(args) && 2 === args.length) { var parallaxObject = jQuery(this); var backgroundImage = 'changelog' === args[0] ? `${stephino_rpg_data.res_url}/ui/img/changelog.png?ver=${stephino_rpg_data.game_ver.replace(/[^\w\.]+/g, '.')}` : stephino_rpg_tools.media.getUrl( stephino_rpg_data.is_pro ? `img/story/${args[0]}/${args[1]}/768.png` : `img/ui/768.png` ); jQuery('<img/>').on('load', function() { var cssObject = {backgroundImage: `url("${backgroundImage}")`}; parallaxObject.addClass('ready').css(cssObject) .append(jQuery('<div class="before"></div>').css(cssObject)) .append(jQuery('<div class="after"></div>').css(cssObject)); }).attr('src', backgroundImage); } }, countdownTime: function(args) { var timeLeft = parseInt(args[0], 10); var timeTotal = parseInt(args[1], 10); var spanObject = jQuery(this); var endAction = function() { spanObject.html('&#8230;'); stephino_rpg_tools.heartbeat.run(); window.setTimeout(function() { stephino_rpg_tools.dialog.refresh(); }, 2000); }; var counter = function() { spanObject.html(stephino_rpg_tools.utils.secondsGM(timeLeft)); timeLeft--; if (timeLeft >= 0) { stephino_rpg_tools.dialog.setTimer(function() { counter(); }, 1000); } else { endAction(); } }; if (timeTotal > 0 && timeLeft >= 0 && spanObject.length) { counter(); } else { endAction(); } }, countdownBar: function(args) { jQuery(this).attr('data-ui', 'loading-bar').html('<b></b><i></i><span></span>'); if (jQuery.isArray(args) && 2 === args.length) { var timeLeft = parseInt(args[0], 10); var timeTotal = parseInt(args[1], 10); var barObject = jQuery(this).find('i'); var endAction = function() { window.setTimeout(function() { stephino_rpg_tools.heartbeat.run(); }, 3000); stephino_rpg_tools.dialog.setTimer(function() { stephino_rpg_tools.dialog.refresh(); }, 5000); }; var counter = function() { var remainingUnit = timeTotal > 0 ? (timeTotal - timeLeft) / timeTotal : 1; barObject.css({transform: 'scaleX(' + (remainingUnit).toFixed(4) + ')'}); timeLeft--; if (timeLeft >= 0) { stephino_rpg_tools.dialog.setTimer(function() { counter(); }, 1000); } else { endAction(); } }; if (timeTotal > 0 && timeLeft >= 0) { counter(); } else { endAction(); } } }, staticBar: function(args) { jQuery(this).attr('data-ui', 'loading-bar').html('<b></b><i></i><span><input type="hidden"/></span>'); if (jQuery.isArray(args) && 2 === args.length) { var inputObject = jQuery(this).find('input'); var valueCurrent = parseInt(args[0], 10); var valueMax = parseInt(args[1], 10); var barObject = jQuery(this).find('i'); barObject.css({transform: 'scaleX(' + (valueCurrent / valueMax).toFixed(4) + ')'}); inputObject.val(valueCurrent).change(function() { valueCurrent = parseInt(jQuery(this).val(), 10); if (valueCurrent > valueMax) { valueCurrent = valueMax; } barObject.css({transform: 'scaleX(' + (valueCurrent / valueMax).toFixed(4) + ')'}); }); } }, charCounter: function() { var inputObject = jQuery(this); var counterObject = jQuery('<span class="char-counter"></span>'); var counterMax = parseInt(inputObject.attr('maxlength'), 10); if ('number' !== typeof counterMax || counterMax < 1) { counterMax = null; } var showLength = function() { var inputValue = inputObject.val(); counterObject.html( inputValue.length + (null !== counterMax ? ('<b>/' + counterMax + '</b>'): '') ); if (null !== counterMax && inputValue.length > counterMax) { inputObject.val(inputValue.substring(0, counterMax - 1)); } }; inputObject.unbind('keyup').on('keyup', showLength); counterObject.insertAfter(inputObject); showLength(); }, typewriter: function(args, data) { var textObject = jQuery(this); if (jQuery.isArray(args) && args.length) { var children = textObject.find(args.join(',')); if (children.length) { var timeout = 0; jQuery.each(children, function() { timeout += 500; var child = jQuery(this).attr('data-effect', 'typewriter'); window.setTimeout(function() { stephino_rpg_tools.dialog._coreActions.typewriter.call(child, [], data); }, timeout); }); textObject.removeAttr('data-effect'); textObject.removeAttr('data-effect-args'); return; } } var textHtml = textObject.html(); var textHtml = textObject.html(); var stateMachine = { current: 0, next: function() { if (0 === stateMachine.current) { textObject.html('').addClass('active'); } stateMachine.current++; if (textObject.length) { textObject.html(textHtml.substring(0, stateMachine.current)); if (stateMachine.current < textHtml.length) { window.setTimeout(stateMachine.next, 30); } else { window.setTimeout(function(){ textObject.addClass('done'); }, 2000); } } } }; stateMachine.next(); }, help: function(args) { if (jQuery.isArray(args) && 2 === args.length) { jQuery(this).click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog._coreActions.helpDialog(args); return false; }); } }, helpDialog: function(args) { if (jQuery.isArray(args) && 2 === args.length) { stephino_rpg_tools.dialog.show('dialogHelpMenu', { itemType: args[0], itemId: args[1] }); } }, helpMenuItem: function(args) { if (jQuery.isArray(args) && 2 === args.length) { var contentObject = jQuery(this).parents('.modal-body').find('[data-role="content"]'); var menuObject = jQuery(this).parents('.modal-body').find('#menu'); if (menuObject.length && contentObject.length) { var menuItem = menuObject.find('[data-effect-args="' + args[0] + ',' + args[1] + '"]'); var menuItemParent = menuItem.parents('.card').find('[aria-expanded]'); jQuery(this).click(function(event) { event.preventDefault(); event.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('cellTap'); if (menuItem.hasClass('active')) { return; } if ('true' !== menuItemParent.attr('aria-expanded')) { menuItemParent.click(); } menuObject.find('li').removeClass('active'); menuItem.addClass('active'); stephino_rpg_tools.ajax('dialogHelpItem', { itemType: args[0], itemId: args[1] }, function(msg) { if (msg.status) { contentObject.html(msg.content); stephino_rpg_tools.dialog._coreActionsHandler(contentObject); } else { contentObject.html('<div class="alert alert-danger">' + msg.result + '</div>'); } contentObject.find('[title]').tooltip({ container: stephino_rpg_tools.dialog._objects.modal[0] }); stephino_rpg_tools.dialog._objects.modal[0].scrollTo({top: 0, behavior: 'smooth'}); }); }); } } }, logo: function() { jQuery(this).css({ backgroundImage: 'url("' + stephino_rpg_tools.media.getUrl('img/ui/512.png') + '")' }); }, video: function(args) { if (jQuery.isArray(args) && args.length >= 2) { if ("undefined" === typeof args[2]) { args[2] = 512; } var holderObject = jQuery(this); holderObject.append('<div data-role="spinner"></div>'); var videoObject = jQuery('<video></video>') .attr('autoplay', true) .attr('loop', true) .attr('playsinline', true) .attr('width', args[2]) .attr('height', args[2]) .on('loadeddata', function() { holderObject.attr('data-loaded', 'true').append(videoObject); videoObject[0].play(); }); videoObject.append(jQuery('<source type="video/mp4" />').attr('src', stephino_rpg_tools.media.getUrl('img/story/' + args[0] + '/' + args[1] + '/' + args[2] + '.mp4') )); } }, background: function(args) { if (jQuery.isArray(args) && args.length >= 2) { if ("undefined" === typeof args[2]) { args[2] = '512'; } var backgroundObject = jQuery(this); var backgroundImage = stephino_rpg_tools.media.getUrl('img/story/' + args[0] + '/' + args[1] + '/' + args[2] + '.png'); jQuery('<img/>').on('load', function() { var cssObject = {backgroundImage: `url("${backgroundImage}")`}; backgroundObject.addClass('ready').css(cssObject); }).attr('src', backgroundImage); } }, multiRange: function(args, data) { var rangeObject = jQuery(this); var rangeAttrRangeParent = rangeObject.attr('data-range-parent'); var rangeAttrRangeRatio = rangeObject.attr('data-range-ratio'); if ("undefined" !== typeof rangeAttrRangeParent && "undefined" !== typeof rangeAttrRangeRatio) { var objectParent = rangeObject.parents('[data-role="' + rangeAttrRangeParent + '"]'); if (objectParent.length) { var rangeAttrRangeSubmit = objectParent.attr('data-range-submit'); var rangeAttrRangePreviewBar = objectParent.attr('data-range-preview-bar'); var rangeAttrRangePreviewLabel = objectParent.attr('data-range-preview-label'); var objectSubmit = "undefined" === typeof rangeAttrRangeSubmit ? [] : objectParent.find('[data-click="' + rangeAttrRangeSubmit + '"]'); var objectPreviewInput = "undefined" === typeof rangeAttrRangePreviewBar ? [] : objectParent.find('[data-role="' + rangeAttrRangePreviewBar + '"] input'); var objectPreviewLabel = "undefined" === typeof rangeAttrRangePreviewLabel ? [] : objectParent.find('[data-role="' + rangeAttrRangePreviewLabel + '"]'); var countSelf = parseInt(rangeObject.val(), 10); var countRatio = parseFloat(rangeAttrRangeRatio); var amountSelf = Math.round(countSelf * countRatio, 0); var amountMax = ("undefined" === typeof objectParent.attr('data-range-max') ? null : parseInt(objectParent.attr('data-range-max'), 10)); var amountOThers = 0; jQuery.each(objectParent.find('input[type="range"]').not(rangeObject), function() { amountOThers += Math.round(parseInt(jQuery(this).val(), 10) * parseFloat(jQuery(this).attr('data-range-ratio')), 0); }); if (null !== amountMax && amountSelf + amountOThers > amountMax) { countSelf = Math.floor((amountMax - amountOThers) / countRatio, 0); amountSelf = Math.floor(countSelf * countRatio, 0); rangeObject.val(countSelf).rangeslider('update', true); } if (objectPreviewInput.length) { objectPreviewInput.val(amountSelf + amountOThers).change(); } if (objectPreviewLabel.length) { objectPreviewLabel.html(stephino_rpg_tools.utils.isuFormat(amountSelf + amountOThers)).removeAttr('title').tooltip('dispose'); if (Math.abs(amountSelf + amountOThers) >= 1000) { objectPreviewLabel.attr( 'title', '<b>' + stephino_rpg_tools.php.number_format(amountSelf + amountOThers) + '</b>' ).tooltip({ container: stephino_rpg_tools.dialog._objects.modal[0], html: true }).tooltip('update'); } } if (objectSubmit.length) { if (amountSelf + amountOThers <= 0) { !objectSubmit.hasClass('d-none') && objectSubmit.addClass('d-none'); } else { objectSubmit.hasClass('d-none') && objectSubmit.removeClass('d-none'); } } } } var rangeAttrCallback = rangeObject.attr('data-range-callback'); if ('string' === typeof rangeAttrCallback && 'function' === typeof stephino_rpg_tools.dialog.actions[rangeAttrCallback]) { stephino_rpg_tools.dialog.actions[rangeAttrCallback].call(rangeObject, args, data); } }, premiumPackageBuy: function(args) { if (jQuery.isArray(args) && 2 === args.length) { var packageId = args[0]; var packageCurrency = args[1]; jQuery(this).parents('[data-role="premium-packages"]').find('button').attr('disabled', 'disabled'); stephino_rpg_tools.toast.show(stephino_rpg_data.i18n.paypal_preparing); stephino_rpg_tools.ajax('actionPremiumPackageBuy', { packageId: packageId, packageCurrency: packageCurrency }, function(msg) { if (msg.status) { stephino_rpg_tools.toast.show(msg.content); } if ("string" === typeof msg.result.data) { window.setTimeout(function() { window.location.href = msg.result.data; }, 1000); } else { stephino_rpg_tools.dialog.refresh(); } }); } }, premiumModifierPreview: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var modifierId = parseInt(args[0], 10); if (isFinite(modifierId) && modifierId > 0) { var rangeObject = jQuery(this); var parentObject = jQuery(this).parents('[data-role="premium-modifier"]'); if (parentObject.length) { var detailsObject = parentObject.find('[data-role="premium-modifier-details"]'); stephino_rpg_tools.ajax('actionPremiumModifierPreview', { modifierId: modifierId, modifierCount: parseInt(rangeObject.val(), 10) }, function(msg) { if (msg.status) { detailsObject.html(msg.content); stephino_rpg_tools.dialog._coreActionsHandler(detailsObject); } else { detailsObject.html('<div class="alert alert-danger">' + msg.result + '</div>'); } detailsObject.find('[title]').tooltip({ container: stephino_rpg_tools.dialog._objects.modal[0] }); }); } } } }, premiumModifierBuy: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var rangeObject = jQuery(this).parents('[data-role="premium-modifier"]').find('input[type="range"]'); if (rangeObject.length) { var modifierId = parseInt(args[0], 10); if (isFinite(modifierId) && modifierId > 0) { stephino_rpg_tools.ajax('actionPremiumModifierBuy', { modifierId: modifierId, modifierCount: parseInt(rangeObject.val(), 10) }, function(msg) { if (msg.status) { stephino_rpg_tools.toast.show(msg.content); } stephino_rpg_tools.dialog.refresh(); }); } } } }, sign: function() { var signature = jQuery(this); !signature.hasClass('signature') && signature.addClass('signature'); signature.hasClass('signed') && signature.removeClass('signed'); stephino_rpg_tools.dialog.setTimer(function(){ signature.addClass('signed'); }, 500); }, settingsDeleteAccount: function() { stephino_rpg_tools.dialog.show('dialogSettingsDeleteAccount', {}, function() { var deleteButton = this.modalContent.find('[data-role="delete"]'); var confirmInput = this.modalContent.find('input[name="confirm"]'); if (deleteButton.length && confirmInput.length) { deleteButton.click(function() { if (confirmInput.val().match(/confirm/ig)) { stephino_rpg_tools.ajax('actionAccountDelete', {}, function(msg) { if (msg.status) { stephino_rpg_tools.toast.show(stephino_rpg_data.i18n.acc_del_toast); window.setTimeout(function() { window.location.reload(); }, 2500); } }); } else { stephino_rpg_tools.toast.show(stephino_rpg_data.i18n.acc_del_confirm.replace('%s', '<b>CONFIRM</b>'), false); } }); } }); }, settingsLogOut: function() { stephino_rpg_tools.ajax('actionAccountLogOut', {}, function(msg) { if (msg.status) { stephino_rpg_tools.messages.collapse(); stephino_rpg_tools.tutorial.collapse(); stephino_rpg_tools.chat.collapse(); stephino_rpg_tools.dialog.show(null, { result: {title: `Stephino RPG - ${stephino_rpg_data.app_name}`}, content: `<div class="col-12 p-2"> <div class="advisor"></div> <div class="card card-body bg-dark"> ${stephino_rpg_data.i18n.acc_logout} </div> </div>` }); window.setTimeout(function() {window.location.reload();}, 2500); } }); }, settingsUpdate: function() { var inputObject = jQuery(this); var inputName = inputObject.attr('name'); var inputValue = inputObject.val(); switch (inputName) { case 'vol_music': case 'vol_bkg': case 'vol_cells': case 'vol_events': stephino_rpg_tools.map.sound.manager.setMasterVolume.object(inputName, inputValue); break; } stephino_rpg_tools.ajax('actionSettingsUpdate', {key: inputName, value: inputValue}, function(msg) { if (msg.status) { switch (inputName) { case 'nickname': case 'description': inputObject.val(msg.result.data).keyup(); break; } } }); }, settingsShowConsole: function() { stephino_rpg_tools.console.show(); stephino_rpg_tools.dialog.hide(); }, settingsChangePassword: function() { var buttonObject = jQuery(this); var inputObject = jQuery(this).siblings('input'); stephino_rpg_tools.ajax('actionSettingsPassword', {password: inputObject.val()}, function(msg) { if (msg.status) { stephino_rpg_tools.toast.show(msg.result); inputObject.attr('type', 'password').attr('disabled', 'disabled'); buttonObject.remove(); } }); }, settingsSetLanguage: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var userLanguage = args[0]; if (userLanguage.length) { stephino_rpg_tools.dialog.hide(); stephino_rpg_tools.ajax('actionSettingsLanguage', { language: userLanguage }, function(msg) { if (msg.status) { window.location.reload(); } }); } } }, resource: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var currentCityId = parseInt(jQuery('[data-role="map-holder"]').attr('city-id'), 10); if (!isFinite(currentCityId) || currentCityId <= 0) { currentCityId = null; } stephino_rpg_tools.map.sound.manager.trigger('cellTap'); stephino_rpg_tools.dialog.show('dialogSettingsResources', { cityId: currentCityId, resKey: args[0] }); } }, messageRead: function(args) { if (jQuery.isArray(args) && 2 === args.length) { var messageType = args[0]; var messageId = args[1]; var messageObject = jQuery(this); var frameObject = messageObject.parents('.message'); var contentObject = messageObject.parents('.row').find('[data-role="message-content"]'); if ("undefined" === typeof messageObject.attr('data-original-text')) { messageObject.attr('data-original-text', messageObject.children('span').html()); } if ('true' !== contentObject.attr('message-loaded')) { stephino_rpg_tools.ajax('dialogMessagesRead', { messageType: messageType, messageId: messageId }, function(msg) { messageObject.children('span').html(stephino_rpg_data.i18n.msg_close); if (frameObject.hasClass('active')) { frameObject.removeClass('active'); } if (!msg.status) { msg.content = '<span class="badge badge-danger mb-2 p-2 w-100 text-center">' + msg.result + '</span>'; } contentObject.css({display: 'none'}).html(msg.content); contentObject.slideDown(100, function(){ contentObject.attr('message-loaded', 'true'); stephino_rpg_tools.dialog._coreActionsHandler(contentObject); }); }); } else { messageObject.children('span').html(messageObject.attr('data-original-text')); contentObject.slideUp(100, function(){ contentObject.html(''); contentObject.attr('message-loaded', 'false'); }); } } }, messageDelete: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var messageId = parseInt(args[0], 10); var rowObject = jQuery(this).parents('.row'); var messagesTotal = jQuery(this).parents('[data-role="message-holder"]').children('.message').length; rowObject.slideUp(function() { rowObject.remove(); }); stephino_rpg_tools.ajax('actionMessageDelete', { messageId: messageId }, function() { jQuery('.modal [role="tooltip"]').remove(); if (messagesTotal <= 1) { stephino_rpg_tools.dialog.refresh(); } }); } }, messageDeleteAll: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var messageType = args[0]; var messageElements = jQuery(this).parents('[data-role="message-holder"]').children('div'); 'd' !== messageType && messageElements.slideUp(function() { messageElements.remove(); }); stephino_rpg_tools.ajax('actionMessageDeleteAll', { messageType: messageType }, function() { 'd' === messageType ? stephino_rpg_tools.dialog.refresh() : stephino_rpg_tools.dialog.hide(); }); } }, messageList: function(args) { if (jQuery.isArray(args) && args.length) { stephino_rpg_tools.dialog.show('dialogMessagesList', { messageType: jQuery(this).parents('.modal-body').find('[data-msg-type]').attr('data-msg-type'), messagePage: parseInt(args[0], 10) }); } }, sentryCustomizer: function(args, modalData) { if (jQuery.isArray(args) && args.length && 'save' == args[0]) { if ("object" === typeof stephino_rpg_data.sentryDefinition && null !== stephino_rpg_data.sentryDefinition) { var buttonObject = jQuery(this); buttonObject.attr('data-text', buttonObject.text()).children('span').html('...'); var canvas = jQuery('<canvas></canvas>')[0]; var canvasContext = canvas.getContext('2d'); canvasContext.canvas.width = 512; canvasContext.canvas.height = 512; var stateMachine = { current: 0, data: Object.keys(stephino_rpg_data.sentryDefinition).sort(), step: function() { if (stateMachine.current < stateMachine.data.length) { var sentryIndex = stateMachine.data[stateMachine.current]; var sentryId = stephino_rpg_data.sentryDefinition[sentryIndex]; stateMachine.current++; if ("undefined" !== typeof sentryId) { var sentryImage = new Image(); sentryImage.onload = function() { canvasContext.drawImage(sentryImage, 0, 0); stateMachine.step(); }; sentryImage.src = stephino_rpg_tools.media.getUrl(`img/ui/sentries/${sentryIndex}/${sentryId}.png`); } else { stateMachine.step(); } } else { stateMachine.end(); } }, end: function() { stephino_rpg_tools.ajax('actionSentryCustomize', { sentryImage: canvas.toDataURL(), sentryDefinition: stephino_rpg_data.sentryDefinition }, function(msg) { canvasContext.clearRect(0,0,512,512); if (msg.status) { stephino_rpg_tools.dialog._coreActions.goBack(); } buttonObject.removeAttr('disabled').children('span').html(buttonObject.attr('data-text')); }); } }; stateMachine.step(); } } else { var objectCustomizer = jQuery(this).attr('data-customizer', 'true') .attr('tabindex', '1') .focus(); var preview = { _internal: { object: null, assets: {}, current: { index: 1, id: 1 }, }, init: function(data) { if (null === preview._internal.object) { if (jQuery.isArray(data) && 2 === data.length) { if (null !== data[0] && "object" === typeof data[0]) { preview._internal.assets = data[0]; } if (null !== data[1] && "object" === typeof data[1]) { stephino_rpg_data.sentryDefinition = data[1]; } } preview._internal.object = jQuery('<div class="sentry-preview"></div>'); jQuery.each(preview._internal.assets, function (index, indexIDs) { var indexLayer = jQuery('<div></div>') .css('z-index', index) .attr('data-index', index); preview._internal.object.append(indexLayer); var defIndexId = 1; if ("undefined" !== typeof stephino_rpg_data.sentryDefinition[index]) { if (jQuery.isArray(indexIDs) && -1 !== indexIDs.indexOf(stephino_rpg_data.sentryDefinition[index])) { defIndexId = stephino_rpg_data.sentryDefinition[index]; } } preview.load(index, defIndexId); }); preview._internal.object.find('[data-index]').removeClass('active'); preview._internal.object.find(`[data-index="${preview._internal.current.index}"]`).addClass('active'); objectCustomizer.append(preview._internal.object).focus(); } }, load: function(sentryIndex, sentryId) { stephino_rpg_data.sentryDefinition[sentryIndex] = parseInt(sentryId, 10); var backgroundObject = preview._internal.object.find(`[data-index="${sentryIndex}"]`); if (backgroundObject.length) { backgroundObject.removeClass('ready'); var backgroundImage = stephino_rpg_tools.media.getUrl(`img/ui/sentries/${sentryIndex}/${sentryId}.png`) + '&ver=' + stephino_rpg_data.game_ver; jQuery('<img/>').on('load', function() { backgroundObject.addClass('ready').css({ backgroundImage: `url("${backgroundImage}")`, zIndex: sentryIndex }); }).attr('src', backgroundImage); } }, index: { change: function(goUp) { var knownIndexes = Object.keys(preview._internal.assets); var key = knownIndexes.indexOf(`${preview._internal.current.index}`); key = key + (goUp ? 1 : -1); key = key < 0 ? (knownIndexes.length - 1) : (key >= knownIndexes.length ? 0 : key); preview._internal.current.index = knownIndexes[key]; preview._internal.object.find('[data-index]').removeClass('active'); preview._internal.object.find(`[data-index="${knownIndexes[key]}"]`).addClass('active'); } }, id: { change: function(goRight) { var knownIDs = jQuery.isArray(preview._internal.assets[preview._internal.current.index]) ? preview._internal.assets[preview._internal.current.index] : []; if (knownIDs.length) { var key = knownIDs.indexOf(preview._internal.current.id); key = key + (goRight ? 1 : -1); key = key < 0 ? (knownIDs.length - 1) : (key >= knownIDs.length ? 0 : key); preview._internal.current.id = knownIDs[key]; preview.load(preview._internal.current.index, preview._internal.current.id); } } } }; preview.init(modalData.data); var objectsNavigation = { navTop: 'w', navLeft: 'a', navBottom: 's', navRight: 'd', }; jQuery.each(objectsNavigation, function(navObjKey, navObjLetter) { var navObject = jQuery('<div class="sentry-nav"></div>') .addClass(`sentry-nav-${navObjLetter}`) .attr("data-nav", navObjLetter) .html(navObjLetter) .click(function() { !navObject.hasClass('active') && navObject.addClass('active'); window.setTimeout(function() { navObject.hasClass('active') && navObject.removeClass('active') }, 250); switch (jQuery(this).attr('data-nav')) { case 'w': preview.index.change(true); break; case 'a': preview.id.change(); break; case 's': preview.index.change(); break; case 'd': preview.id.change(true); break; } }); objectCustomizer.append(navObject); objectsNavigation[navObjKey] = navObject; }); objectCustomizer.bind('keydown', function(event) { objectCustomizer.find(`[data-nav="${`${event.key}`.toLowerCase()}"]`).click(); objectCustomizer.focus(); }).focus(); } }, sentryRename: function() { var inputElement = jQuery(this); stephino_rpg_tools.ajax('actionSentryRename', { sentryName: inputElement.val() }, function(msg) { if (msg.status && null !== msg.result && 'string' === typeof msg.result.user_sentry_name) { inputElement.val(msg.result.user_sentry_name).keyup(); } }); }, sentryChallengeList: function(args) { if (jQuery.isArray(args) && args.length) { stephino_rpg_tools.dialog.show('dialogSentryChallengeList', { sentryChallenge: jQuery(this).parents('.modal-body').find('[data-sentry-challenge-type]').attr('data-sentry-challenge-type'), sentryChallengePage: parseInt(args[0], 10) }); } }, sentryChallengePrepare: function(args) { if (jQuery.isArray(args) && args.length) { stephino_rpg_tools.dialog.show('dialogSentryChallengePrepare', { sentryChallengeUserId: parseInt(args[0], 10), sentryChallenge: "string" === typeof args[1] ? args[1] : null }); } }, sentryChallengeStart: function(args) { if (jQuery.isArray(args) && args.length) { stephino_rpg_tools.ajax('actionSentryChallengeStart', { sentryChallengeUserId: parseInt(args[0], 10), sentryChallenge: "string" === typeof args[1] ? args[1] : null }, function(msg) { if (msg.status) { stephino_rpg_tools.dialog.show('dialogSentryInfo', {}, null, null, true, true); } }); } }, sentryBackground: function(args) { if (jQuery.isArray(args) && args.length) { var sentryId = parseInt(args[0], 10); var sentryVersion = "undefined" !== args[1] ? parseInt(args[1], 10) : 1; var loadTimeout = "undefined" !== args[2] ? parseInt(args[2], 10) : 0; if (!isNaN(sentryId)) { var backgroundObject = jQuery(this); var backgroundImage = stephino_rpg_tools.media.getUrl(`sentries/${sentryId}.png`) + `&ver=${sentryVersion}`; jQuery('<img/>').on('load', function() { var cssObject = {backgroundImage: `url("${backgroundImage}")`}; window.setTimeout( function() { backgroundObject.addClass('ready').css(cssObject); }, !isNaN(loadTimeout) && loadTimeout > 0 ? loadTimeout : 0 ); }).attr('src', backgroundImage); } } }, sentryVs: function(args) { if (jQuery.isArray(args) && args.length >= 4) { var ourUserId = parseInt(args[0], 10); var ourSentryVersion = parseInt(args[1], 10); var opponentUserId = parseInt(args[2], 10); var opponentSentryVersion = parseInt(args[3], 10); var loadDelay = "undefined" === typeof args[4] ? true : 1 === parseInt(args[4], 10); if (!isNaN(ourUserId) && !isNaN(opponentUserId)) { var sentryObject = jQuery(this); var ourIcon = jQuery('<div class="sentry-icon"></div>'); var opponentIcon = jQuery('<div class="sentry-icon"></div>'); sentryObject.append(ourIcon).append(opponentIcon); stephino_rpg_tools.dialog._coreActions.sentryBackground.call(ourIcon, [ourUserId, ourSentryVersion, loadDelay ? 500 : 0]); stephino_rpg_tools.dialog._coreActions.sentryBackground.call(opponentIcon, [opponentUserId, opponentSentryVersion, loadDelay ? 1000 : 0]); window.setTimeout(function() { sentryObject.addClass('ready'); }, loadDelay ? 1000 : 0); } } }, userToggleGm: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var userId = parseInt(args[0], 10); stephino_rpg_tools.ajax('actionUserToggleGm', { userId: userId }, function() { stephino_rpg_tools.dialog.refresh(); }); } }, userViewProfile: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var userId = parseInt(args[0], 10); stephino_rpg_tools.dialog.show('dialogUserInfo', { userId: userId }); } }, userSendMessage: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var messageButton = jQuery(this); var messageParent = jQuery(this).parent(); var messageSubject = messageParent.find('[name="message-subject"]'); var messageContent = messageParent.find('[name="message-content"]'); var labelSuccess = messageParent.find('[data-role="label-success"]'); var labelError = messageParent.find('[data-role="label-error"]'); !labelSuccess.hasClass('d-none') && labelSuccess.addClass('d-none'); !labelError.hasClass('d-none') && labelError.addClass('d-none'); var messageSubjectText = messageSubject.val().trim(); var messageContentText = messageContent.val().trim(); stephino_rpg_tools.ajax('actionMessageCreate', { messageTo: args[0], messageSubject: messageSubjectText, messageContent: messageContentText }, function(msg) { if (msg.status) { labelSuccess.removeClass('d-none'); messageSubject.slideUp(100); messageContent.slideUp(100); messageButton.slideUp(100); } else { labelError.html(msg.result).removeClass('d-none'); } }); } }, userTradePreview: function(args) { if (jQuery.isArray(args) && 2 === args.length) { var tradeRatio = parseFloat(args[0]); var tradeType = args[1]; if (tradeRatio > 0) { var parentObject = jQuery(this).parents('[data-role="trading"]'); var tradeButton = parentObject.find('[data-click="userTrade"]'); var previewGem = parentObject.find('[data-role="preview-gem"]'); var previewResource = parentObject.find('[data-role="preview-' + tradeType + '"]'); var valueGem = parseInt(jQuery(this).val(), 10); var valueResource = valueGem * tradeRatio; previewGem.html(stephino_rpg_tools.php.number_format(valueGem, 2)); previewResource.html(stephino_rpg_tools.php.number_format(valueResource, 2)); if (valueResource > 0) { tradeButton.hasClass('d-none') && tradeButton.removeClass('d-none'); } else { !tradeButton.hasClass('d-none') && tradeButton.addClass('d-none'); } } } }, userTrade: function(args) { if (jQuery.isArray(args) && 1 === args.length) { var tradeType = args[0]; var rangeObject = jQuery(this).parents('[data-role="trading"]').find('input[type="range"]'); if (rangeObject.length) { var gem = parseInt(rangeObject.val(), 10); if (gem > 0) { stephino_rpg_tools.ajax('actionUserTrade', { tradeGem: gem, tradeType: tradeType }, function(msg) {}); } stephino_rpg_tools.dialog.hide(); } } }, cityAttackPrepareButton: function(args) { if (jQuery.isArray(args) && 1 === args.length) { stephino_rpg_tools.dialog.show('dialogAttackPrepare', { defCityId: parseInt(args[0], 10) }); } }, cityAttackPayloadChange: function() { var parentObject = jQuery(this).parents('[data-role="attacking-city"]'); if (parentObject.length) { var rangeObjects = parentObject.find('input[type="range"]'); var submitButton = parentObject.find('[data-click="cityAttackReviewButton"]'); var statsObject = parentObject.find('[data-role="army-stats"]'); var armySize = 0; var armyTroopCapacity = 0; var armyTroopMass = 0; var armyLootBox = 0; var armyPointsAttack = 0; var armyPointsDefense = 0; jQuery.each(rangeObjects, function(k,v) { var entityObject = jQuery(v); var entityCount = parseInt(entityObject.val(), 10); armySize += entityCount; armyTroopCapacity += entityCount* parseInt(entityObject.attr('data-troop-capacity')); armyTroopMass += entityCount* parseInt(entityObject.attr('data-troop-mass')); armyLootBox += entityCount* parseInt(entityObject.attr('data-loot-box')); armyPointsAttack += entityCount* parseInt(entityObject.attr('data-points-attack')); armyPointsDefense += entityCount* parseInt(entityObject.attr('data-points-defense')); }); var armyTroopSpeed = (armyTroopCapacity >= armyTroopMass ? 100 : 50); if (armySize <= 0) { !statsObject.hasClass('d-none') && statsObject.addClass('d-none'); !submitButton.hasClass('d-none') && submitButton.addClass('d-none'); } else { statsObject.find('[data-update="data-troop-capacity"]').html(stephino_rpg_tools.php.number_format(armyTroopCapacity) + ' kg'); statsObject.find('[data-update="data-troop-mass"]').html(stephino_rpg_tools.php.number_format(armyTroopMass) + ' kg'); statsObject.find('[data-update="data-troop-speed"]').html(armyTroopSpeed + '%'); statsObject.find('[data-update="data-loot-box"]').html(stephino_rpg_tools.php.number_format(armyLootBox)); statsObject.find('[data-update="data-points-attack"]').html(stephino_rpg_tools.php.number_format(armyPointsAttack)); statsObject.find('[data-update="data-points-defense"]').html(stephino_rpg_tools.php.number_format(armyPointsDefense)); statsObject.hasClass('d-none') && statsObject.removeClass('d-none'); submitButton.hasClass('d-none') && submitButton.removeClass('d-none'); } } }, cityAttackReviewButton: function(args) { if(jQuery.isArray(args) && 2 === args.length) { var attArmy = {}; jQuery.each(jQuery(this).parents('[data-role="attacking-city"]').find('input[type="range"]'), function(k, item) { if (jQuery(item).val() > 0) { attArmy[jQuery(item).attr('name')] = jQuery(item).val(); } }); stephino_rpg_tools.dialog.show('dialogAttackReview', { attCityId: parseInt(args[0], 10), defCityId: parseInt(args[1], 10), army: attArmy }); } }, cityAttackButton: function(args) { if(jQuery.isArray(args) && 2 === args.length) { var attArmy = {}; jQuery.each(jQuery(this).parents('[data-modal-method]').find('[data-role="entity"]'), function(k, item) { attArmy[jQuery(item).attr('data-entity-type') + '_' + jQuery(item).attr('data-entity-config')] = jQuery(item).attr('data-entity-count'); }); stephino_rpg_tools.ajax('actionAttackStart', { attCityId: parseInt(args[0], 10), defCityId: parseInt(args[1], 10), army: attArmy }, function(msg) { stephino_rpg_tools.map.sound.manager.trigger('dialogAction'); stephino_rpg_tools.map.sound.manager.trigger('attackStart'); stephino_rpg_tools.dialog.hide(); }); } }, cityTransportCapacityPreview: function() { var parentCityObject = jQuery(this).parents('[data-role="transport-city"]'); if (parentCityObject.length) { var buttonReview = parentCityObject.find('[data-click="cityTransportReviewButton"]'); var totalCapacityObject = parentCityObject.find('[data-role="total-capacity"]'); var totalCapacity = 0; jQuery.each(parentCityObject.find('input[type="range"]'), function() { totalCapacity += parseInt(jQuery(this).attr('data-payload-capacity'), 10) * jQuery(this).val(); }); totalCapacityObject.html(stephino_rpg_tools.php.number_format(totalCapacity)); if (totalCapacity <= 0) { buttonReview.addClass('d-none'); } else { buttonReview.removeClass('d-none'); } } }, cityTransportReviewButton: function(args) { if (jQuery.isArray(args) && 2 === args.length) { var transporters = {}; jQuery.each(jQuery(this).parents('[data-role="transport-city"]').find('input[type="range"]'), function(k, item) { if (jQuery(item).val() > 0) { transporters[jQuery(item).attr('name')] = jQuery(item).val(); } }); stephino_rpg_tools.dialog.show('dialogTransportReview', { fromCityId: parseInt(args[0], 10), toCityId: parseInt(args[1], 10), transporters: transporters }); } }, cityTransportButton: function(args) { if(jQuery.isArray(args) && 2 === args.length) { var parentCityObject = jQuery(this).parents('[data-role="transport-city"]'); var transporters = {}; var transportEntities = {}; var transportResources = {}; jQuery.each(parentCityObject.find('[data-role="transporter"]'), function(k, item) { transporters[jQuery(item).attr('data-entity-type') + '_' + jQuery(item).attr('data-entity-config')] = parseInt(jQuery(item).attr('data-entity-count'), 10); }); jQuery.each(parentCityObject.find('[data-payload-type="entities"]'), function(k, item){ transportEntities[jQuery(item).attr('name')] = parseInt(jQuery(item).val(), 10); }); jQuery.each(parentCityObject.find('[data-payload-type="resources"]'), function(k, item){ transportResources[jQuery(item).attr('name')] = parseInt(jQuery(item).val(), 10); }); stephino_rpg_tools.ajax('actionTransportStart', { fromCityId: parseInt(args[0], 10), toCityId: parseInt(args[1], 10), transporters: transporters, transportEntities: transportEntities, transportResources: transportResources }, function(msg) { stephino_rpg_tools.map.sound.manager.trigger('dialogAction'); stephino_rpg_tools.dialog.hide(); }); } }, citySpyReviewButton: function(args) { if (jQuery.isArray(args) && 1 === args.length) { stephino_rpg_tools.dialog.show('dialogSpyReview', { toCityId: parseInt(args[0], 10) }); } }, citySpyButton: function(args) { if(jQuery.isArray(args) && 3 === args.length) { stephino_rpg_tools.ajax('actionSpyStart', { toCityId: parseInt(args[0], 10), spyCityId: parseInt(args[1], 10), spyEntityId: parseInt(args[2], 10) }, function(msg) { stephino_rpg_tools.map.sound.manager.trigger('dialogAction'); stephino_rpg_tools.dialog.hide(); }); } }, poly: function() { var levelSelect = jQuery(this).parents('[data-role="content"]').find('[data-role="poly-level"]'); var countSelect = jQuery(this).parents('[data-role="content"]').find('[data-role="poly-count"]'); if (levelSelect.length) { var polyObject = jQuery(this); var polyTimeMode = ('true' === polyObject.attr('data-poly-time')); var funcName = polyObject.attr('data-poly-func'); var base = polyObject.attr('data-poly-base'); var a = polyObject.attr('data-poly-arg-a'); var b = polyObject.attr('data-poly-arg-b'); var c = polyObject.attr('data-poly-arg-c'); var xMax = parseInt(polyObject.attr('data-poly-max'), 10); var xIgnoreCount = ('true' === polyObject.attr('data-poly-ignore-count')); if (!isFinite(xMax)) { xMax = null; } if ('undefined' !== typeof funcName && 'undefined' !== typeof base) { var functions = { c: { name: stephino_rpg_data.i18n.formula_constant, args: [], formula: stephino_rpg_data.i18n.formula_no_change }, l: { name: stephino_rpg_data.i18n.formula_linear, args: ['a', 'c'], formula: 'a &sdot; x + c' }, li: { name: stephino_rpg_data.i18n.formula_linear_inv, args: ['a', 'c'], formula: '(a &sdot; x + c)<sup>-1</sup>' }, q: { name: stephino_rpg_data.i18n.formula_quad, args: ['a', 'b', 'c'], formula: 'a &sdot; x<sup>2</sup> + b &sdot; x + c' }, qi: { name: stephino_rpg_data.i18n.formula_quad_inv, args: ['a', 'b', 'c'], formula: '(a &sdot; x<sup>2</sup> + b &sdot; x + c)<sup>-1</sup>' }, e: { name: stephino_rpg_data.i18n.formula_exp, args: ['a', 'b', 'c'], formula: 'a &sdot; b<sup>x</sup> + c' }, ei: { name: stephino_rpg_data.i18n.formula_exp_inv, args: ['a', 'b', 'c'], formula: '(a &sdot; b<sup>x</sup> + c)<sup>-1</sup>' } }; if ('undefined' === typeof funcName || 'undefined' === typeof functions[funcName]) { funcName = 'c'; } if ('c' !== funcName && ('undefined' === typeof a || 'undefined' === typeof b || 'undefined' === typeof c )) { return; } var polyTitle = functions[funcName].name; if ('true' === polyObject.attr('data-describe') && 'c' !== funcName) { polyTitle = functions[funcName].name + ': ' + functions[funcName].formula .replace(/\ba\b/g, a) .replace(/\bb\b/g, b) .replace(/\bc\b/g, c) + ', <b>x</b> = <b>level</b> - 1'; } polyObject.attr('title', polyTitle); levelSelect.change(function() { var xResult = null; var xValue = parseInt(levelSelect.val() - 1, 10); if (xValue > 0) { switch (funcName) { case 'c': xResult = 1; break; case 'l': case 'li': xResult = parseFloat(a) * xValue + parseFloat(c); if ('li' === funcName) { if (xResult === 0) { xResult = 1; } xResult = 1 / xResult; } break; case 'q': case 'qi': xResult = parseFloat(a) * Math.pow(xValue, 2) + parseFloat(b) * xValue + parseFloat(c); if ('qi' === funcName) { if (xResult === 0) { xResult = 1; } xResult = 1 / xResult; } break; case 'e': case 'ei': xResult = parseFloat(a) * Math.pow(parseFloat(b), xValue) + parseFloat(c); if ('ei' === funcName) { if (xResult === 0) { xResult = 1; } xResult = 1 / xResult; } break; } } else { xResult = 1; } if (!xIgnoreCount && countSelect.length) { xResult *= Math.abs(parseInt(countSelect.val(), 10)); } if (null !== xMax && xResult * base > xMax) { xResult = xMax / base; } polyObject.html( polyTimeMode ? stephino_rpg_tools.utils.secondsGM(parseInt(xResult * base, 10)) : stephino_rpg_tools.php.number_format(xResult * base) ); }); if (!xIgnoreCount && countSelect.length) { countSelect.change(function() { levelSelect.change(); }); } } } } }, _coreActionsHandler: function(contentObject, modalData) { jQuery.each(contentObject.find('input[type="range"]'), function() { var rangeInput = jQuery(this); var rangePreview = rangeInput.attr('data-preview'); var rangePreviewLabel = rangeInput.attr('data-preview-label'); var rangePreviewLabelTitle = rangeInput.attr('data-preview-label-title'); var rangePreviewInput = null; var setRangePreviewValue = function(newValue) { rangePreviewInput.val(newValue).removeAttr('title').tooltip('dispose'); if (Math.abs(newValue) >= 1000) { rangePreviewInput.attr('title', '<b>' + stephino_rpg_tools.php.number_format(newValue) + '</b> (' + stephino_rpg_tools.utils.isuFormat(newValue) + ')').tooltip({ container: stephino_rpg_tools.dialog._objects.modal[0], html: true }).tooltip('update'); } }; if ('true' === rangePreview) { var rangePreviewBlock = jQuery('<div class="col-12 col-sm-6 col-lg-4 mt-1">' + '<div class="input-group">' + '<input type="number" class="form-control" />' + ('string' === typeof rangePreviewLabel ? '<div class="input-group-append">' + '<span class="input-group-text">' + rangePreviewLabel + '</span>' + '</div>' : "") + '</div>' + '</div>'); rangePreviewBlock.insertAfter(rangeInput); if ('string' === typeof rangePreviewLabelTitle) { rangePreviewBlock.find('.input-group-text') .attr('title', rangePreviewLabelTitle) .tooltip('dispose').tooltip({ container: stephino_rpg_tools.dialog._objects.modal[0], html: true }).tooltip('update'); } rangePreviewInput = rangePreviewBlock.find('input'); setRangePreviewValue(rangeInput.val()); rangePreviewInput.change(function() { var newValue = parseInt(jQuery(this).val(), 10); if (isNaN(newValue)) { newValue = 0; } rangeInput.val(newValue).change(); }); rangeInput.wrap('<div class="col-12 col-sm-6 col-lg-8 pr-2"></div>'); } rangeInput.rangeslider({ polyfill:false, onSlide: function(pos, val) { stephino_rpg_tools.dialog.preventClosing = true; if (null !== rangePreviewInput) { setRangePreviewValue(val); } }, onSlideEnd: function() { window.setTimeout(function() { stephino_rpg_tools.dialog.preventClosing = false; }, 100); } }); }); contentObject.find('[data-toggle]').click(function() { stephino_rpg_tools.map.sound.manager.trigger('dialogButton'); }); contentObject.find('[data-click]').click(function() { var buttonObject = jQuery(this); if (buttonObject.hasClass('btn') && 'string' !== typeof buttonObject.attr('data-click-multi')) { buttonObject.attr('disabled', 'disabled'); } stephino_rpg_tools.map.sound.manager.trigger('dialogButton'); var actionName = buttonObject.attr('data-click'); var actionArgs = buttonObject.attr('data-click-args'); if ("undefined" === typeof actionArgs) { actionArgs = []; } else { actionArgs = actionArgs.split(','); } do { if ("string" === typeof buttonObject.attr('data-click-city-id')) { var dataCityId = parseInt(buttonObject.attr('data-click-city-id'), 10); if (dataCityId !== parseInt(jQuery('[data-role="map-holder"]').attr('city-id'), 10)) { stephino_rpg_tools.navigation.start('city', dataCityId, 50); break; } } if ("function" === typeof stephino_rpg_tools.dialog.actions[actionName]) { stephino_rpg_tools.dialog.actions[actionName].call(buttonObject, actionArgs, modalData); break; } if ("function" === typeof stephino_rpg_tools.dialog._coreActions[actionName]) { stephino_rpg_tools.dialog._coreActions[actionName].call(buttonObject, actionArgs, modalData); break; } } while(false); }); contentObject.find('[data-change]').change(function() { var actionName = jQuery(this).attr('data-change'); var actionArgs = jQuery(this).attr('data-change-args'); if ("undefined" === typeof actionArgs) { actionArgs = []; } else { actionArgs = actionArgs.split(','); } if ("function" === typeof stephino_rpg_tools.dialog.actions[actionName]) { return stephino_rpg_tools.dialog.actions[actionName].call(jQuery(this), actionArgs, modalData); } if ("function" === typeof stephino_rpg_tools.dialog._coreActions[actionName]) { return stephino_rpg_tools.dialog._coreActions[actionName].call(jQuery(this), actionArgs, modalData); } return false; }); var effectObjects = contentObject.find('[data-effect]'); if (effectObjects.length) { jQuery.each(effectObjects, function() { var effectName = jQuery(this).attr('data-effect'); var effectArgs = jQuery(this).attr('data-effect-args'); if ("undefined" === typeof effectArgs) { effectArgs = []; } else { effectArgs = effectArgs.split(','); } do { if ("function" === typeof stephino_rpg_tools.dialog.actions[effectName]) { stephino_rpg_tools.dialog.actions[effectName].call(jQuery(this), effectArgs, modalData); break; } if ("function" === typeof stephino_rpg_tools.dialog._coreActions[effectName]) { stephino_rpg_tools.dialog._coreActions[effectName].call(jQuery(this), effectArgs, modalData); } } while(false); }); } jQuery.each(contentObject.find('.heading > span'), function(){ jQuery(this).parent().attr('title', jQuery(this).text()); }); var activeFrame = contentObject.find('.framed.active'); if (1 === activeFrame.length) { window.setTimeout(function() { activeFrame[0].scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 500); } contentObject.find('[title]').tooltip({ container: stephino_rpg_tools.dialog._objects.modal[0] }); }, _history: [], _objects: { modal: null, modalDialog: null, modalTitle: null, modalBack: null, modalContent: null }, _timers: [], preventClosing: false, isVisible: false, actions: {}, setTimer: function(callable, delay) { var timerId = null; if ("function" === typeof callable && "number" === typeof delay) { timerId = window.setTimeout(callable, delay); stephino_rpg_tools.dialog._timers.push(timerId); } return timerId; }, clearTimers: function() { jQuery('.modal [role="tooltip"]').remove(); jQuery.each(stephino_rpg_tools.dialog._timers, function(k, v) { try { window.clearTimeout(v); } catch(e) {} }); stephino_rpg_tools.dialog._timers = []; }, show: function(methodName, methodArguments, ajaxCallback, focusedSound, noAnimation, clearHistory) { if ("undefined" === typeof methodArguments) { methodArguments = {}; } if ("boolean" !== typeof noAnimation) { noAnimation = false; } if ("boolean" !== typeof clearHistory) { clearHistory = false; } stephino_rpg_tools.dialog.preventClosing = false; stephino_rpg_tools.dialog.clearTimers(); if (null === this._objects.modal) { this._objects.modal = jQuery('#modal-template'); this._objects.modalDialog = this._objects.modal.children('.modal-dialog'); this._objects.modalTitle = this._objects.modal.find('.modal-title'); this._objects.modalContent = this._objects.modal.find('.modal-body'); this._objects.modalBack = this._objects.modal.find('[data-role="nav-back"]'); this._objects.modal.on('hidden.bs.modal', function () { stephino_rpg_tools.map.sound.manager.trigger('hudClose'); stephino_rpg_tools.dialog._objects.modalTitle.empty(); stephino_rpg_tools.dialog._objects.modalContent.empty().attr('data-modal-method', ''); stephino_rpg_tools.map.sound.manager.blur(); stephino_rpg_tools.tutorial.updateTooltip(500); stephino_rpg_tools.dialog.clearTimers(); stephino_rpg_tools.dialog.isVisible = false; stephino_rpg_tools.dialog.preventClosing = false; window.scrollTo({top: 0, behavior: 'smooth'}); }); this._objects.modalBack.click(function(e) { e.preventDefault(); e.stopPropagation(); stephino_rpg_tools.map.sound.manager.trigger('dialogButton'); stephino_rpg_tools.dialog._history.pop(); stephino_rpg_tools.dialog.clearTimers(); if (stephino_rpg_tools.dialog._history.length) { var previousState = stephino_rpg_tools.dialog._history.pop(); if (jQuery.isArray(previousState) && 4 === previousState.length) { stephino_rpg_tools.dialog.show(previousState[0], previousState[1], previousState[2], previousState[3]); } } if (stephino_rpg_tools.dialog._history.length <= 1) { jQuery(this).removeClass('visible'); } return false; }); document.addEventListener('keyup', function (event) { if (!stephino_rpg_tools.dialog.preventClosing && !event.defaultPrevented && 'Escape' === (event.key || event.keyCode)) { stephino_rpg_tools.dialog._objects.modal.modal('hide'); } }, {passive: true}); this._objects.modal.on('click touchstart', function(e) { if (!stephino_rpg_tools.dialog.preventClosing && jQuery(e.toElement).is(stephino_rpg_tools.dialog._objects.modal)) { stephino_rpg_tools.dialog._objects.modal.modal('hide'); } }); } var historyState = [methodName, methodArguments, ajaxCallback, focusedSound]; if (!noAnimation) { if (!this._objects.modal.hasClass('show')) { this._history = []; if (this._objects.modalBack.hasClass('visible')) { this._objects.modalBack.removeClass('visible'); } } else { if (!this._objects.modalBack.hasClass('visible')) { this._objects.modalBack.addClass('visible'); } } this._history[this._history.length] = historyState; stephino_rpg_tools.dialog._objects.modalTitle.html(stephino_rpg_data.i18n.modal_loading); } var loadContent = function() { stephino_rpg_tools.dialog._objects.modalContent.attr('data-modal-method', ''); var ajaxParser = function(msg) { if (msg.status) { var modalData = ("object" === typeof msg.result && null !== msg.result) ? msg.result : {}; stephino_rpg_tools.dialog._objects.modalDialog .removeClass('modal-xl') .removeClass('modal-lg') .removeClass('modal-md'); if ("boolean" === typeof modalData.modal_size) { stephino_rpg_tools.dialog._objects.modalDialog.addClass(modalData.modal_size ? 'modal-xl' : 'modal-md'); } else { stephino_rpg_tools.dialog._objects.modalDialog.addClass('modal-lg'); } stephino_rpg_tools.dialog._objects.modalTitle.html("object" === typeof msg.result && null !== msg.result && "string" === typeof msg.result.title ? msg.result.title : 'Stephino'); stephino_rpg_tools.dialog._objects.modalContent.html('<div class="vr"></div>' + msg.content).attr('data-modal-method', null === methodName ? '_local' : methodName); stephino_rpg_tools.dialog._coreActionsHandler(stephino_rpg_tools.dialog._objects.modalContent, modalData); if ("function" === typeof ajaxCallback) { ajaxCallback.call(stephino_rpg_tools.dialog._objects, modalData); } } else { stephino_rpg_tools.dialog._objects.modalTitle.html(stephino_rpg_data.i18n.modal_error); stephino_rpg_tools.dialog._objects.modalContent.html( '<div class="framed p-4 text-center"><span>' + msg.result + '</span></div>' ); } if (!noAnimation) { if (!stephino_rpg_tools.utils.isMobile()) { stephino_rpg_tools.dialog._objects.modalContent.slideDown(75); } stephino_rpg_tools.map.sound.manager.trigger('dialogOpen'); } stephino_rpg_tools.dialog._objects.modalContent.find('[title]').tooltip({ container: stephino_rpg_tools.dialog._objects.modal[0] }); }; if (null === methodName) { if ("string" !== typeof methodArguments.content) { ajaxParser({ status: false, result: 'dialog.show(null, methodArguments) expects methodArguments.content to be a string' }); } else { ajaxParser({ status: true, result: methodArguments.result, content: methodArguments.content }); } } else { stephino_rpg_tools.ajax(methodName, methodArguments, ajaxParser); } }; if (!noAnimation) { if (stephino_rpg_tools.utils.isMobile()) { stephino_rpg_tools.dialog._objects.modalContent.html(''); window.setTimeout(loadContent, 75); } else { stephino_rpg_tools.dialog._objects.modalContent.slideUp(75, loadContent); } stephino_rpg_tools.dialog.setTimer(function() { stephino_rpg_tools.dialog._objects.modal.modal('show'); }, 50); stephino_rpg_tools.dialog.isVisible = true; if ("string" === typeof focusedSound) { stephino_rpg_tools.map.sound.manager.focus(focusedSound); } } else { loadContent(); } if (clearHistory) { stephino_rpg_tools.dialog._history = [historyState]; stephino_rpg_tools.dialog._objects.modalBack.removeClass('visible'); } }, refresh: function() { if (this._history.length) { var methodArguments = [...this._history[this._history.length - 1]]; methodArguments[4] = true; stephino_rpg_tools.dialog.show(...methodArguments); } }, hide: function() { if (null !== stephino_rpg_tools.dialog._objects.modal) { stephino_rpg_tools.dialog._objects.modal.modal('hide'); } } }, map: { options: {}, sound: { howler: { _objects: {}, get: function(fileName) { return "undefined" === typeof stephino_rpg_tools.map.sound.howler._objects[fileName] ? null : stephino_rpg_tools.map.sound.howler._objects[fileName]; }, init: function(fileName, volume, autoPlay, loop, soundSprite) { if (stephino_rpg_data.is_pro && "undefined" === typeof stephino_rpg_tools.map.sound.howler._objects[fileName]) { stephino_rpg_tools.map.sound.howler._objects[fileName] = null; var howlerInit = function() { document.removeEventListener('click', howlerInit); do { if (null !== stephino_rpg_tools.map.sound.howler._objects[fileName]) { break; } var holwerOptions = { src: [ stephino_rpg_tools.media.getUrl('audio/' + fileName + '.webm'), stephino_rpg_tools.media.getUrl('audio/' + fileName + '.mp3') ], format: ['webm', 'mp3'], autoplay: "undefined" === typeof autoPlay ? true : !!autoPlay, loop: "undefined" === typeof loop ? true : !!loop, volume: stephino_rpg_tools.map.sound.manager.setMasterVolume._sanitizeVolume(volume) / 100 }; if ("object" === typeof soundSprite) { holwerOptions.sprite = soundSprite; } try { stephino_rpg_tools.map.sound.howler._objects[fileName] = new Howl(holwerOptions); stephino_rpg_tools.map.sound.manager.setVolume( fileName, stephino_rpg_tools.map.sound.howler._objects[fileName], volume / 100 ); } catch (e) {} } while(false); }; document.addEventListener('click', howlerInit, {passive: true}); } } }, manager: { _data: { musicFile: null, ambienceFile: null, eventsFile: null, focus: null, baseVolumes: {} }, trigger: function(eventName) { if (null !== stephino_rpg_tools.map.sound.manager.getEvents()) { stephino_rpg_tools.map.sound.manager.getEvents().play(eventName); } }, focus: function(fileName) { if ("undefined" !== typeof stephino_rpg_tools.map.sound.howler._objects[fileName]) { stephino_rpg_tools.map.sound.manager._data.focus = {}; jQuery.each(stephino_rpg_tools.map.sound.howler._objects, function(fName, howler) { if (null === howler) { return; } var originalVolume = stephino_rpg_tools.map.sound.manager.getVolume(fName); if (null === originalVolume) { originalVolume = howler._volume; } stephino_rpg_tools.map.sound.manager._data.focus[fName] = { volume: originalVolume, howler: howler }; do { if (fileName === fName) { stephino_rpg_tools.map.sound.manager.setVolume(fName, howler, stephino_rpg_tools.map.options.cellsFocusVolume / 100, 500); break; } if (stephino_rpg_tools.map.options.musicFile === fName) { stephino_rpg_tools.map.sound.manager.setVolume(fName, howler, stephino_rpg_tools.map.options.musicFocusVolume / 100); break; } if (stephino_rpg_tools.map.options.ambienceFile === fName) { stephino_rpg_tools.map.sound.manager.setVolume(fName, howler, stephino_rpg_tools.map.options.ambienceFocusVolume / 100); break; } if (fName.match(/^buildings\b/g)) { stephino_rpg_tools.map.sound.manager.setVolume(fName, howler, 0); } } while (false); }); } }, blur: function() { if (null !== stephino_rpg_tools.map.sound.manager._data.focus) { jQuery.each(stephino_rpg_tools.map.sound.manager._data.focus, function(fName, data) { stephino_rpg_tools.map.sound.manager.setVolume(fName, data.howler, data.volume); }); } stephino_rpg_tools.map.sound.manager._data.focus = null; }, update: function() { if (null !== stephino_rpg_tools.map.sound.howler._objects) { jQuery.each(stephino_rpg_tools.map.sound.howler._objects, function(fileName, howler) { if ("undefined" !== typeof stephino_rpg_tools.map.sound.manager._data.baseVolumes[fileName]) { stephino_rpg_tools.map.sound.manager.setVolume(fileName, howler, stephino_rpg_tools.map.sound.manager.getVolume(fileName)); } }); } }, setMasterVolume: { _sanitizeVolume: function(volume) { volume = "undefined" === typeof volume ? 100 : parseInt(volume, 10); if (isNaN(volume)) { volume = 100; } return volume < 0 ? 0 : (volume > 100 ? 100 : volume); }, object: function(objectName, volume) { switch (objectName) { case 'vol_music': stephino_rpg_tools.map.sound.manager.setMasterVolume.music(volume); break; case 'vol_bkg': stephino_rpg_tools.map.sound.manager.setMasterVolume.ambience(volume); break; case 'vol_cells': stephino_rpg_tools.map.sound.manager.setMasterVolume.cells(volume); break; case 'vol_events': stephino_rpg_tools.map.sound.manager.setMasterVolume.events(volume); break; } }, music: function(volume) { stephino_rpg_tools.map.options.masterVolumeMusic = stephino_rpg_tools.map.sound.manager.setMasterVolume._sanitizeVolume(volume); stephino_rpg_tools.map.sound.manager.update(); }, ambience: function(volume) { stephino_rpg_tools.map.options.masterVolumeAmbience = stephino_rpg_tools.map.sound.manager.setMasterVolume._sanitizeVolume(volume); stephino_rpg_tools.map.sound.manager.update(); }, cells: function(volume) { stephino_rpg_tools.map.options.masterVolumeCells = stephino_rpg_tools.map.sound.manager.setMasterVolume._sanitizeVolume(volume); stephino_rpg_tools.map.sound.manager.update(); }, events: function(volume) { stephino_rpg_tools.map.options.masterVolumeEvents = stephino_rpg_tools.map.sound.manager.setMasterVolume._sanitizeVolume(volume); stephino_rpg_tools.map.sound.manager.update(); } }, getVolume: function(fileName) { if ("undefined" === typeof stephino_rpg_tools.map.sound.manager._data.baseVolumes[fileName]) { return null; } return stephino_rpg_tools.map.sound.manager._data.baseVolumes[fileName]; }, setVolume: function(fileName, howler, volumeFloat, transitionTime) { if (null === howler) { return; } transitionTime = "undefined" === typeof transitionTime ? 0 : parseInt(transitionTime, 10); stephino_rpg_tools.map.sound.manager._data.baseVolumes[fileName] = volumeFloat; var volumeToAdjusted = volumeFloat; do { if (stephino_rpg_tools.map.options.musicFile === fileName) { volumeToAdjusted *= (stephino_rpg_tools.map.options.masterVolumeMusic / 100); break; } if (stephino_rpg_tools.map.options.ambienceFile === fileName) { volumeToAdjusted *= (stephino_rpg_tools.map.options.masterVolumeAmbience / 100); break; } if (fileName.match(/^buildings\b/g)) { volumeToAdjusted *= (stephino_rpg_tools.map.options.masterVolumeCells / 100); break; } volumeToAdjusted *= (stephino_rpg_tools.map.options.masterVolumeEvents / 100); } while (false); if (howler._volume !== volumeToAdjusted) { if (0 === transitionTime) { howler.volume(volumeToAdjusted); } else { howler.fade(howler._volume, volumeToAdjusted, transitionTime); } } }, setMusic: function(fileName, musicVolume) { if (null === stephino_rpg_tools.map.sound.manager._data.musicFile) { stephino_rpg_tools.map.sound.manager._data.musicFile = fileName; stephino_rpg_tools.map.sound.howler.init(fileName, musicVolume); } }, getMusic: function() { return stephino_rpg_tools.map.sound.howler.get(stephino_rpg_tools.map.sound.manager._data.musicFile); }, setAmbience: function(fileName, ambienceVolume) { if (null === stephino_rpg_tools.map.sound.manager._data.ambienceFile) { stephino_rpg_tools.map.sound.manager._data.ambienceFile = fileName; stephino_rpg_tools.map.sound.howler.init(fileName, ambienceVolume); } }, getAmbience: function() { return stephino_rpg_tools.map.sound.howler.get(stephino_rpg_tools.map.sound.manager._data.ambienceFile); }, setEvents: function(fileName, eventsVolume) { if (null === stephino_rpg_tools.map.sound.manager._data.eventsFile) { stephino_rpg_tools.map.sound.manager._data.eventsFile = fileName; stephino_rpg_tools.map.sound.howler.init( fileName, eventsVolume, false, false, stephino_rpg_data.events_sprite ); } }, getEvents: function() { return stephino_rpg_tools.map.sound.howler.get(stephino_rpg_tools.map.sound.manager._data.eventsFile); } } }, trackers: [], init: function(objectHandle, objectTarget, options) { var hammer = new Hammer(objectHandle[0]), mapOptions = { masterVolumeMusic: 100, masterVolumeAmbience: 100, masterVolumeCells: 100, masterVolumeEvents: 100, background: null, musicFile: 'music', musicVolume: 50, musicFocusVolume: 30, ambienceFile: 'ambience', ambienceVolume: 30, ambienceFocusVolume: 10, eventsFile: 'events', eventsVolume: 30, cellsRotated: false, cellsVolume: 15, cellsFocusVolume: 40, centerCellX: 0, centerCellY: 0, cells: [], cellDataXName: "x", cellDataYName: "y", cellController: function(cellObject, payload) {}, cellClass: 'cell', cellSize: null, cellTap: null, zoomInitial: 0.5, zoomMin: 0.5, zoomMax: 1, cellPaddingTop: 0, cellPaddingBottom: 0, cellPaddingLeft: 0, cellPaddingRight: 0, cellPaddingClass: 'cell-padding', extensionFactor: 100, restricted: true, marginTop: 0, marginBottom: 0, marginLeft: 0, marginRight: 0, provision: null, provisionTimeout: 1000, trackerAttr: '' }, map = { trackers: [], cellCache: [], cellPaddingCache: [], mapBkgCache: [], vertical: false, window: {width: 0, height: 0}, center: {x: 0, y: 0}, core: {x: 0, y: 0}, extended: { from: {x: 0, y: 0, cellX: 0, cellY: 0}, to: {x: 0, y: 0, cellX: 0, cellY: 0}, width: 0, height: 0 }, visible: { from: {cellX: 0, cellY: 0}, to: {cellX: 0, cellY: 0}, cells: {} }, limit: { min: {x:0, y: 0}, max: {x:0, y: 0} }, zoomScale: null, zoom: function(inOut, resolution) { if (stephino_rpg_tools.dialog.isVisible) { return; } inOut = true === inOut; resoultion = ("number" !== typeof resolution ? 0.05 : parseFloat(resolution)); if (resolution > 0.25) { resolution = 0.25; } if (resolution < 0.05) { resolution = 0.05; } var zoomScalePrev = map.zoomScale; if (!inOut) { map.zoomScale -= resoultion; } else { map.zoomScale += resoultion; } if (map.zoomScale < (map.vertical ? 0.75 : mapOptions.zoomMin)) { map.zoomScale = (map.vertical ? 0.75 : mapOptions.zoomMin); } if (map.zoomScale > mapOptions.zoomMax) { map.zoomScale = mapOptions.zoomMax; } if (zoomScalePrev === map.zoomScale) { return; } map.calibrate(); map.move(parseInt(map.core.x * map.zoomScale / zoomScalePrev, 10), parseInt(map.core.y * map.zoomScale / zoomScalePrev, 10)); }, backgroundObject: null, move: function(x, y) { if (mapOptions.restricted) { do { if (map.extended.width <= map.window.width) { x = 0; break; } if (x <= map.limit.min.x) { x = map.limit.min.x; break; } if (x >= map.limit.max.x) { x = map.limit.max.x; } } while(false); do { if (map.extended.height <= map.window.height) { y = 0; break; } if (y <= map.limit.min.y) { y = map.limit.min.y; break; } if (y >= map.limit.max.y) { y = map.limit.max.y; } } while(false); } map.core.x = x; map.core.y = y; objectTarget.css({ transform: 'translate(' + (map.center.x + map.core.x) + 'px, ' + (map.center.y + map.core.y) + 'px) scale(' + map.zoomScale + ')' }); if (!map.event.pan.isDragging && "function" === typeof mapOptions.provision) { var limitCellX = parseInt((map.visible.from.cellX + map.visible.to.cellX) / 2, 10); var limitCellY = parseInt((map.visible.from.cellY + map.visible.to.cellY) / 2, 10); if (map.event.provision.done && map.cellSize > 0) { map.event.provision.done = false; mapOptions.provision(limitCellX, limitCellY, function(cells) { if ("object" === typeof cells && null !== cells) { jQuery.each(cells, function (k, payload) { resultObject.addCell(payload); }); } window.setTimeout(function() { map.event.provision.done = true; }, mapOptions.provisionTimeout); }, map.cellCache); } } }, event: { pan: { isDragging: false, startX: 0, startY: 0 }, provision: { done: true }, padding: { done: false }, resize: { gotNewCellSize: false, isPinching: false } }, cellSize: 0, getZoomed: function() { }, calibrate: function() { if (!map.event.resize.gotNewCellSize) { mapOptions.cellSize = objectTarget.width(); map.event.resize.gotNewCellSize = true; } map.cellSize = map.zoomScale * mapOptions.cellSize; map.window.width = objectHandle.width(); map.window.height = objectHandle.height(); map.center.x = (mapOptions.extensionFactor/100 * map.window.width - mapOptions.cellSize) / 2; map.center.y = (mapOptions.extensionFactor/100 * map.window.height - mapOptions.cellSize) / 2; var cellData = {x: [], y: []}; map.cellCache.forEach(function(cell) { cellData.x[cellData.x.length] = cell[0]; cellData.y[cellData.y.length] = cell[1]; }); map.extended.from.cellX = Math.min.apply(null, cellData.x); map.extended.from.x = map.extended.from.cellX * map.cellSize; map.extended.from.cellY = Math.min.apply(null, cellData.y); map.extended.from.y = map.extended.from.cellY * map.cellSize; map.extended.to.cellX = Math.max.apply(null, cellData.x); map.extended.to.x = (map.extended.to.cellX + 1) * map.cellSize; map.extended.to.cellY = Math.max.apply(null, cellData.y); map.extended.to.y = (map.extended.to.cellY + 1) * map.cellSize; map.extended.width = map.extended.to.x - map.extended.from.x; map.extended.height = map.extended.to.y - map.extended.from.y; var mapRidge = mapOptions.cellSize * (0.5 - map.zoomScale/2); map.limit.min.x = map.center.x - map.extended.to.x + map.cellSize + mapRidge - mapOptions.marginRight; map.limit.max.x = - map.center.x - map.extended.from.x - mapRidge + mapOptions.marginLeft; map.limit.min.y = map.center.y + map.extended.from.y + mapRidge - mapOptions.marginBottom; map.limit.max.y = - map.center.y + map.extended.to.y - map.cellSize - mapRidge + mapOptions.marginTop; map.visible.from.cellX = Math.round(-(map.window.width/2 + map.core.x) / map.cellSize); map.visible.from.cellY = Math.round(-(map.window.height/2 - map.core.y) / map.cellSize); map.visible.to.cellX = Math.round(map.visible.from.cellX + map.window.width / map.cellSize); map.visible.to.cellY = Math.round(map.visible.from.cellY + map.window.height / map.cellSize); map.cellCache.forEach(function(element) { var xyKey = element[0] + ',' + element[1]; var newAction = ("undefined" === typeof map.visible.cells[xyKey]); if (element[0] >= map.visible.from.cellX && element[0] <= map.visible.to.cellX && element[1] >= map.visible.from.cellY && element[1] <= map.visible.to.cellY) { if (newAction || !map.visible.cells[xyKey]) { objectTarget.children('[cell-x="' + element[0] + '"][cell-y="' + element[1] + '"]').removeClass('no-anim'); map.visible.cells[xyKey] = true; } if (map.visible.cells[xyKey] && "string" === typeof element[2]) { var howler = stephino_rpg_tools.map.sound.howler.get(element[2]); if (null !== howler) { var divider = (mapOptions.zoomMax - mapOptions.zoomMin); if (divider === 0) { divider = 1; } var newVolume = (map.zoomScale - mapOptions.zoomMin) / divider * mapOptions.cellsVolume / 100; if (null === stephino_rpg_tools.map.sound.manager._data.focus) { stephino_rpg_tools.map.sound.manager.setVolume(element[2], howler, newVolume); } else { if ("undefined" !== typeof stephino_rpg_tools.map.sound.manager._data.focus[element[2]]) { stephino_rpg_tools.map.sound.manager._data.focus[element[2]].volume = newVolume; } } if (!stephino_rpg_tools.utils.isMobile()) { var newPanning = (2 * element[0] - (map.visible.to.cellX + map.visible.from.cellX)) / (map.visible.to.cellX - map.visible.from.cellX); if (howler._stereo !== newPanning) { howler.stereo(newPanning); } } } } } else { if (newAction || map.visible.cells[xyKey]) { objectTarget.children('[cell-x="' + element[0] + '"][cell-y="' + element[1] + '"]').addClass('no-anim'); map.visible.cells[xyKey] = false; if ("string" === typeof element[2]) { var howler = stephino_rpg_tools.map.sound.howler.get(element[2]); if (null !== howler) { if (null === stephino_rpg_tools.map.sound.manager._data.focus) { stephino_rpg_tools.map.sound.manager.setVolume(element[2], howler, 0); } else { stephino_rpg_tools.map.sound.manager._data.focus[element[2]].volume = 0; } } } } } }); if (null !== map.backgroundObject) { var bkgCacheW = "undefined" === typeof map.mapBkgCache[0] ? null : map.mapBkgCache[0]; var bkgCacheH = "undefined" === typeof map.mapBkgCache[1] ? null : map.mapBkgCache[1]; var bkgW = (map.extended.to.cellX - map.extended.from.cellX + 1) * mapOptions.cellSize; var bkgH = (map.extended.to.cellY - map.extended.from.cellY + 1) * mapOptions.cellSize; if (bkgCacheW !== bkgW || bkgCacheH !== bkgH) { map.backgroundObject.css({ transform: 'translate(' + ((map.extended.from.cellX) * mapOptions.cellSize) + 'px, ' + ((map.extended.from.cellY) * mapOptions.cellSize) + 'px)', width: bkgW + 'px', height: bkgH + 'px' }); map.mapBkgCache = [bkgW, bkgH]; } } if (!map.event.padding.done || ("function" === typeof mapOptions.provision && map.event.provision.done)) { var xCoordStart = map.extended.from.cellX - mapOptions.cellPaddingLeft; var xCoordEnd = map.extended.to.cellX + mapOptions.cellPaddingRight; var yCoordStart = map.extended.from.cellY - mapOptions.cellPaddingBottom; var yCoordEnd = map.extended.to.cellY + mapOptions.cellPaddingTop; for (var yCoord = yCoordStart; yCoord <= yCoordEnd; yCoord++) { for (var xCoord = xCoordStart; xCoord <= xCoordEnd; xCoord++) { var extraClass = 'center'; if (yCoord < map.extended.from.cellY) { extraClass = 'bottom'; } else { if (yCoord > map.extended.to.cellY) { extraClass = 'top'; } else { if (xCoord < map.extended.from.cellX) { extraClass = 'left'; } else { if (xCoord > map.extended.to.cellX) { extraClass = 'right'; } } } } var cellFoundInCache = false; map.cellCache.forEach(function(cell) { if (cell[0] === xCoord && cell[1] === yCoord) { cellFoundInCache = true; return false; } }); map.cellPaddingCache.forEach(function(cell) { if (cell[0] === xCoord && cell[1] === yCoord) { cellFoundInCache = true; return false; } }); if (!cellFoundInCache) { var paddingPayload = {}; paddingPayload[mapOptions.cellDataXName] = xCoord; paddingPayload[mapOptions.cellDataYName] = yCoord; resultObject.addCell(paddingPayload, true, mapOptions.cellPaddingClass + '-' + extraClass); } } } map.event.padding.done = true; } jQuery.each(stephino_rpg_tools.map.trackers, function(k, v) { if (null !== v && "function" === typeof v.update) { v.popper.style['transform'] = null; v.update(); } }); stephino_rpg_tools.tutorial.updateTooltip(500); } }, resultObject = { map: map, centerMap: function(animate, cellX, cellY) { animate = !!animate; cellX = ("number" !== typeof cellX ? mapOptions.centerCellX : parseInt(cellX, 10)); cellY = ("number" !== typeof cellY ? mapOptions.centerCellY : parseInt(cellY, 10)); jQuery.each(stephino_rpg_tools.map.trackers, function(k, v) { jQuery(v.popper).removeClass('visible'); }); map.event.resize.gotNewCellSize = false; map.calibrate(); if (map.window.width / map.window.height < 0.6) { map.vertical = true; } else { map.vertical = false; } if (animate) { objectTarget.attr('animated', 'true'); window.setTimeout(function() { map.move(-map.cellSize * cellX, map.cellSize * cellY); map.calibrate(); }, 50); window.setTimeout(function() { objectTarget.attr('animated', 'false'); }, 800); } else { map.move(-map.cellSize * cellX, map.cellSize * cellY); map.calibrate(); } window.setTimeout(function() { jQuery.each(stephino_rpg_tools.map.trackers, function(k, v) { v.popper.style['transform'] = null; v.update(); jQuery(v.popper).addClass('visible'); }); }, 3500); }, getSoundManager: function() { return stephino_rpg_tools.map.sound.manager; }, addCell: function(payload, isPadding, extraClass) { if ("undefined" === typeof isPadding) { isPadding = false; } if ("object" !== typeof payload || null === payload) { return false; } if ("undefined" === typeof payload[mapOptions.cellDataXName] || "undefined" === typeof payload[mapOptions.cellDataYName]) { return false; } var cellAdded = false; jQuery.each(isPadding ? map.cellPaddingCache : map.cellCache, function(k,v) { if (parseInt(v[0], 10) === parseInt(payload[mapOptions.cellDataXName], 10) && parseInt(v[1], 10) === parseInt(payload[mapOptions.cellDataYName], 10) ) { cellAdded = true; return false; } }); if (cellAdded) { return false; } var cellObject = jQuery('<div></div>'). attr('class', isPadding ? mapOptions.cellPaddingClass : mapOptions.cellClass). attr('cell-x', payload[mapOptions.cellDataXName]). attr('cell-y', payload[mapOptions.cellDataYName]); if ("string" === typeof extraClass) { cellObject.addClass(extraClass); } var cellTranslateY = -parseInt(payload[mapOptions.cellDataYName], 10) * mapOptions.cellSize; var cellTranslateX = parseInt(payload[mapOptions.cellDataXName], 10) * mapOptions.cellSize; if (mapOptions.cellsRotated) { cellTranslateX -= payload[mapOptions.cellDataXName] % 2 ? 0 : 20; cellTranslateY -= payload[mapOptions.cellDataXName] % 2 ? 0 : -30; } cellObject.css({ transform: 'translate(' + cellTranslateX + 'px, ' + cellTranslateY + 'px)' + (mapOptions.cellsRotated ? ' rotate(30deg) scale(0.9)' : '') }); var keepCell = true; if (!isPadding && "function" === typeof mapOptions.cellController) { keepCell = mapOptions.cellController(cellObject, payload); } if (!isPadding) { var cellSound = null; if ("string" === typeof payload.type && 'buildings' === payload.type) { if ("number" === typeof payload.configId) { if ("undefined" !== typeof payload.data && null !== payload.data) { cellSound = payload.type + '/' + payload.configId; stephino_rpg_tools.map.sound.howler.init(cellSound, 0); } } } map.cellCache[map.cellCache.length] = [payload[mapOptions.cellDataXName], payload[mapOptions.cellDataYName], cellSound]; } else { map.cellPaddingCache[map.cellPaddingCache.length] = [payload[mapOptions.cellDataXName], payload[mapOptions.cellDataYName]]; } if(keepCell) { if ('string' === typeof mapOptions.trackerAttr && mapOptions.trackerAttr.length && 'true' === cellObject.attr(mapOptions.trackerAttr)) { var cellTracker = jQuery('<div data-role="tracker"></div>').click(function(e) { e.preventDefault(); e.stopPropagation(); resultObject.centerMap( true, parseInt(cellObject.attr('cell-x'), 10), parseInt(cellObject.attr('cell-y'), 10) ); return false; }); var cellTrackerTitle = jQuery('<span></span>'); if ("object" === typeof payload['data'] && null !== payload['data']) { if ('string' === typeof payload.data['city_name']) { cellTrackerTitle.html(payload.data['city_name']); } } else { if ('string' === typeof payload['island_name']) { cellTrackerTitle.html(payload['island_name']); } } cellTracker.append(cellTrackerTitle); jQuery('body').append(cellTracker); stephino_rpg_tools.map.trackers[stephino_rpg_tools.map.trackers.length] = new Popper( cellObject.find('.label'), cellTracker[0], { placement: 'top', modifiers: { keepTogether: {enabled: false}, arrow: {enabled: false}, flip: { enabled: false, boundariesElement: objectTarget[0] }, customAngle: { enabled: true, order: 860, fn: function(data, opt) { var angleOffset = 90; var angleOffScreen = 0; var triangleHeight = ((data.offsets.reference.top + data.offsets.reference.height/2) - (data.offsets.popper.top + data.offsets.popper.height/2)); var triangleLength = ((data.offsets.reference.left + data.offsets.reference.width/2) - (data.offsets.popper.left + data.offsets.popper.width/2)); var angleOffScreenRad = Math.atan(triangleHeight / triangleLength); angleOffScreen = (data.offsets.reference.left < 0 ? 360 : 180) - (angleOffScreenRad * 180 / Math.PI); if ((90 === angleOffScreen || 450 === angleOffScreen) && (triangleHeight <= 0 || data.popper.bottom <= 0)) { angleOffScreen = 270; } if (270 === angleOffScreen && data.popper.bottom > -25) { angleOffScreen = 90; } data.styles.transform += ' rotate(' + parseFloat(angleOffset - angleOffScreen).toFixed(2) + 'deg)'; cellTrackerTitle.css({transform: 'rotate(' + parseFloat(- angleOffset + angleOffScreen).toFixed(2) + 'deg)'}); return data; } } } } ); window.setTimeout(function() { stephino_rpg_tools.map.trackers[stephino_rpg_tools.map.trackers.length - 1].update(); cellTracker.addClass('visible'); }, 3500); } objectTarget.append(cellObject); } } }; if ("object" !== typeof options) { options = {}; } jQuery.extend(mapOptions, options); stephino_rpg_tools.map.options = mapOptions; if (null === mapOptions.cellSize) { mapOptions.cellSize = objectTarget.width(); } else { mapOptions.cellSize = parseInt(mapOptions.cellSize, 10); } if (null === map.zoomScale) { map.zoomScale = mapOptions.zoomInitial; } if ("object" === typeof mapOptions.cells) { jQuery.each(mapOptions.cells, function (k, payload) { resultObject.addCell(payload); }); } if (null === mapOptions.provision) { map.backgroundObject = jQuery('<div data-role="map-bkg"></div>'); if (null !== mapOptions.background) { map.backgroundObject.css({backgroundImage: 'url("' + mapOptions.background + '")'}); } objectTarget.append(map.backgroundObject); jQuery('<img/>').on('load', function(){ stephino_rpg_tools.navigation.finish(); }).attr('src', mapOptions.background); } else { var firstCellBkg = jQuery('.cell[island-id]:eq(0)').css('background-image').replace(/^url\s*\(['"]?|['"]?\s*\)$/ig, ''); if ('none' !== firstCellBkg) { jQuery('<img/>').on('load', function(){ stephino_rpg_tools.navigation.finish(); }).attr('src', firstCellBkg); } else { stephino_rpg_tools.navigation.finish(); } } if (null !== mapOptions.musicFile) { resultObject.getSoundManager().setMusic(mapOptions.musicFile, mapOptions.musicVolume); } if (null !== mapOptions.ambienceFile) { resultObject.getSoundManager().setAmbience(mapOptions.ambienceFile, mapOptions.ambienceVolume); } if (null !== mapOptions.eventsFile) { resultObject.getSoundManager().setEvents(mapOptions.eventsFile, mapOptions.eventsVolume); } resultObject.centerMap(); jQuery(window).resize(function(){ var initialCellSize = mapOptions.cellSize; resultObject.centerMap(); if (mapOptions.cellSize !== initialCellSize) { jQuery.each(objectTarget.children('[cell-x][cell-y]'), function() { jQuery(this).css({ transform: 'translate(' + (parseInt(jQuery(this).attr('cell-x'), 10) * mapOptions.cellSize) + 'px, ' + (-parseInt(jQuery(this).attr('cell-y'), 10) * mapOptions.cellSize) + 'px)' }); }); } }); jQuery(window).on('mousewheel', function (event) { map.zoom(event.originalEvent.deltaY < 0); }); hammer.add([new Hammer.Pinch()]); hammer.on('pinchin pinchout', function(event) { if (!map.event.resize.isPinching) { map.event.resize.isPinching = true; map.zoom('pinchout' === event.type); window.setTimeout(function() { map.event.resize.isPinching = false; }, 50); } }); hammer.on('pan', function (ev) { if (!map.event.pan.isDragging) { map.calibrate(); map.event.pan.startX = map.core.x; map.event.pan.startY = map.core.y; map.event.pan.isDragging = true; if (null !== stephino_rpg_tools.tutorial._objects.marker) { if (!stephino_rpg_tools.tutorial._objects.marker.hasClass('hidden')) { stephino_rpg_tools.tutorial._objects.marker.addClass('hidden'); } } jQuery.each(stephino_rpg_tools.map.trackers, function(k, v) { jQuery(v.popper).removeClass('visible'); }); } if (ev.isFinal) { map.calibrate(); map.event.pan.isDragging = false; if (null !== stephino_rpg_tools.tutorial._objects.marker) { if (stephino_rpg_tools.tutorial._objects.marker.hasClass('hidden')) { stephino_rpg_tools.tutorial._objects.marker.removeClass('hidden'); } } jQuery.each(stephino_rpg_tools.map.trackers, function(k, v) { jQuery(v.popper).addClass('visible'); }); } map.move( map.event.pan.startX + ev.deltaX, map.event.pan.startY + ev.deltaY ); }); hammer.on('tap', function(e) { if ("function" === typeof mapOptions.cellTap) { mapOptions.cellTap(jQuery(e.target)); } stephino_rpg_tools.messages.collapse(); stephino_rpg_tools.navigation.collapse(); }); if (stephino_rpg_tools.utils.isMobile()) { jQuery('body').addClass('is-mobile'); } if (mapOptions.cellsRotated) { objectTarget.addClass('rotated'); } return resultObject; } }, utils: { _isMobile: null, getParams: function(url) { var params = {}; var parser = document.createElement('a'); parser.href = url; var query = parser.search.substring(1); var vars = query.split('&'); for (var i = 0; i < vars.length; i++) { var pair = vars[i].split('='); params[pair[0]] = decodeURIComponent(pair[1]); } return params; }, getCityName: function(cityDbRow) { var result = ''; if ("string" === typeof cityDbRow.city_name) { result = (1 === parseInt(cityDbRow.city_is_capital, 10) ? stephino_rpg_data.symbol_capital + ' ' : '') + cityDbRow.city_name; } return result; }, isMobile: function() { if (null === stephino_rpg_tools.utils._isMobile) { stephino_rpg_tools.utils._isMobile = false; (function(a) { if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) { stephino_rpg_tools.utils._isMobile = true; } })(navigator.userAgent||navigator.vendor||window.opera); } return stephino_rpg_tools.utils._isMobile; }, isuFormat: function(num, digits, digitsOverMille) { if ("undefined" === typeof digits) { digits = 1; } if ("undefined" === typeof digitsOverMille) { digitsOverMille = true; } var sign = num < 0 ? '-' : ''; num = Math.abs(num); var si = [ { value: 1, symbol: "" }, { value: 1E3, symbol: "k" }, { value: 1E6, symbol: "M" }, { value: 1E9, symbol: "G" }, { value: 1E12, symbol: "T" }, { value: 1E15, symbol: "P" }, { value: 1E18, symbol: "E" } ]; for (var i = si.length - 1; i > 0; i--) { if (num >= si[i].value) { break; } } var formatDigits = (digitsOverMille && num < 1000 ? 0 : digits); return sign + (num / si[i].value).toFixed(formatDigits).replace(/\.0+$|(\.[0-9]*[1-9])0+$/, "$1") + si[i].symbol; }, secondsGM: function(num) { var result = '00:00:00'; var secNum = parseInt(num, 10); if (secNum > 0) { var hours = Math.floor(secNum / 3600); var minutes = Math.floor(secNum / 60) % 60; var seconds = secNum % 60; result = [hours, minutes, seconds].map(function(v) {return v < 10 ? "0" + v : v;}).join(":"); } return result; }, getSnakePoint: function(snakeLength) { if ("number" !== typeof snakeLength) { snakeLength = 0; } snakeLength = Math.abs(snakeLength); switch (snakeLength) { case 0: return [0, 0]; break; case 1: return [-1, 0]; break; } var result = []; do { var coilNumber = Math.round(Math.pow(snakeLength / 4, 0.5)); var cornerRightDown = 4 * parseInt(Math.pow(coilNumber, 2), 10); if (snakeLength === (cornerRightDown + 4 * coilNumber)) { result = [-coilNumber, coilNumber]; break; } var cornerRightUp = cornerRightDown + 2 * coilNumber; if (snakeLength > cornerRightUp) { result = [coilNumber - snakeLength % cornerRightUp, coilNumber]; break; } if (snakeLength === cornerRightUp) { result = [coilNumber, coilNumber]; break; } if (snakeLength > cornerRightDown) { result = [coilNumber, snakeLength % cornerRightDown - coilNumber]; break; } if (snakeLength === cornerRightDown) { result = [coilNumber, -coilNumber]; break; } var cornerLeftDown = cornerRightDown - 2 * coilNumber; if (snakeLength > cornerLeftDown) { result = [snakeLength % cornerLeftDown - coilNumber, -coilNumber]; break; } if (snakeLength === cornerLeftDown) { result = [-coilNumber, -coilNumber]; break; } result = [-coilNumber, cornerLeftDown % snakeLength - coilNumber]; } while(false); return result; }, getSnakeLength: function(x, y) { var coilNumber = Math.max(Math.abs(x), Math.abs(y)); var result = 4 * parseInt(Math.pow(coilNumber, 2), 10); switch (coilNumber) { case y: result += 3 * coilNumber - x; break; case x: result += coilNumber + y; break; case -y: result += x - coilNumber; break; default: result += -3 * coilNumber - y; } return result; }, base64: { _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (input) { var output = ""; var chr1, chr2, chr3, enc1, enc2, enc3, enc4; var i = 0; input = this._utf8_encode(input); while (i < input.length) { chr1 = input.charCodeAt(i++); chr2 = input.charCodeAt(i++); chr3 = input.charCodeAt(i++); enc1 = chr1 >> 2; enc2 = ((chr1 & 3) << 4) | (chr2 >> 4); enc3 = ((chr2 & 15) << 2) | (chr3 >> 6); enc4 = chr3 & 63; if (isNaN(chr2)) { enc3 = enc4 = 64; } else if (isNaN(chr3)) { enc4 = 64; } output += this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4); } return output; }, decode: function (input) { var output = ""; var chr1, chr2, chr3; var enc1, enc2, enc3, enc4; var i = 0; input = input.replace(/[^A-Za-z0-9\+\/\=]/g, ""); while (i < input.length) { enc1 = this._keyStr.indexOf(input.charAt(i++)); enc2 = this._keyStr.indexOf(input.charAt(i++)); enc3 = this._keyStr.indexOf(input.charAt(i++)); enc4 = this._keyStr.indexOf(input.charAt(i++)); chr1 = (enc1 << 2) | (enc2 >> 4); chr2 = ((enc2 & 15) << 4) | (enc3 >> 2); chr3 = ((enc3 & 3) << 6) | enc4; output += String.fromCharCode(chr1); if (64 !== enc3) { output += String.fromCharCode(chr2); } if (64 !== enc4) { output += String.fromCharCode(chr3); } } return this._utf8_decode(output); }, _utf8_encode: function (string) { var utftext = ""; string = ("undefined" === typeof string ? "" : "" + string).replace(/\r\n/g, "\n"); for (var n = 0; n < string.length; n++) { var c = string.charCodeAt(n); if (c < 128) { utftext += String.fromCharCode(c); } else if ((c > 127) && (c < 2048)) { utftext += String.fromCharCode((c >> 6) | 192); utftext += String.fromCharCode((c & 63) | 128); } else { utftext += String.fromCharCode((c >> 12) | 224); utftext += String.fromCharCode(((c >> 6) & 63) | 128); utftext += String.fromCharCode((c & 63) | 128); } } return utftext; }, _utf8_decode: function (utftext) { utftext = ("undefined" === typeof utftext ? "" : "" + utftext); var string = ""; var i = 0; var c, c1, c2, c3; c = c1 = c2 = 0; while (i < utftext.length) { c = utftext.charCodeAt(i); if (c < 128) { string += String.fromCharCode(c); i++; } else if ((c > 191) && (c < 224)) { c2 = utftext.charCodeAt(i + 1); string += String.fromCharCode(((c & 31) << 6) | (c2 & 63)); i += 2; } else { c2 = utftext.charCodeAt(i + 1); c3 = utftext.charCodeAt(i + 2); string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)); i += 3; } } return string; } }, getCookie: function(name) { var parts = `; ${document.cookie}`.split(`; ${name}=`); if (2 === parts.length) { return parts.pop().split(';').shift(); } }, setCookie: function (cookieName, cookieValue, cookieExpDays) { var expiresString = ""; if ("number" === typeof cookieExpDays) { var exdate = new Date(); exdate.setDate(exdate.getDate() + cookieExpDays); expiresString = "; expires=" + exdate.toUTCString(); } document.cookie = cookieName + "=" + encodeURIComponent(cookieValue) + expiresString; }, getIntListZip(intList, compress) { compress = "undefined" === typeof compress ? true : !!compress; var result = []; if (jQuery.isArray(intList)) { do { if (!compress) { intList.forEach(function(intListItem) { var regEx = /^(\d+):(\d+)$/g; var intListMatches = regEx.exec(intListItem); if (null !== intListMatches) { var intListValue = parseInt(intListMatches[1], 10); var intListCount = parseInt(intListMatches[2], 10); for (var i = 1; i <= intListCount; i++) { result[result.length] = intListValue; } } else { result[result.length] = parseInt(intListItem, 10); } }); break; } var prevValue = null; var prevCount = 0; var append = function(intListItem = null) { if (null !== prevValue) { if (prevCount < 3) { for(var i = 1; i <= prevCount; i++) { result[result.length] = prevValue; } } else { result[result.length] = `${prevValue}:${prevCount}`; } } prevValue = intListItem; prevCount = 0; }; intList.forEach(function(intListItem) { if (intListItem !== prevValue) { append(intListItem); } prevCount++; }); append(); } while(false); } return result; } }, php: { mt_rand: function (min, max) { var argc = arguments.length; if (argc === 0) { min = 0; max = 2147483647; } else if (argc === 1) { throw new Error('Warning: mt_rand() expects exactly 2 parameters, 1 given'); } else { min = parseInt(min, 10); max = parseInt(max, 10); } return Math.floor(Math.random() * (max - min + 1)) + min; }, number_format: function(number, decimals, dec_point, thousands_sep) { number = (number + '').replace(/[^0-9+\-Ee.]/g, ''); var n = !isFinite( + number) ? 0 : + number, prec = !isFinite( + decimals) ? 0 : Math.abs(decimals), sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep, dec = (typeof dec_point === 'undefined') ? '.' : dec_point, s = ''; var toFixedFix = function (n, prec) { var k = Math.pow(10, prec); return '' + Math.round(n * k) / k; }; s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.'); if (s[0].length > 3) { s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep); } if ((s[1] || '').length < prec) { s[1] = s[1] || ''; s[1] += new Array(prec - s[1].length + 1).join('0'); } return s.join(dec); } }};

/*!
 * Popper v1.12.9
 * https://github.com/FezVrasta/popper.js
 * 
 * Copyright (c) 2017 Federico Zivolo
 * Licensed under MIT
 */
(function(e,t){'object'==typeof exports&&'undefined'!=typeof module?module.exports=t():'function'==typeof define&&define.amd?define(t):e.Popper=t()})(this,function(){'use strict';function e(e){return e&&'[object Function]'==={}.toString.call(e)}function t(e,t){if(1!==e.nodeType)return[];var o=getComputedStyle(e,null);return t?o[t]:o}function o(e){return'HTML'===e.nodeName?e:e.parentNode||e.host}function n(e){if(!e)return document.body;switch(e.nodeName){case'HTML':case'BODY':return e.ownerDocument.body;case'#document':return e.body;}var i=t(e),r=i.overflow,p=i.overflowX,s=i.overflowY;return /(auto|scroll)/.test(r+s+p)?e:n(o(e))}function r(e){var o=e&&e.offsetParent,i=o&&o.nodeName;return i&&'BODY'!==i&&'HTML'!==i?-1!==['TD','TABLE'].indexOf(o.nodeName)&&'static'===t(o,'position')?r(o):o:e?e.ownerDocument.documentElement:document.documentElement}function p(e){var t=e.nodeName;return'BODY'!==t&&('HTML'===t||r(e.firstElementChild)===e)}function s(e){return null===e.parentNode?e:s(e.parentNode)}function d(e,t){if(!e||!e.nodeType||!t||!t.nodeType)return document.documentElement;var o=e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING,i=o?e:t,n=o?t:e,a=document.createRange();a.setStart(i,0),a.setEnd(n,0);var l=a.commonAncestorContainer;if(e!==l&&t!==l||i.contains(n))return p(l)?l:r(l);var f=s(e);return f.host?d(f.host,t):d(e,s(t).host)}function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'top',o='top'===t?'scrollTop':'scrollLeft',i=e.nodeName;if('BODY'===i||'HTML'===i){var n=e.ownerDocument.documentElement,r=e.ownerDocument.scrollingElement||n;return r[o]}return e[o]}function l(e,t){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=a(t,'top'),n=a(t,'left'),r=o?-1:1;return e.top+=i*r,e.bottom+=i*r,e.left+=n*r,e.right+=n*r,e}function f(e,t){var o='x'===t?'Left':'Top',i='Left'==o?'Right':'Bottom';return parseFloat(e['border'+o+'Width'],10)+parseFloat(e['border'+i+'Width'],10)}function m(e,t,o,i){return J(t['offset'+e],t['scroll'+e],o['client'+e],o['offset'+e],o['scroll'+e],ie()?o['offset'+e]+i['margin'+('Height'===e?'Top':'Left')]+i['margin'+('Height'===e?'Bottom':'Right')]:0)}function h(){var e=document.body,t=document.documentElement,o=ie()&&getComputedStyle(t);return{height:m('Height',e,t,o),width:m('Width',e,t,o)}}function c(e){return se({},e,{right:e.left+e.width,bottom:e.top+e.height})}function g(e){var o={};if(ie())try{o=e.getBoundingClientRect();var i=a(e,'top'),n=a(e,'left');o.top+=i,o.left+=n,o.bottom+=i,o.right+=n}catch(e){}else o=e.getBoundingClientRect();var r={left:o.left,top:o.top,width:o.right-o.left,height:o.bottom-o.top},p='HTML'===e.nodeName?h():{},s=p.width||e.clientWidth||r.right-r.left,d=p.height||e.clientHeight||r.bottom-r.top,l=e.offsetWidth-s,m=e.offsetHeight-d;if(l||m){var g=t(e);l-=f(g,'x'),m-=f(g,'y'),r.width-=l,r.height-=m}return c(r)}function u(e,o){var i=ie(),r='HTML'===o.nodeName,p=g(e),s=g(o),d=n(e),a=t(o),f=parseFloat(a.borderTopWidth,10),m=parseFloat(a.borderLeftWidth,10),h=c({top:p.top-s.top-f,left:p.left-s.left-m,width:p.width,height:p.height});if(h.marginTop=0,h.marginLeft=0,!i&&r){var u=parseFloat(a.marginTop,10),b=parseFloat(a.marginLeft,10);h.top-=f-u,h.bottom-=f-u,h.left-=m-b,h.right-=m-b,h.marginTop=u,h.marginLeft=b}return(i?o.contains(d):o===d&&'BODY'!==d.nodeName)&&(h=l(h,o)),h}function b(e){var t=e.ownerDocument.documentElement,o=u(e,t),i=J(t.clientWidth,window.innerWidth||0),n=J(t.clientHeight,window.innerHeight||0),r=a(t),p=a(t,'left'),s={top:r-o.top+o.marginTop,left:p-o.left+o.marginLeft,width:i,height:n};return c(s)}function w(e){var i=e.nodeName;return'BODY'===i||'HTML'===i?!1:'fixed'===t(e,'position')||w(o(e))}function y(e,t,i,r){var p={top:0,left:0},s=d(e,t);if('viewport'===r)p=b(s);else{var a;'scrollParent'===r?(a=n(o(t)),'BODY'===a.nodeName&&(a=e.ownerDocument.documentElement)):'window'===r?a=e.ownerDocument.documentElement:a=r;var l=u(a,s);if('HTML'===a.nodeName&&!w(s)){var f=h(),m=f.height,c=f.width;p.top+=l.top-l.marginTop,p.bottom=m+l.top,p.left+=l.left-l.marginLeft,p.right=c+l.left}else p=l}return p.left+=i,p.top+=i,p.right-=i,p.bottom-=i,p}function E(e){var t=e.width,o=e.height;return t*o}function v(e,t,o,i,n){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;if(-1===e.indexOf('auto'))return e;var p=y(o,i,r,n),s={top:{width:p.width,height:t.top-p.top},right:{width:p.right-t.right,height:p.height},bottom:{width:p.width,height:p.bottom-t.bottom},left:{width:t.left-p.left,height:p.height}},d=Object.keys(s).map(function(e){return se({key:e},s[e],{area:E(s[e])})}).sort(function(e,t){return t.area-e.area}),a=d.filter(function(e){var t=e.width,i=e.height;return t>=o.clientWidth&&i>=o.clientHeight}),l=0<a.length?a[0].key:d[0].key,f=e.split('-')[1];return l+(f?'-'+f:'')}function O(e,t,o){var i=d(t,o);return u(o,i)}function L(e){var t=getComputedStyle(e),o=parseFloat(t.marginTop)+parseFloat(t.marginBottom),i=parseFloat(t.marginLeft)+parseFloat(t.marginRight),n={width:e.offsetWidth+i,height:e.offsetHeight+o};return n}function x(e){var t={left:'right',right:'left',bottom:'top',top:'bottom'};return e.replace(/left|right|bottom|top/g,function(e){return t[e]})}function S(e,t,o){o=o.split('-')[0];var i=L(e),n={width:i.width,height:i.height},r=-1!==['right','left'].indexOf(o),p=r?'top':'left',s=r?'left':'top',d=r?'height':'width',a=r?'width':'height';return n[p]=t[p]+t[d]/2-i[d]/2,n[s]=o===s?t[s]-i[a]:t[x(s)],n}function T(e,t){return Array.prototype.find?e.find(t):e.filter(t)[0]}function D(e,t,o){if(Array.prototype.findIndex)return e.findIndex(function(e){return e[t]===o});var i=T(e,function(e){return e[t]===o});return e.indexOf(i)}function C(t,o,i){var n=void 0===i?t:t.slice(0,D(t,'name',i));return n.forEach(function(t){t['function']&&console.warn('`modifier.function` is deprecated, use `modifier.fn`!');var i=t['function']||t.fn;t.enabled&&e(i)&&(o.offsets.popper=c(o.offsets.popper),o.offsets.reference=c(o.offsets.reference),o=i(o,t))}),o}function N(){if(!this.state.isDestroyed){var e={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};e.offsets.reference=O(this.state,this.popper,this.reference),e.placement=v(this.options.placement,e.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),e.originalPlacement=e.placement,e.offsets.popper=S(this.popper,e.offsets.reference,e.placement),e.offsets.popper.position='absolute',e=C(this.modifiers,e),this.state.isCreated?this.options.onUpdate(e):(this.state.isCreated=!0,this.options.onCreate(e))}}function k(e,t){return e.some(function(e){var o=e.name,i=e.enabled;return i&&o===t})}function W(e){for(var t=[!1,'ms','Webkit','Moz','O'],o=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<t.length-1;n++){var i=t[n],r=i?''+i+o:e;if('undefined'!=typeof document.body.style[r])return r}return null}function P(){return this.state.isDestroyed=!0,k(this.modifiers,'applyStyle')&&(this.popper.removeAttribute('x-placement'),this.popper.style.left='',this.popper.style.position='',this.popper.style.top='',this.popper.style[W('transform')]=''),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function B(e){var t=e.ownerDocument;return t?t.defaultView:window}function H(e,t,o,i){var r='BODY'===e.nodeName,p=r?e.ownerDocument.defaultView:e;p.addEventListener(t,o,{passive:!0}),r||H(n(p.parentNode),t,o,i),i.push(p)}function A(e,t,o,i){o.updateBound=i,B(e).addEventListener('resize',o.updateBound,{passive:!0});var r=n(e);return H(r,'scroll',o.updateBound,o.scrollParents),o.scrollElement=r,o.eventsEnabled=!0,o}function I(){this.state.eventsEnabled||(this.state=A(this.reference,this.options,this.state,this.scheduleUpdate))}function M(e,t){return B(e).removeEventListener('resize',t.updateBound),t.scrollParents.forEach(function(e){e.removeEventListener('scroll',t.updateBound)}),t.updateBound=null,t.scrollParents=[],t.scrollElement=null,t.eventsEnabled=!1,t}function R(){this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=M(this.reference,this.state))}function U(e){return''!==e&&!isNaN(parseFloat(e))&&isFinite(e)}function Y(e,t){Object.keys(t).forEach(function(o){var i='';-1!==['width','height','top','right','bottom','left'].indexOf(o)&&U(t[o])&&(i='px'),e.style[o]=t[o]+i})}function j(e,t){Object.keys(t).forEach(function(o){var i=t[o];!1===i?e.removeAttribute(o):e.setAttribute(o,t[o])})}function F(e,t,o){var i=T(e,function(e){var o=e.name;return o===t}),n=!!i&&e.some(function(e){return e.name===o&&e.enabled&&e.order<i.order});if(!n){var r='`'+t+'`';console.warn('`'+o+'`'+' modifier is required by '+r+' modifier in order to work, be sure to include it before '+r+'!')}return n}function K(e){return'end'===e?'start':'start'===e?'end':e}function q(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=ae.indexOf(e),i=ae.slice(o+1).concat(ae.slice(0,o));return t?i.reverse():i}function V(e,t,o,i){var n=e.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),r=+n[1],p=n[2];if(!r)return e;if(0===p.indexOf('%')){var s;switch(p){case'%p':s=o;break;case'%':case'%r':default:s=i;}var d=c(s);return d[t]/100*r}if('vh'===p||'vw'===p){var a;return a='vh'===p?J(document.documentElement.clientHeight,window.innerHeight||0):J(document.documentElement.clientWidth,window.innerWidth||0),a/100*r}return r}function z(e,t,o,i){var n=[0,0],r=-1!==['right','left'].indexOf(i),p=e.split(/(\+|\-)/).map(function(e){return e.trim()}),s=p.indexOf(T(p,function(e){return-1!==e.search(/,|\s/)}));p[s]&&-1===p[s].indexOf(',')&&console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');var d=/\s*,\s*|\s+/,a=-1===s?[p]:[p.slice(0,s).concat([p[s].split(d)[0]]),[p[s].split(d)[1]].concat(p.slice(s+1))];return a=a.map(function(e,i){var n=(1===i?!r:r)?'height':'width',p=!1;return e.reduce(function(e,t){return''===e[e.length-1]&&-1!==['+','-'].indexOf(t)?(e[e.length-1]=t,p=!0,e):p?(e[e.length-1]+=t,p=!1,e):e.concat(t)},[]).map(function(e){return V(e,n,t,o)})}),a.forEach(function(e,t){e.forEach(function(o,i){U(o)&&(n[t]+=o*('-'===e[i-1]?-1:1))})}),n}function G(e,t){var o,i=t.offset,n=e.placement,r=e.offsets,p=r.popper,s=r.reference,d=n.split('-')[0];return o=U(+i)?[+i,0]:z(i,p,s,d),'left'===d?(p.top+=o[0],p.left-=o[1]):'right'===d?(p.top+=o[0],p.left+=o[1]):'top'===d?(p.left+=o[0],p.top-=o[1]):'bottom'===d&&(p.left+=o[0],p.top+=o[1]),e.popper=p,e}for(var _=Math.min,X=Math.floor,J=Math.max,Q='undefined'!=typeof window&&'undefined'!=typeof document,Z=['Edge','Trident','Firefox'],$=0,ee=0;ee<Z.length;ee+=1)if(Q&&0<=navigator.userAgent.indexOf(Z[ee])){$=1;break}var i,te=Q&&window.Promise,oe=te?function(e){var t=!1;return function(){t||(t=!0,window.Promise.resolve().then(function(){t=!1,e()}))}}:function(e){var t=!1;return function(){t||(t=!0,setTimeout(function(){t=!1,e()},$))}},ie=function(){return void 0==i&&(i=-1!==navigator.appVersion.indexOf('MSIE 10')),i},ne=function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')},re=function(){function e(e,t){for(var o,n=0;n<t.length;n++)o=t[n],o.enumerable=o.enumerable||!1,o.configurable=!0,'value'in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),pe=function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e},se=Object.assign||function(e){for(var t,o=1;o<arguments.length;o++)for(var i in t=arguments[o],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},de=['auto-start','auto','auto-end','top-start','top','top-end','right-start','right','right-end','bottom-end','bottom','bottom-start','left-end','left','left-start'],ae=de.slice(3),le={FLIP:'flip',CLOCKWISE:'clockwise',COUNTERCLOCKWISE:'counterclockwise'},fe=function(){function t(o,i){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};ne(this,t),this.scheduleUpdate=function(){return requestAnimationFrame(n.update)},this.update=oe(this.update.bind(this)),this.options=se({},t.Defaults,r),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=o&&o.jquery?o[0]:o,this.popper=i&&i.jquery?i[0]:i,this.options.modifiers={},Object.keys(se({},t.Defaults.modifiers,r.modifiers)).forEach(function(e){n.options.modifiers[e]=se({},t.Defaults.modifiers[e]||{},r.modifiers?r.modifiers[e]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(e){return se({name:e},n.options.modifiers[e])}).sort(function(e,t){return e.order-t.order}),this.modifiers.forEach(function(t){t.enabled&&e(t.onLoad)&&t.onLoad(n.reference,n.popper,n.options,t,n.state)}),this.update();var p=this.options.eventsEnabled;p&&this.enableEventListeners(),this.state.eventsEnabled=p}return re(t,[{key:'update',value:function(){return N.call(this)}},{key:'destroy',value:function(){return P.call(this)}},{key:'enableEventListeners',value:function(){return I.call(this)}},{key:'disableEventListeners',value:function(){return R.call(this)}}]),t}();return fe.Utils=('undefined'==typeof window?global:window).PopperUtils,fe.placements=de,fe.Defaults={placement:'bottom',eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:{shift:{order:100,enabled:!0,fn:function(e){var t=e.placement,o=t.split('-')[0],i=t.split('-')[1];if(i){var n=e.offsets,r=n.reference,p=n.popper,s=-1!==['bottom','top'].indexOf(o),d=s?'left':'top',a=s?'width':'height',l={start:pe({},d,r[d]),end:pe({},d,r[d]+r[a]-p[a])};e.offsets.popper=se({},p,l[i])}return e}},offset:{order:200,enabled:!0,fn:G,offset:0},preventOverflow:{order:300,enabled:!0,fn:function(e,t){var o=t.boundariesElement||r(e.instance.popper);e.instance.reference===o&&(o=r(o));var i=y(e.instance.popper,e.instance.reference,t.padding,o);t.boundaries=i;var n=t.priority,p=e.offsets.popper,s={primary:function(e){var o=p[e];return p[e]<i[e]&&!t.escapeWithReference&&(o=J(p[e],i[e])),pe({},e,o)},secondary:function(e){var o='right'===e?'left':'top',n=p[o];return p[e]>i[e]&&!t.escapeWithReference&&(n=_(p[o],i[e]-('right'===e?p.width:p.height))),pe({},o,n)}};return n.forEach(function(e){var t=-1===['left','top'].indexOf(e)?'secondary':'primary';p=se({},p,s[t](e))}),e.offsets.popper=p,e},priority:['left','right','top','bottom'],padding:5,boundariesElement:'scrollParent'},keepTogether:{order:400,enabled:!0,fn:function(e){var t=e.offsets,o=t.popper,i=t.reference,n=e.placement.split('-')[0],r=X,p=-1!==['top','bottom'].indexOf(n),s=p?'right':'bottom',d=p?'left':'top',a=p?'width':'height';return o[s]<r(i[d])&&(e.offsets.popper[d]=r(i[d])-o[a]),o[d]>r(i[s])&&(e.offsets.popper[d]=r(i[s])),e}},arrow:{order:500,enabled:!0,fn:function(e,o){var i;if(!F(e.instance.modifiers,'arrow','keepTogether'))return e;var n=o.element;if('string'==typeof n){if(n=e.instance.popper.querySelector(n),!n)return e;}else if(!e.instance.popper.contains(n))return console.warn('WARNING: `arrow.element` must be child of its popper element!'),e;var r=e.placement.split('-')[0],p=e.offsets,s=p.popper,d=p.reference,a=-1!==['left','right'].indexOf(r),l=a?'height':'width',f=a?'Top':'Left',m=f.toLowerCase(),h=a?'left':'top',g=a?'bottom':'right',u=L(n)[l];d[g]-u<s[m]&&(e.offsets.popper[m]-=s[m]-(d[g]-u)),d[m]+u>s[g]&&(e.offsets.popper[m]+=d[m]+u-s[g]),e.offsets.popper=c(e.offsets.popper);var b=d[m]+d[l]/2-u/2,w=t(e.instance.popper),y=parseFloat(w['margin'+f],10),E=parseFloat(w['border'+f+'Width'],10),v=b-e.offsets.popper[m]-y-E;return v=J(_(s[l]-u,v),0),e.arrowElement=n,e.offsets.arrow=(i={},pe(i,m,Math.round(v)),pe(i,h,''),i),e},element:'[x-arrow]'},flip:{order:600,enabled:!0,fn:function(e,t){if(k(e.instance.modifiers,'inner'))return e;if(e.flipped&&e.placement===e.originalPlacement)return e;var o=y(e.instance.popper,e.instance.reference,t.padding,t.boundariesElement),i=e.placement.split('-')[0],n=x(i),r=e.placement.split('-')[1]||'',p=[];switch(t.behavior){case le.FLIP:p=[i,n];break;case le.CLOCKWISE:p=q(i);break;case le.COUNTERCLOCKWISE:p=q(i,!0);break;default:p=t.behavior;}return p.forEach(function(s,d){if(i!==s||p.length===d+1)return e;i=e.placement.split('-')[0],n=x(i);var a=e.offsets.popper,l=e.offsets.reference,f=X,m='left'===i&&f(a.right)>f(l.left)||'right'===i&&f(a.left)<f(l.right)||'top'===i&&f(a.bottom)>f(l.top)||'bottom'===i&&f(a.top)<f(l.bottom),h=f(a.left)<f(o.left),c=f(a.right)>f(o.right),g=f(a.top)<f(o.top),u=f(a.bottom)>f(o.bottom),b='left'===i&&h||'right'===i&&c||'top'===i&&g||'bottom'===i&&u,w=-1!==['top','bottom'].indexOf(i),y=!!t.flipVariations&&(w&&'start'===r&&h||w&&'end'===r&&c||!w&&'start'===r&&g||!w&&'end'===r&&u);(m||b||y)&&(e.flipped=!0,(m||b)&&(i=p[d+1]),y&&(r=K(r)),e.placement=i+(r?'-'+r:''),e.offsets.popper=se({},e.offsets.popper,S(e.instance.popper,e.offsets.reference,e.placement)),e=C(e.instance.modifiers,e,'flip'))}),e},behavior:'flip',padding:5,boundariesElement:'viewport'},inner:{order:700,enabled:!1,fn:function(e){var t=e.placement,o=t.split('-')[0],i=e.offsets,n=i.popper,r=i.reference,p=-1!==['left','right'].indexOf(o),s=-1===['top','left'].indexOf(o);return n[p?'left':'top']=r[o]-(s?n[p?'width':'height']:0),e.placement=x(t),e.offsets.popper=c(n),e}},hide:{order:800,enabled:!0,fn:function(e){if(!F(e.instance.modifiers,'hide','preventOverflow'))return e;var t=e.offsets.reference,o=T(e.instance.modifiers,function(e){return'preventOverflow'===e.name}).boundaries;if(t.bottom<o.top||t.left>o.right||t.top>o.bottom||t.right<o.left){if(!0===e.hide)return e;e.hide=!0,e.attributes['x-out-of-boundaries']=''}else{if(!1===e.hide)return e;e.hide=!1,e.attributes['x-out-of-boundaries']=!1}return e}},computeStyle:{order:850,enabled:!0,fn:function(e,t){var o=t.x,i=t.y,n=e.offsets.popper,p=T(e.instance.modifiers,function(e){return'applyStyle'===e.name}).gpuAcceleration;void 0!==p&&console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');var s,d,a=void 0===p?t.gpuAcceleration:p,l=r(e.instance.popper),f=g(l),m={position:n.position},h={left:X(n.left),top:X(n.top),bottom:X(n.bottom),right:X(n.right)},c='bottom'===o?'top':'bottom',u='right'===i?'left':'right',b=W('transform');if(d='bottom'==c?-f.height+h.bottom:h.top,s='right'==u?-f.width+h.right:h.left,a&&b)m[b]='translate3d('+s+'px, '+d+'px, 0)',m[c]=0,m[u]=0,m.willChange='transform';else{var w='bottom'==c?-1:1,y='right'==u?-1:1;m[c]=d*w,m[u]=s*y,m.willChange=c+', '+u}var E={"x-placement":e.placement};return e.attributes=se({},E,e.attributes),e.styles=se({},m,e.styles),e.arrowStyles=se({},e.offsets.arrow,e.arrowStyles),e},gpuAcceleration:!0,x:'bottom',y:'right'},applyStyle:{order:900,enabled:!0,fn:function(e){return Y(e.instance.popper,e.styles),j(e.instance.popper,e.attributes),e.arrowElement&&Object.keys(e.arrowStyles).length&&Y(e.arrowElement,e.arrowStyles),e},onLoad:function(e,t,o,i,n){var r=O(n,t,e),p=v(o.placement,r,t,e,o.modifiers.flip.boundariesElement,o.modifiers.flip.padding);return t.setAttribute('x-placement',p),Y(t,{position:'absolute'}),o},gpuAcceleration:void 0}}},fe});

/*! 
 * Bootstrap
 * https://github.com/twbs/bootstrap
 * 
 * Copyright (c) 2011-2018 The Bootstrap Authors
 * Licensed under MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery"),require("popper.js")):"function"==typeof define&&define.amd?define(["exports","jquery","popper.js"],e):e(t.bootstrap={},t.jQuery,t.Popper)}(this,function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(){return(r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var o,a,l,h,c,u,f,d,_,g,p,m,v,E,T,y,C,I,A,b,D,S,w,N,O,k,P=function(t){var e=!1;function n(e){var n=this,s=!1;return t(this).one(i.TRANSITION_END,function(){s=!0}),setTimeout(function(){s||i.triggerTransitionEnd(n)},e),this}var i={TRANSITION_END:"bsTransitionEnd",getUID:function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},getSelectorFromElement:function(e){var n,i=e.getAttribute("data-target");i&&"#"!==i||(i=e.getAttribute("href")||""),"#"===i.charAt(0)&&(n=i,i=n="function"==typeof t.escapeSelector?t.escapeSelector(n).substr(1):n.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1"));try{return t(document).find(i).length>0?i:null}catch(t){return null}},reflow:function(t){return t.offsetHeight},triggerTransitionEnd:function(n){t(n).trigger(e.end)},supportsTransitionEnd:function(){return Boolean(e)},isElement:function(t){return(t[0]||t).nodeType},typeCheckConfig:function(t,e,n){for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){var r=n[s],o=e[s],a=o&&i.isElement(o)?"element":(l=o,{}.toString.call(l).match(/\s([a-zA-Z]+)/)[1].toLowerCase());if(!new RegExp(r).test(a))throw new Error(t.toUpperCase()+': Option "'+s+'" provided type "'+a+'" but expected type "'+r+'".')}var l}};return e=("undefined"==typeof window||!window.QUnit)&&{end:"transitionend"},t.fn.emulateTransitionEnd=n,i.supportsTransitionEnd()&&(t.event.special[i.TRANSITION_END]={bindType:e.end,delegateType:e.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}}),i}(e),L=(a="alert",h="."+(l="bs.alert"),c=(o=e).fn[a],u={CLOSE:"close"+h,CLOSED:"closed"+h,CLICK_DATA_API:"click"+h+".data-api"},f="alert",d="fade",_="show",g=function(){function t(t){this._element=t}var e=t.prototype;return e.close=function(t){t=t||this._element;var e=this._getRootElement(t);this._triggerCloseEvent(e).isDefaultPrevented()||this._removeElement(e)},e.dispose=function(){o.removeData(this._element,l),this._element=null},e._getRootElement=function(t){var e=P.getSelectorFromElement(t),n=!1;return e&&(n=o(e)[0]),n||(n=o(t).closest("."+f)[0]),n},e._triggerCloseEvent=function(t){var e=o.Event(u.CLOSE);return o(t).trigger(e),e},e._removeElement=function(t){var e=this;o(t).removeClass(_),P.supportsTransitionEnd()&&o(t).hasClass(d)?o(t).one(P.TRANSITION_END,function(n){return e._destroyElement(t,n)}).emulateTransitionEnd(150):this._destroyElement(t)},e._destroyElement=function(t){o(t).detach().trigger(u.CLOSED).remove()},t._jQueryInterface=function(e){return this.each(function(){var n=o(this),i=n.data(l);i||(i=new t(this),n.data(l,i)),"close"===e&&i[e](this)})},t._handleDismiss=function(t){return function(e){e&&e.preventDefault(),t.close(this)}},s(t,null,[{key:"VERSION",get:function(){return"4.0.0"}}]),t}(),o(document).on(u.CLICK_DATA_API,'[data-dismiss="alert"]',g._handleDismiss(new g)),o.fn[a]=g._jQueryInterface,o.fn[a].Constructor=g,o.fn[a].noConflict=function(){return o.fn[a]=c,g._jQueryInterface},g),R=(m="button",E="."+(v="bs.button"),T=".data-api",y=(p=e).fn[m],C="active",I="btn",A="focus",b='[data-toggle^="button"]',D='[data-toggle="buttons"]',S="input",w=".active",N=".btn",O={CLICK_DATA_API:"click"+E+T,FOCUS_BLUR_DATA_API:"focus"+E+T+" blur"+E+T},k=function(){function t(t){this._element=t}var e=t.prototype;return e.toggle=function(){var t=!0,e=!0,n=p(this._element).closest(D)[0];if(n){var i=p(this._element).find(S)[0];if(i){if("radio"===i.type)if(i.checked&&p(this._element).hasClass(C))t=!1;else{var s=p(n).find(w)[0];s&&p(s).removeClass(C)}if(t){if(i.hasAttribute("disabled")||n.hasAttribute("disabled")||i.classList.contains("disabled")||n.classList.contains("disabled"))return;i.checked=!p(this._element).hasClass(C),p(i).trigger("change")}i.focus(),e=!1}}e&&this._element.setAttribute("aria-pressed",!p(this._element).hasClass(C)),t&&p(this._element).toggleClass(C)},e.dispose=function(){p.removeData(this._element,v),this._element=null},t._jQueryInterface=function(e){return this.each(function(){var n=p(this).data(v);n||(n=new t(this),p(this).data(v,n)),"toggle"===e&&n[e]()})},s(t,null,[{key:"VERSION",get:function(){return"4.0.0"}}]),t}(),p(document).on(O.CLICK_DATA_API,b,function(t){t.preventDefault();var e=t.target;p(e).hasClass(I)||(e=p(e).closest(N)),k._jQueryInterface.call(p(e),"toggle")}).on(O.FOCUS_BLUR_DATA_API,b,function(t){var e=p(t.target).closest(N)[0];p(e).toggleClass(A,/^focus(in)?$/.test(t.type))}),p.fn[m]=k._jQueryInterface,p.fn[m].Constructor=k,p.fn[m].noConflict=function(){return p.fn[m]=y,k._jQueryInterface},k),j=function(t){var e="carousel",n="bs.carousel",i="."+n,o=t.fn[e],a={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0},l={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean"},h="next",c="prev",u="left",f="right",d={SLIDE:"slide"+i,SLID:"slid"+i,KEYDOWN:"keydown"+i,MOUSEENTER:"mouseenter"+i,MOUSELEAVE:"mouseleave"+i,TOUCHEND:"touchend"+i,LOAD_DATA_API:"load"+i+".data-api",CLICK_DATA_API:"click"+i+".data-api"},_="carousel",g="active",p="slide",m="carousel-item-right",v="carousel-item-left",E="carousel-item-next",T="carousel-item-prev",y={ACTIVE:".active",ACTIVE_ITEM:".active.carousel-item",ITEM:".carousel-item",NEXT_PREV:".carousel-item-next, .carousel-item-prev",INDICATORS:".carousel-indicators",DATA_SLIDE:"[data-slide], [data-slide-to]",DATA_RIDE:'[data-ride="carousel"]'},C=function(){function o(e,n){this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this._config=this._getConfig(n),this._element=t(e)[0],this._indicatorsElement=t(this._element).find(y.INDICATORS)[0],this._addEventListeners()}var C=o.prototype;return C.next=function(){this._isSliding||this._slide(h)},C.nextWhenVisible=function(){!document.hidden&&t(this._element).is(":visible")&&"hidden"!==t(this._element).css("visibility")&&this.next()},C.prev=function(){this._isSliding||this._slide(c)},C.pause=function(e){e||(this._isPaused=!0),t(this._element).find(y.NEXT_PREV)[0]&&P.supportsTransitionEnd()&&(P.triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null},C.cycle=function(t){t||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))},C.to=function(e){var n=this;this._activeElement=t(this._element).find(y.ACTIVE_ITEM)[0];var i=this._getItemIndex(this._activeElement);if(!(e>this._items.length-1||e<0))if(this._isSliding)t(this._element).one(d.SLID,function(){return n.to(e)});else{if(i===e)return this.pause(),void this.cycle();var s=e>i?h:c;this._slide(s,this._items[e])}},C.dispose=function(){t(this._element).off(i),t.removeData(this._element,n),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null},C._getConfig=function(t){return t=r({},a,t),P.typeCheckConfig(e,t,l),t},C._addEventListeners=function(){var e=this;this._config.keyboard&&t(this._element).on(d.KEYDOWN,function(t){return e._keydown(t)}),"hover"===this._config.pause&&(t(this._element).on(d.MOUSEENTER,function(t){return e.pause(t)}).on(d.MOUSELEAVE,function(t){return e.cycle(t)}),"ontouchstart"in document.documentElement&&t(this._element).on(d.TOUCHEND,function(){e.pause(),e.touchTimeout&&clearTimeout(e.touchTimeout),e.touchTimeout=setTimeout(function(t){return e.cycle(t)},500+e._config.interval)}))},C._keydown=function(t){if(!/input|textarea/i.test(t.target.tagName))switch(t.which){case 37:t.preventDefault(),this.prev();break;case 39:t.preventDefault(),this.next()}},C._getItemIndex=function(e){return this._items=t.makeArray(t(e).parent().find(y.ITEM)),this._items.indexOf(e)},C._getItemByDirection=function(t,e){var n=t===h,i=t===c,s=this._getItemIndex(e),r=this._items.length-1;if((i&&0===s||n&&s===r)&&!this._config.wrap)return e;var o=(s+(t===c?-1:1))%this._items.length;return-1===o?this._items[this._items.length-1]:this._items[o]},C._triggerSlideEvent=function(e,n){var i=this._getItemIndex(e),s=this._getItemIndex(t(this._element).find(y.ACTIVE_ITEM)[0]),r=t.Event(d.SLIDE,{relatedTarget:e,direction:n,from:s,to:i});return t(this._element).trigger(r),r},C._setActiveIndicatorElement=function(e){if(this._indicatorsElement){t(this._indicatorsElement).find(y.ACTIVE).removeClass(g);var n=this._indicatorsElement.children[this._getItemIndex(e)];n&&t(n).addClass(g)}},C._slide=function(e,n){var i,s,r,o=this,a=t(this._element).find(y.ACTIVE_ITEM)[0],l=this._getItemIndex(a),c=n||a&&this._getItemByDirection(e,a),_=this._getItemIndex(c),C=Boolean(this._interval);if(e===h?(i=v,s=E,r=u):(i=m,s=T,r=f),c&&t(c).hasClass(g))this._isSliding=!1;else if(!this._triggerSlideEvent(c,r).isDefaultPrevented()&&a&&c){this._isSliding=!0,C&&this.pause(),this._setActiveIndicatorElement(c);var I=t.Event(d.SLID,{relatedTarget:c,direction:r,from:l,to:_});P.supportsTransitionEnd()&&t(this._element).hasClass(p)?(t(c).addClass(s),P.reflow(c),t(a).addClass(i),t(c).addClass(i),t(a).one(P.TRANSITION_END,function(){t(c).removeClass(i+" "+s).addClass(g),t(a).removeClass(g+" "+s+" "+i),o._isSliding=!1,setTimeout(function(){return t(o._element).trigger(I)},0)}).emulateTransitionEnd(600)):(t(a).removeClass(g),t(c).addClass(g),this._isSliding=!1,t(this._element).trigger(I)),C&&this.cycle()}},o._jQueryInterface=function(e){return this.each(function(){var i=t(this).data(n),s=r({},a,t(this).data());"object"==typeof e&&(s=r({},s,e));var l="string"==typeof e?e:s.slide;if(i||(i=new o(this,s),t(this).data(n,i)),"number"==typeof e)i.to(e);else if("string"==typeof l){if("undefined"==typeof i[l])throw new TypeError('No method named "'+l+'"');i[l]()}else s.interval&&(i.pause(),i.cycle())})},o._dataApiClickHandler=function(e){var i=P.getSelectorFromElement(this);if(i){var s=t(i)[0];if(s&&t(s).hasClass(_)){var a=r({},t(s).data(),t(this).data()),l=this.getAttribute("data-slide-to");l&&(a.interval=!1),o._jQueryInterface.call(t(s),a),l&&t(s).data(n).to(l),e.preventDefault()}}},s(o,null,[{key:"VERSION",get:function(){return"4.0.0"}},{key:"Default",get:function(){return a}}]),o}();return t(document).on(d.CLICK_DATA_API,y.DATA_SLIDE,C._dataApiClickHandler),t(window).on(d.LOAD_DATA_API,function(){t(y.DATA_RIDE).each(function(){var e=t(this);C._jQueryInterface.call(e,e.data())})}),t.fn[e]=C._jQueryInterface,t.fn[e].Constructor=C,t.fn[e].noConflict=function(){return t.fn[e]=o,C._jQueryInterface},C}(e),H=function(t){var e="collapse",n="bs.collapse",i="."+n,o=t.fn[e],a={toggle:!0,parent:""},l={toggle:"boolean",parent:"(string|element)"},h={SHOW:"show"+i,SHOWN:"shown"+i,HIDE:"hide"+i,HIDDEN:"hidden"+i,CLICK_DATA_API:"click"+i+".data-api"},c="show",u="collapse",f="collapsing",d="collapsed",_="width",g="height",p={ACTIVES:".show, .collapsing",DATA_TOGGLE:'[data-toggle="collapse"]'},m=function(){function i(e,n){this._isTransitioning=!1,this._element=e,this._config=this._getConfig(n),this._triggerArray=t.makeArray(t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'));for(var i=t(p.DATA_TOGGLE),s=0;s<i.length;s++){var r=i[s],o=P.getSelectorFromElement(r);null!==o&&t(o).filter(e).length>0&&(this._selector=o,this._triggerArray.push(r))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}var o=i.prototype;return o.toggle=function(){t(this._element).hasClass(c)?this.hide():this.show()},o.show=function(){var e,s,r=this;if(!this._isTransitioning&&!t(this._element).hasClass(c)&&(this._parent&&0===(e=t.makeArray(t(this._parent).find(p.ACTIVES).filter('[data-parent="'+this._config.parent+'"]'))).length&&(e=null),!(e&&(s=t(e).not(this._selector).data(n))&&s._isTransitioning))){var o=t.Event(h.SHOW);if(t(this._element).trigger(o),!o.isDefaultPrevented()){e&&(i._jQueryInterface.call(t(e).not(this._selector),"hide"),s||t(e).data(n,null));var a=this._getDimension();t(this._element).removeClass(u).addClass(f),this._element.style[a]=0,this._triggerArray.length>0&&t(this._triggerArray).removeClass(d).attr("aria-expanded",!0),this.setTransitioning(!0);var l=function(){t(r._element).removeClass(f).addClass(u).addClass(c),r._element.style[a]="",r.setTransitioning(!1),t(r._element).trigger(h.SHOWN)};if(P.supportsTransitionEnd()){var _="scroll"+(a[0].toUpperCase()+a.slice(1));t(this._element).one(P.TRANSITION_END,l).emulateTransitionEnd(600),this._element.style[a]=this._element[_]+"px"}else l()}}},o.hide=function(){var e=this;if(!this._isTransitioning&&t(this._element).hasClass(c)){var n=t.Event(h.HIDE);if(t(this._element).trigger(n),!n.isDefaultPrevented()){var i=this._getDimension();if(this._element.style[i]=this._element.getBoundingClientRect()[i]+"px",P.reflow(this._element),t(this._element).addClass(f).removeClass(u).removeClass(c),this._triggerArray.length>0)for(var s=0;s<this._triggerArray.length;s++){var r=this._triggerArray[s],o=P.getSelectorFromElement(r);if(null!==o)t(o).hasClass(c)||t(r).addClass(d).attr("aria-expanded",!1)}this.setTransitioning(!0);var a=function(){e.setTransitioning(!1),t(e._element).removeClass(f).addClass(u).trigger(h.HIDDEN)};this._element.style[i]="",P.supportsTransitionEnd()?t(this._element).one(P.TRANSITION_END,a).emulateTransitionEnd(600):a()}}},o.setTransitioning=function(t){this._isTransitioning=t},o.dispose=function(){t.removeData(this._element,n),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null},o._getConfig=function(t){return(t=r({},a,t)).toggle=Boolean(t.toggle),P.typeCheckConfig(e,t,l),t},o._getDimension=function(){return t(this._element).hasClass(_)?_:g},o._getParent=function(){var e=this,n=null;P.isElement(this._config.parent)?(n=this._config.parent,"undefined"!=typeof this._config.parent.jquery&&(n=this._config.parent[0])):n=t(this._config.parent)[0];var s='[data-toggle="collapse"][data-parent="'+this._config.parent+'"]';return t(n).find(s).each(function(t,n){e._addAriaAndCollapsedClass(i._getTargetFromElement(n),[n])}),n},o._addAriaAndCollapsedClass=function(e,n){if(e){var i=t(e).hasClass(c);n.length>0&&t(n).toggleClass(d,!i).attr("aria-expanded",i)}},i._getTargetFromElement=function(e){var n=P.getSelectorFromElement(e);return n?t(n)[0]:null},i._jQueryInterface=function(e){return this.each(function(){var s=t(this),o=s.data(n),l=r({},a,s.data(),"object"==typeof e&&e);if(!o&&l.toggle&&/show|hide/.test(e)&&(l.toggle=!1),o||(o=new i(this,l),s.data(n,o)),"string"==typeof e){if("undefined"==typeof o[e])throw new TypeError('No method named "'+e+'"');o[e]()}})},s(i,null,[{key:"VERSION",get:function(){return"4.0.0"}},{key:"Default",get:function(){return a}}]),i}();return t(document).on(h.CLICK_DATA_API,p.DATA_TOGGLE,function(e){"A"===e.currentTarget.tagName&&e.preventDefault();var i=t(this),s=P.getSelectorFromElement(this);t(s).each(function(){var e=t(this),s=e.data(n)?"toggle":i.data();m._jQueryInterface.call(e,s)})}),t.fn[e]=m._jQueryInterface,t.fn[e].Constructor=m,t.fn[e].noConflict=function(){return t.fn[e]=o,m._jQueryInterface},m}(e),W=function(t){var e="dropdown",i="bs.dropdown",o="."+i,a=".data-api",l=t.fn[e],h=new RegExp("38|40|27"),c={HIDE:"hide"+o,HIDDEN:"hidden"+o,SHOW:"show"+o,SHOWN:"shown"+o,CLICK:"click"+o,CLICK_DATA_API:"click"+o+a,KEYDOWN_DATA_API:"keydown"+o+a,KEYUP_DATA_API:"keyup"+o+a},u="disabled",f="show",d="dropup",_="dropright",g="dropleft",p="dropdown-menu-right",m="dropdown-menu-left",v="position-static",E='[data-toggle="dropdown"]',T=".dropdown form",y=".dropdown-menu",C=".navbar-nav",I=".dropdown-menu .dropdown-item:not(.disabled)",A="top-start",b="top-end",D="bottom-start",S="bottom-end",w="right-start",N="left-start",O={offset:0,flip:!0,boundary:"scrollParent"},k={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)"},L=function(){function a(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}var l=a.prototype;return l.toggle=function(){if(!this._element.disabled&&!t(this._element).hasClass(u)){var e=a._getParentFromElement(this._element),i=t(this._menu).hasClass(f);if(a._clearMenus(),!i){var s={relatedTarget:this._element},r=t.Event(c.SHOW,s);if(t(e).trigger(r),!r.isDefaultPrevented()){if(!this._inNavbar){if("undefined"==typeof n)throw new TypeError("Bootstrap dropdown require Popper.js (https://popper.js.org)");var o=this._element;t(e).hasClass(d)&&(t(this._menu).hasClass(m)||t(this._menu).hasClass(p))&&(o=e),"scrollParent"!==this._config.boundary&&t(e).addClass(v),this._popper=new n(o,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===t(e).closest(C).length&&t("body").children().on("mouseover",null,t.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),t(this._menu).toggleClass(f),t(e).toggleClass(f).trigger(t.Event(c.SHOWN,s))}}}},l.dispose=function(){t.removeData(this._element,i),t(this._element).off(o),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)},l.update=function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()},l._addEventListeners=function(){var e=this;t(this._element).on(c.CLICK,function(t){t.preventDefault(),t.stopPropagation(),e.toggle()})},l._getConfig=function(n){return n=r({},this.constructor.Default,t(this._element).data(),n),P.typeCheckConfig(e,n,this.constructor.DefaultType),n},l._getMenuElement=function(){if(!this._menu){var e=a._getParentFromElement(this._element);this._menu=t(e).find(y)[0]}return this._menu},l._getPlacement=function(){var e=t(this._element).parent(),n=D;return e.hasClass(d)?(n=A,t(this._menu).hasClass(p)&&(n=b)):e.hasClass(_)?n=w:e.hasClass(g)?n=N:t(this._menu).hasClass(p)&&(n=S),n},l._detectNavbar=function(){return t(this._element).closest(".navbar").length>0},l._getPopperConfig=function(){var t=this,e={};return"function"==typeof this._config.offset?e.fn=function(e){return e.offsets=r({},e.offsets,t._config.offset(e.offsets)||{}),e}:e.offset=this._config.offset,{placement:this._getPlacement(),modifiers:{offset:e,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}}},a._jQueryInterface=function(e){return this.each(function(){var n=t(this).data(i);if(n||(n=new a(this,"object"==typeof e?e:null),t(this).data(i,n)),"string"==typeof e){if("undefined"==typeof n[e])throw new TypeError('No method named "'+e+'"');n[e]()}})},a._clearMenus=function(e){if(!e||3!==e.which&&("keyup"!==e.type||9===e.which))for(var n=t.makeArray(t(E)),s=0;s<n.length;s++){var r=a._getParentFromElement(n[s]),o=t(n[s]).data(i),l={relatedTarget:n[s]};if(o){var h=o._menu;if(t(r).hasClass(f)&&!(e&&("click"===e.type&&/input|textarea/i.test(e.target.tagName)||"keyup"===e.type&&9===e.which)&&t.contains(r,e.target))){var u=t.Event(c.HIDE,l);t(r).trigger(u),u.isDefaultPrevented()||("ontouchstart"in document.documentElement&&t("body").children().off("mouseover",null,t.noop),n[s].setAttribute("aria-expanded","false"),t(h).removeClass(f),t(r).removeClass(f).trigger(t.Event(c.HIDDEN,l)))}}}},a._getParentFromElement=function(e){var n,i=P.getSelectorFromElement(e);return i&&(n=t(i)[0]),n||e.parentNode},a._dataApiKeydownHandler=function(e){if((/input|textarea/i.test(e.target.tagName)?!(32===e.which||27!==e.which&&(40!==e.which&&38!==e.which||t(e.target).closest(y).length)):h.test(e.which))&&(e.preventDefault(),e.stopPropagation(),!this.disabled&&!t(this).hasClass(u))){var n=a._getParentFromElement(this),i=t(n).hasClass(f);if((i||27===e.which&&32===e.which)&&(!i||27!==e.which&&32!==e.which)){var s=t(n).find(I).get();if(0!==s.length){var r=s.indexOf(e.target);38===e.which&&r>0&&r--,40===e.which&&r<s.length-1&&r++,r<0&&(r=0),s[r].focus()}}else{if(27===e.which){var o=t(n).find(E)[0];t(o).trigger("focus")}t(this).trigger("click")}}},s(a,null,[{key:"VERSION",get:function(){return"4.0.0"}},{key:"Default",get:function(){return O}},{key:"DefaultType",get:function(){return k}}]),a}();return t(document).on(c.KEYDOWN_DATA_API,E,L._dataApiKeydownHandler).on(c.KEYDOWN_DATA_API,y,L._dataApiKeydownHandler).on(c.CLICK_DATA_API+" "+c.KEYUP_DATA_API,L._clearMenus).on(c.CLICK_DATA_API,E,function(e){e.preventDefault(),e.stopPropagation(),L._jQueryInterface.call(t(this),"toggle")}).on(c.CLICK_DATA_API,T,function(t){t.stopPropagation()}),t.fn[e]=L._jQueryInterface,t.fn[e].Constructor=L,t.fn[e].noConflict=function(){return t.fn[e]=l,L._jQueryInterface},L}(e),M=function(t){var e="modal",n="bs.modal",i="."+n,o=t.fn.modal,a={backdrop:!0,keyboard:!0,focus:!0,show:!0},l={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},h={HIDE:"hide"+i,HIDDEN:"hidden"+i,SHOW:"show"+i,SHOWN:"shown"+i,FOCUSIN:"focusin"+i,RESIZE:"resize"+i,CLICK_DISMISS:"click.dismiss"+i,KEYDOWN_DISMISS:"keydown.dismiss"+i,MOUSEUP_DISMISS:"mouseup.dismiss"+i,MOUSEDOWN_DISMISS:"mousedown.dismiss"+i,CLICK_DATA_API:"click"+i+".data-api"},c="modal-scrollbar-measure",u="modal-backdrop",f="modal-open",d="fade",_="show",g={DIALOG:".modal-dialog",DATA_TOGGLE:'[data-toggle="modal"]',DATA_DISMISS:'[data-dismiss="modal"]',FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"},p=function(){function o(e,n){this._config=this._getConfig(n),this._element=e,this._dialog=t(e).find(g.DIALOG)[0],this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._originalBodyPadding=0,this._scrollbarWidth=0}var p=o.prototype;return p.toggle=function(t){return this._isShown?this.hide():this.show(t)},p.show=function(e){var n=this;if(!this._isTransitioning&&!this._isShown){P.supportsTransitionEnd()&&t(this._element).hasClass(d)&&(this._isTransitioning=!0);var i=t.Event(h.SHOW,{relatedTarget:e});t(this._element).trigger(i),this._isShown||i.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),t(document.body).addClass(f),this._setEscapeEvent(),this._setResizeEvent(),t(this._element).on(h.CLICK_DISMISS,g.DATA_DISMISS,function(t){return n.hide(t)}),t(this._dialog).on(h.MOUSEDOWN_DISMISS,function(){t(n._element).one(h.MOUSEUP_DISMISS,function(e){t(e.target).is(n._element)&&(n._ignoreBackdropClick=!0)})}),this._showBackdrop(function(){return n._showElement(e)}))}},p.hide=function(e){var n=this;if(e&&e.preventDefault(),!this._isTransitioning&&this._isShown){var i=t.Event(h.HIDE);if(t(this._element).trigger(i),this._isShown&&!i.isDefaultPrevented()){this._isShown=!1;var s=P.supportsTransitionEnd()&&t(this._element).hasClass(d);s&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),t(document).off(h.FOCUSIN),t(this._element).removeClass(_),t(this._element).off(h.CLICK_DISMISS),t(this._dialog).off(h.MOUSEDOWN_DISMISS),s?t(this._element).one(P.TRANSITION_END,function(t){return n._hideModal(t)}).emulateTransitionEnd(300):this._hideModal()}}},p.dispose=function(){t.removeData(this._element,n),t(window,document,this._element,this._backdrop).off(i),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._scrollbarWidth=null},p.handleUpdate=function(){this._adjustDialog()},p._getConfig=function(t){return t=r({},a,t),P.typeCheckConfig(e,t,l),t},p._showElement=function(e){var n=this,i=P.supportsTransitionEnd()&&t(this._element).hasClass(d);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.scrollTop=0,i&&P.reflow(this._element),t(this._element).addClass(_),this._config.focus&&this._enforceFocus();var s=t.Event(h.SHOWN,{relatedTarget:e}),r=function(){n._config.focus&&n._element.focus(),n._isTransitioning=!1,t(n._element).trigger(s)};i?t(this._dialog).one(P.TRANSITION_END,r).emulateTransitionEnd(300):r()},p._enforceFocus=function(){var e=this;t(document).off(h.FOCUSIN).on(h.FOCUSIN,function(n){document!==n.target&&e._element!==n.target&&0===t(e._element).has(n.target).length&&e._element.focus()})},p._setEscapeEvent=function(){var e=this;this._isShown&&this._config.keyboard?t(this._element).on(h.KEYDOWN_DISMISS,function(t){27===t.which&&(t.preventDefault(),e.hide())}):this._isShown||t(this._element).off(h.KEYDOWN_DISMISS)},p._setResizeEvent=function(){var e=this;this._isShown?t(window).on(h.RESIZE,function(t){return e.handleUpdate(t)}):t(window).off(h.RESIZE)},p._hideModal=function(){var e=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._isTransitioning=!1,this._showBackdrop(function(){t(document.body).removeClass(f),e._resetAdjustments(),e._resetScrollbar(),t(e._element).trigger(h.HIDDEN)})},p._removeBackdrop=function(){this._backdrop&&(t(this._backdrop).remove(),this._backdrop=null)},p._showBackdrop=function(e){var n=this,i=t(this._element).hasClass(d)?d:"";if(this._isShown&&this._config.backdrop){var s=P.supportsTransitionEnd()&&i;if(this._backdrop=document.createElement("div"),this._backdrop.className=u,i&&t(this._backdrop).addClass(i),t(this._backdrop).appendTo(document.body),t(this._element).on(h.CLICK_DISMISS,function(t){n._ignoreBackdropClick?n._ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"===n._config.backdrop?n._element.focus():n.hide())}),s&&P.reflow(this._backdrop),t(this._backdrop).addClass(_),!e)return;if(!s)return void e();t(this._backdrop).one(P.TRANSITION_END,e).emulateTransitionEnd(150)}else if(!this._isShown&&this._backdrop){t(this._backdrop).removeClass(_);var r=function(){n._removeBackdrop(),e&&e()};P.supportsTransitionEnd()&&t(this._element).hasClass(d)?t(this._backdrop).one(P.TRANSITION_END,r).emulateTransitionEnd(150):r()}else e&&e()},p._adjustDialog=function(){var t=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&t&&(this._element.style.paddingLeft=this._scrollbarWidth+"px"),this._isBodyOverflowing&&!t&&(this._element.style.paddingRight=this._scrollbarWidth+"px")},p._resetAdjustments=function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""},p._checkScrollbar=function(){var t=document.body.getBoundingClientRect();this._isBodyOverflowing=t.left+t.right<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()},p._setScrollbar=function(){var e=this;if(this._isBodyOverflowing){t(g.FIXED_CONTENT).each(function(n,i){var s=t(i)[0].style.paddingRight,r=t(i).css("padding-right");t(i).data("padding-right",s).css("padding-right",parseFloat(r)+e._scrollbarWidth+"px")}),t(g.STICKY_CONTENT).each(function(n,i){var s=t(i)[0].style.marginRight,r=t(i).css("margin-right");t(i).data("margin-right",s).css("margin-right",parseFloat(r)-e._scrollbarWidth+"px")}),t(g.NAVBAR_TOGGLER).each(function(n,i){var s=t(i)[0].style.marginRight,r=t(i).css("margin-right");t(i).data("margin-right",s).css("margin-right",parseFloat(r)+e._scrollbarWidth+"px")});var n=document.body.style.paddingRight,i=t("body").css("padding-right");t("body").data("padding-right",n).css("padding-right",parseFloat(i)+this._scrollbarWidth+"px")}},p._resetScrollbar=function(){t(g.FIXED_CONTENT).each(function(e,n){var i=t(n).data("padding-right");"undefined"!=typeof i&&t(n).css("padding-right",i).removeData("padding-right")}),t(g.STICKY_CONTENT+", "+g.NAVBAR_TOGGLER).each(function(e,n){var i=t(n).data("margin-right");"undefined"!=typeof i&&t(n).css("margin-right",i).removeData("margin-right")});var e=t("body").data("padding-right");"undefined"!=typeof e&&t("body").css("padding-right",e).removeData("padding-right")},p._getScrollbarWidth=function(){var t=document.createElement("div");t.className=c,document.body.appendChild(t);var e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e},o._jQueryInterface=function(e,i){return this.each(function(){var s=t(this).data(n),a=r({},o.Default,t(this).data(),"object"==typeof e&&e);if(s||(s=new o(this,a),t(this).data(n,s)),"string"==typeof e){if("undefined"==typeof s[e])throw new TypeError('No method named "'+e+'"');s[e](i)}else a.show&&s.show(i)})},s(o,null,[{key:"VERSION",get:function(){return"4.0.0"}},{key:"Default",get:function(){return a}}]),o}();return t(document).on(h.CLICK_DATA_API,g.DATA_TOGGLE,function(e){var i,s=this,o=P.getSelectorFromElement(this);o&&(i=t(o)[0]);var a=t(i).data(n)?"toggle":r({},t(i).data(),t(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||e.preventDefault();var l=t(i).one(h.SHOW,function(e){e.isDefaultPrevented()||l.one(h.HIDDEN,function(){t(s).is(":visible")&&s.focus()})});p._jQueryInterface.call(t(i),a,this)}),t.fn.modal=p._jQueryInterface,t.fn.modal.Constructor=p,t.fn.modal.noConflict=function(){return t.fn.modal=o,p._jQueryInterface},p}(e),U=function(t){var e="tooltip",i="bs.tooltip",o="."+i,a=t.fn[e],l=new RegExp("(^|\\s)bs-tooltip\\S+","g"),h={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)"},c={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},u={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent"},f="show",d="out",_={HIDE:"hide"+o,HIDDEN:"hidden"+o,SHOW:"show"+o,SHOWN:"shown"+o,INSERTED:"inserted"+o,CLICK:"click"+o,FOCUSIN:"focusin"+o,FOCUSOUT:"focusout"+o,MOUSEENTER:"mouseenter"+o,MOUSELEAVE:"mouseleave"+o},g="fade",p="show",m=".tooltip-inner",v=".arrow",E="hover",T="focus",y="click",C="manual",I=function(){function a(t,e){if("undefined"==typeof n)throw new TypeError("Bootstrap tooltips require Popper.js (https://popper.js.org)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=t,this.config=this._getConfig(e),this.tip=null,this._setListeners()}var I=a.prototype;return I.enable=function(){this._isEnabled=!0},I.disable=function(){this._isEnabled=!1},I.toggleEnabled=function(){this._isEnabled=!this._isEnabled},I.toggle=function(e){if(this._isEnabled)if(e){var n=this.constructor.DATA_KEY,i=t(e.currentTarget).data(n);i||(i=new this.constructor(e.currentTarget,this._getDelegateConfig()),t(e.currentTarget).data(n,i)),i._activeTrigger.click=!i._activeTrigger.click,i._isWithActiveTrigger()?i._enter(null,i):i._leave(null,i)}else{if(t(this.getTipElement()).hasClass(p))return void this._leave(null,this);this._enter(null,this)}},I.dispose=function(){clearTimeout(this._timeout),t.removeData(this.element,this.constructor.DATA_KEY),t(this.element).off(this.constructor.EVENT_KEY),t(this.element).closest(".modal").off("hide.bs.modal"),this.tip&&t(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,this._activeTrigger=null,null!==this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null},I.show=function(){var e=this;if("none"===t(this.element).css("display"))throw new Error("Please use show on visible elements");var i=t.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){t(this.element).trigger(i);var s=t.contains(this.element.ownerDocument.documentElement,this.element);if(i.isDefaultPrevented()||!s)return;var r=this.getTipElement(),o=P.getUID(this.constructor.NAME);r.setAttribute("id",o),this.element.setAttribute("aria-describedby",o),this.setContent(),this.config.animation&&t(r).addClass(g);var l="function"==typeof this.config.placement?this.config.placement.call(this,r,this.element):this.config.placement,h=this._getAttachment(l);this.addAttachmentClass(h);var c=!1===this.config.container?document.body:t(this.config.container);t(r).data(this.constructor.DATA_KEY,this),t.contains(this.element.ownerDocument.documentElement,this.tip)||t(r).appendTo(c),t(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new n(this.element,r,{placement:h,modifiers:{offset:{offset:this.config.offset},flip:{behavior:this.config.fallbackPlacement},arrow:{element:v},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(t){t.originalPlacement!==t.placement&&e._handlePopperPlacementChange(t)},onUpdate:function(t){e._handlePopperPlacementChange(t)}}),t(r).addClass(p),"ontouchstart"in document.documentElement&&t("body").children().on("mouseover",null,t.noop);var u=function(){e.config.animation&&e._fixTransition();var n=e._hoverState;e._hoverState=null,t(e.element).trigger(e.constructor.Event.SHOWN),n===d&&e._leave(null,e)};P.supportsTransitionEnd()&&t(this.tip).hasClass(g)?t(this.tip).one(P.TRANSITION_END,u).emulateTransitionEnd(a._TRANSITION_DURATION):u()}},I.hide=function(e){var n=this,i=this.getTipElement(),s=t.Event(this.constructor.Event.HIDE),r=function(){n._hoverState!==f&&i.parentNode&&i.parentNode.removeChild(i),n._cleanTipClass(),n.element.removeAttribute("aria-describedby"),t(n.element).trigger(n.constructor.Event.HIDDEN),null!==n._popper&&n._popper.destroy(),e&&e()};t(this.element).trigger(s),s.isDefaultPrevented()||(t(i).removeClass(p),"ontouchstart"in document.documentElement&&t("body").children().off("mouseover",null,t.noop),this._activeTrigger[y]=!1,this._activeTrigger[T]=!1,this._activeTrigger[E]=!1,P.supportsTransitionEnd()&&t(this.tip).hasClass(g)?t(i).one(P.TRANSITION_END,r).emulateTransitionEnd(150):r(),this._hoverState="")},I.update=function(){null!==this._popper&&this._popper.scheduleUpdate()},I.isWithContent=function(){return Boolean(this.getTitle())},I.addAttachmentClass=function(e){t(this.getTipElement()).addClass("bs-tooltip-"+e)},I.getTipElement=function(){return this.tip=this.tip||t(this.config.template)[0],this.tip},I.setContent=function(){var e=t(this.getTipElement());this.setElementContent(e.find(m),this.getTitle()),e.removeClass(g+" "+p)},I.setElementContent=function(e,n){var i=this.config.html;"object"==typeof n&&(n.nodeType||n.jquery)?i?t(n).parent().is(e)||e.empty().append(n):e.text(t(n).text()):e[i?"html":"text"](n)},I.getTitle=function(){var t=this.element.getAttribute("data-original-title");return t||(t="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),t},I._getAttachment=function(t){return c[t.toUpperCase()]},I._setListeners=function(){var e=this;this.config.trigger.split(" ").forEach(function(n){if("click"===n)t(e.element).on(e.constructor.Event.CLICK,e.config.selector,function(t){return e.toggle(t)});else if(n!==C){var i=n===E?e.constructor.Event.MOUSEENTER:e.constructor.Event.FOCUSIN,s=n===E?e.constructor.Event.MOUSELEAVE:e.constructor.Event.FOCUSOUT;t(e.element).on(i,e.config.selector,function(t){return e._enter(t)}).on(s,e.config.selector,function(t){return e._leave(t)})}t(e.element).closest(".modal").on("hide.bs.modal",function(){return e.hide()})}),this.config.selector?this.config=r({},this.config,{trigger:"manual",selector:""}):this._fixTitle()},I._fixTitle=function(){var t=typeof this.element.getAttribute("data-original-title");(this.element.getAttribute("title")||"string"!==t)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))},I._enter=function(e,n){var i=this.constructor.DATA_KEY;(n=n||t(e.currentTarget).data(i))||(n=new this.constructor(e.currentTarget,this._getDelegateConfig()),t(e.currentTarget).data(i,n)),e&&(n._activeTrigger["focusin"===e.type?T:E]=!0),t(n.getTipElement()).hasClass(p)||n._hoverState===f?n._hoverState=f:(clearTimeout(n._timeout),n._hoverState=f,n.config.delay&&n.config.delay.show?n._timeout=setTimeout(function(){n._hoverState===f&&n.show()},n.config.delay.show):n.show())},I._leave=function(e,n){var i=this.constructor.DATA_KEY;(n=n||t(e.currentTarget).data(i))||(n=new this.constructor(e.currentTarget,this._getDelegateConfig()),t(e.currentTarget).data(i,n)),e&&(n._activeTrigger["focusout"===e.type?T:E]=!1),n._isWithActiveTrigger()||(clearTimeout(n._timeout),n._hoverState=d,n.config.delay&&n.config.delay.hide?n._timeout=setTimeout(function(){n._hoverState===d&&n.hide()},n.config.delay.hide):n.hide())},I._isWithActiveTrigger=function(){for(var t in this._activeTrigger)if(this._activeTrigger[t])return!0;return!1},I._getConfig=function(n){return"number"==typeof(n=r({},this.constructor.Default,t(this.element).data(),n)).delay&&(n.delay={show:n.delay,hide:n.delay}),"number"==typeof n.title&&(n.title=n.title.toString()),"number"==typeof n.content&&(n.content=n.content.toString()),P.typeCheckConfig(e,n,this.constructor.DefaultType),n},I._getDelegateConfig=function(){var t={};if(this.config)for(var e in this.config)this.constructor.Default[e]!==this.config[e]&&(t[e]=this.config[e]);return t},I._cleanTipClass=function(){var e=t(this.getTipElement()),n=e.attr("class").match(l);null!==n&&n.length>0&&e.removeClass(n.join(""))},I._handlePopperPlacementChange=function(t){this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(t.placement))},I._fixTransition=function(){var e=this.getTipElement(),n=this.config.animation;null===e.getAttribute("x-placement")&&(t(e).removeClass(g),this.config.animation=!1,this.hide(),this.show(),this.config.animation=n)},a._jQueryInterface=function(e){return this.each(function(){var n=t(this).data(i),s="object"==typeof e&&e;if((n||!/dispose|hide/.test(e))&&(n||(n=new a(this,s),t(this).data(i,n)),"string"==typeof e)){if("undefined"==typeof n[e])throw new TypeError('No method named "'+e+'"');n[e]()}})},s(a,null,[{key:"VERSION",get:function(){return"4.0.0"}},{key:"Default",get:function(){return u}},{key:"NAME",get:function(){return e}},{key:"DATA_KEY",get:function(){return i}},{key:"Event",get:function(){return _}},{key:"EVENT_KEY",get:function(){return o}},{key:"DefaultType",get:function(){return h}}]),a}();return t.fn[e]=I._jQueryInterface,t.fn[e].Constructor=I,t.fn[e].noConflict=function(){return t.fn[e]=a,I._jQueryInterface},I}(e),x=function(t){var e="popover",n="bs.popover",i="."+n,o=t.fn[e],a=new RegExp("(^|\\s)bs-popover\\S+","g"),l=r({},U.Default,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),h=r({},U.DefaultType,{content:"(string|element|function)"}),c="fade",u="show",f=".popover-header",d=".popover-body",_={HIDE:"hide"+i,HIDDEN:"hidden"+i,SHOW:"show"+i,SHOWN:"shown"+i,INSERTED:"inserted"+i,CLICK:"click"+i,FOCUSIN:"focusin"+i,FOCUSOUT:"focusout"+i,MOUSEENTER:"mouseenter"+i,MOUSELEAVE:"mouseleave"+i},g=function(r){var o,g;function p(){return r.apply(this,arguments)||this}g=r,(o=p).prototype=Object.create(g.prototype),o.prototype.constructor=o,o.__proto__=g;var m=p.prototype;return m.isWithContent=function(){return this.getTitle()||this._getContent()},m.addAttachmentClass=function(e){t(this.getTipElement()).addClass("bs-popover-"+e)},m.getTipElement=function(){return this.tip=this.tip||t(this.config.template)[0],this.tip},m.setContent=function(){var e=t(this.getTipElement());this.setElementContent(e.find(f),this.getTitle());var n=this._getContent();"function"==typeof n&&(n=n.call(this.element)),this.setElementContent(e.find(d),n),e.removeClass(c+" "+u)},m._getContent=function(){return this.element.getAttribute("data-content")||this.config.content},m._cleanTipClass=function(){var e=t(this.getTipElement()),n=e.attr("class").match(a);null!==n&&n.length>0&&e.removeClass(n.join(""))},p._jQueryInterface=function(e){return this.each(function(){var i=t(this).data(n),s="object"==typeof e?e:null;if((i||!/destroy|hide/.test(e))&&(i||(i=new p(this,s),t(this).data(n,i)),"string"==typeof e)){if("undefined"==typeof i[e])throw new TypeError('No method named "'+e+'"');i[e]()}})},s(p,null,[{key:"VERSION",get:function(){return"4.0.0"}},{key:"Default",get:function(){return l}},{key:"NAME",get:function(){return e}},{key:"DATA_KEY",get:function(){return n}},{key:"Event",get:function(){return _}},{key:"EVENT_KEY",get:function(){return i}},{key:"DefaultType",get:function(){return h}}]),p}(U);return t.fn[e]=g._jQueryInterface,t.fn[e].Constructor=g,t.fn[e].noConflict=function(){return t.fn[e]=o,g._jQueryInterface},g}(e),K=function(t){var e="scrollspy",n="bs.scrollspy",i="."+n,o=t.fn[e],a={offset:10,method:"auto",target:""},l={offset:"number",method:"string",target:"(string|element)"},h={ACTIVATE:"activate"+i,SCROLL:"scroll"+i,LOAD_DATA_API:"load"+i+".data-api"},c="dropdown-item",u="active",f={DATA_SPY:'[data-spy="scroll"]',ACTIVE:".active",NAV_LIST_GROUP:".nav, .list-group",NAV_LINKS:".nav-link",NAV_ITEMS:".nav-item",LIST_ITEMS:".list-group-item",DROPDOWN:".dropdown",DROPDOWN_ITEMS:".dropdown-item",DROPDOWN_TOGGLE:".dropdown-toggle"},d="offset",_="position",g=function(){function o(e,n){var i=this;this._element=e,this._scrollElement="BODY"===e.tagName?window:e,this._config=this._getConfig(n),this._selector=this._config.target+" "+f.NAV_LINKS+","+this._config.target+" "+f.LIST_ITEMS+","+this._config.target+" "+f.DROPDOWN_ITEMS,this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,t(this._scrollElement).on(h.SCROLL,function(t){return i._process(t)}),this.refresh(),this._process()}var g=o.prototype;return g.refresh=function(){var e=this,n=this._scrollElement===this._scrollElement.window?d:_,i="auto"===this._config.method?n:this._config.method,s=i===_?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),t.makeArray(t(this._selector)).map(function(e){var n,r=P.getSelectorFromElement(e);if(r&&(n=t(r)[0]),n){var o=n.getBoundingClientRect();if(o.width||o.height)return[t(n)[i]().top+s,r]}return null}).filter(function(t){return t}).sort(function(t,e){return t[0]-e[0]}).forEach(function(t){e._offsets.push(t[0]),e._targets.push(t[1])})},g.dispose=function(){t.removeData(this._element,n),t(this._scrollElement).off(i),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null},g._getConfig=function(n){if("string"!=typeof(n=r({},a,n)).target){var i=t(n.target).attr("id");i||(i=P.getUID(e),t(n.target).attr("id",i)),n.target="#"+i}return P.typeCheckConfig(e,n,l),n},g._getScrollTop=function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop},g._getScrollHeight=function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},g._getOffsetHeight=function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height},g._process=function(){var t=this._getScrollTop()+this._config.offset,e=this._getScrollHeight(),n=this._config.offset+e-this._getOffsetHeight();if(this._scrollHeight!==e&&this.refresh(),t>=n){var i=this._targets[this._targets.length-1];this._activeTarget!==i&&this._activate(i)}else{if(this._activeTarget&&t<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(var s=this._offsets.length;s--;){this._activeTarget!==this._targets[s]&&t>=this._offsets[s]&&("undefined"==typeof this._offsets[s+1]||t<this._offsets[s+1])&&this._activate(this._targets[s])}}},g._activate=function(e){this._activeTarget=e,this._clear();var n=this._selector.split(",");n=n.map(function(t){return t+'[data-target="'+e+'"],'+t+'[href="'+e+'"]'});var i=t(n.join(","));i.hasClass(c)?(i.closest(f.DROPDOWN).find(f.DROPDOWN_TOGGLE).addClass(u),i.addClass(u)):(i.addClass(u),i.parents(f.NAV_LIST_GROUP).prev(f.NAV_LINKS+", "+f.LIST_ITEMS).addClass(u),i.parents(f.NAV_LIST_GROUP).prev(f.NAV_ITEMS).children(f.NAV_LINKS).addClass(u)),t(this._scrollElement).trigger(h.ACTIVATE,{relatedTarget:e})},g._clear=function(){t(this._selector).filter(f.ACTIVE).removeClass(u)},o._jQueryInterface=function(e){return this.each(function(){var i=t(this).data(n);if(i||(i=new o(this,"object"==typeof e&&e),t(this).data(n,i)),"string"==typeof e){if("undefined"==typeof i[e])throw new TypeError('No method named "'+e+'"');i[e]()}})},s(o,null,[{key:"VERSION",get:function(){return"4.0.0"}},{key:"Default",get:function(){return a}}]),o}();return t(window).on(h.LOAD_DATA_API,function(){for(var e=t.makeArray(t(f.DATA_SPY)),n=e.length;n--;){var i=t(e[n]);g._jQueryInterface.call(i,i.data())}}),t.fn[e]=g._jQueryInterface,t.fn[e].Constructor=g,t.fn[e].noConflict=function(){return t.fn[e]=o,g._jQueryInterface},g}(e),V=function(t){var e="bs.tab",n="."+e,i=t.fn.tab,r={HIDE:"hide"+n,HIDDEN:"hidden"+n,SHOW:"show"+n,SHOWN:"shown"+n,CLICK_DATA_API:"click.bs.tab.data-api"},o="dropdown-menu",a="active",l="disabled",h="fade",c="show",u=".dropdown",f=".nav, .list-group",d=".active",_="> li > .active",g='[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',p=".dropdown-toggle",m="> .dropdown-menu .active",v=function(){function n(t){this._element=t}var i=n.prototype;return i.show=function(){var e=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&t(this._element).hasClass(a)||t(this._element).hasClass(l))){var n,i,s=t(this._element).closest(f)[0],o=P.getSelectorFromElement(this._element);if(s){var h="UL"===s.nodeName?_:d;i=(i=t.makeArray(t(s).find(h)))[i.length-1]}var c=t.Event(r.HIDE,{relatedTarget:this._element}),u=t.Event(r.SHOW,{relatedTarget:i});if(i&&t(i).trigger(c),t(this._element).trigger(u),!u.isDefaultPrevented()&&!c.isDefaultPrevented()){o&&(n=t(o)[0]),this._activate(this._element,s);var g=function(){var n=t.Event(r.HIDDEN,{relatedTarget:e._element}),s=t.Event(r.SHOWN,{relatedTarget:i});t(i).trigger(n),t(e._element).trigger(s)};n?this._activate(n,n.parentNode,g):g()}}},i.dispose=function(){t.removeData(this._element,e),this._element=null},i._activate=function(e,n,i){var s=this,r=("UL"===n.nodeName?t(n).find(_):t(n).children(d))[0],o=i&&P.supportsTransitionEnd()&&r&&t(r).hasClass(h),a=function(){return s._transitionComplete(e,r,i)};r&&o?t(r).one(P.TRANSITION_END,a).emulateTransitionEnd(150):a()},i._transitionComplete=function(e,n,i){if(n){t(n).removeClass(c+" "+a);var s=t(n.parentNode).find(m)[0];s&&t(s).removeClass(a),"tab"===n.getAttribute("role")&&n.setAttribute("aria-selected",!1)}if(t(e).addClass(a),"tab"===e.getAttribute("role")&&e.setAttribute("aria-selected",!0),P.reflow(e),t(e).addClass(c),e.parentNode&&t(e.parentNode).hasClass(o)){var r=t(e).closest(u)[0];r&&t(r).find(p).addClass(a),e.setAttribute("aria-expanded",!0)}i&&i()},n._jQueryInterface=function(i){return this.each(function(){var s=t(this),r=s.data(e);if(r||(r=new n(this),s.data(e,r)),"string"==typeof i){if("undefined"==typeof r[i])throw new TypeError('No method named "'+i+'"');r[i]()}})},s(n,null,[{key:"VERSION",get:function(){return"4.0.0"}}]),n}();return t(document).on(r.CLICK_DATA_API,g,function(e){e.preventDefault(),v._jQueryInterface.call(t(this),"show")}),t.fn.tab=v._jQueryInterface,t.fn.tab.Constructor=v,t.fn.tab.noConflict=function(){return t.fn.tab=i,v._jQueryInterface},v}(e);!function(t){if("undefined"==typeof t)throw new TypeError("Bootstrap's JavaScript requires jQuery. jQuery must be included before Bootstrap's JavaScript.");var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1===e[0]&&9===e[1]&&e[2]<1||e[0]>=4)throw new Error("Bootstrap's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}(e),t.Util=P,t.Alert=L,t.Button=R,t.Carousel=j,t.Collapse=H,t.Dropdown=W,t.Modal=M,t.Popover=x,t.Scrollspy=K,t.Tab=V,t.Tooltip=U,Object.defineProperty(t,"__esModule",{value:!0})});

/*!
 * jQuery Mousewheel v3.1.13
 * https://github.com/jquery/jquery-mousewheel
 *
 * Copyright (c) 2015 jQuery Foundation and other contributors
 * Licensed under MIT 
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});

/*!
 * Hammer.JS v2.0.7
 * https://github.com/hammerjs/hammer.js
 *
 * Copyright (c) 2016 Jorik Tangelder
 * Licensed under MIT
 */
!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&la(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==oa?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ma.length;){if(c=ma[g],e=c?c+f:b,e in a)return e;g++}return d}function v(){return ua++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b,c=a.options.inputClass;return new(b=c?c:xa?M:ya?P:wa?R:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ea&&d-e===0,g=b&(Ga|Ha)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=ra(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=qa(j.x)>qa(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ea&&f.eventType!==Ga||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ha&&(i>Da||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=qa(l.x)>qa(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:pa(a.pointers[c].clientX),clientY:pa(a.pointers[c].clientY)},c++;return{timeStamp:ra(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:pa(a[0].clientX),y:pa(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:pa(c/b),y:pa(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ia:qa(a)>=qa(b)?0>a?Ja:Ka:0>b?La:Ma}function H(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Ra)+I(a[1],a[0],Ra)}function K(a,b){return H(b[0],b[1],Ra)/H(a[0],a[1],Ra)}function L(){this.evEl=Ta,this.evWin=Ua,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Xa,this.evWin=Ya,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=$a,this.evWin=_a,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ga|Ha)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=bb,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Ea|Fa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Ea)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ga|Ha)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a),this.primaryTouch=null,this.lastTouches=[]}function S(a,b){a&Ea?(this.primaryTouch=b.changedPointers[0].identifier,T.call(this,b)):a&(Ga|Ha)&&T.call(this,b)}function T(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches,e=function(){var a=d.indexOf(c);a>-1&&d.splice(a,1)};setTimeout(e,cb)}}function U(a){for(var b=a.srcEvent.clientX,c=a.srcEvent.clientY,d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d],f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(db>=f&&db>=g)return!0}return!1}function V(a,b){this.manager=a,this.set(b)}function W(a){if(p(a,jb))return jb;var b=p(a,kb),c=p(a,lb);return b&&c?jb:b||c?b?kb:lb:p(a,ib)?ib:hb}function X(){if(!fb)return!1;var b={},c=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(d){b[d]=c?a.CSS.supports("touch-action",d):!0}),b}function Y(a){this.options=la({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=nb,this.simultaneous={},this.requireFail=[]}function Z(a){return a&sb?"cancel":a&qb?"end":a&pb?"move":a&ob?"start":""}function $(a){return a==Ma?"down":a==La?"up":a==Ja?"left":a==Ka?"right":""}function _(a,b){var c=b.manager;return c?c.get(a):a}function aa(){Y.apply(this,arguments)}function ba(){aa.apply(this,arguments),this.pX=null,this.pY=null}function ca(){aa.apply(this,arguments)}function da(){Y.apply(this,arguments),this._timer=null,this._input=null}function ea(){aa.apply(this,arguments)}function fa(){aa.apply(this,arguments)}function ga(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ha(a,b){return b=b||{},b.recognizers=l(b.recognizers,ha.defaults.preset),new ia(a,b)}function ia(a,b){this.options=la({},ha.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=y(this),this.touchAction=new V(this,this.options.touchAction),ja(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ja(a,b){var c=a.element;if(c.style){var d;g(a.options.cssProps,function(e,f){d=u(c.style,f),b?(a.oldCssProps[d]=c.style[d],c.style[d]=e):c.style[d]=a.oldCssProps[d]||""}),b||(a.oldCssProps={})}}function ka(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var la,ma=["","webkit","Moz","MS","ms","o"],na=b.createElement("div"),oa="function",pa=Math.round,qa=Math.abs,ra=Date.now;la="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var sa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),ta=h(function(a,b){return sa(a,b,!0)},"merge","Use `assign`."),ua=1,va=/mobile|tablet|ip(ad|hone|od)|android/i,wa="ontouchstart"in a,xa=u(a,"PointerEvent")!==d,ya=wa&&va.test(navigator.userAgent),za="touch",Aa="pen",Ba="mouse",Ca="kinect",Da=25,Ea=1,Fa=2,Ga=4,Ha=8,Ia=1,Ja=2,Ka=4,La=8,Ma=16,Na=Ja|Ka,Oa=La|Ma,Pa=Na|Oa,Qa=["x","y"],Ra=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Sa={mousedown:Ea,mousemove:Fa,mouseup:Ga},Ta="mousedown",Ua="mousemove mouseup";i(L,x,{handler:function(a){var b=Sa[a.type];b&Ea&&0===a.button&&(this.pressed=!0),b&Fa&&1!==a.which&&(b=Ga),this.pressed&&(b&Ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:Ba,srcEvent:a}))}});var Va={pointerdown:Ea,pointermove:Fa,pointerup:Ga,pointercancel:Ha,pointerout:Ha},Wa={2:za,3:Aa,4:Ba,5:Ca},Xa="pointerdown",Ya="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Xa="MSPointerDown",Ya="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Va[d],f=Wa[a.pointerType]||a.pointerType,g=f==za,h=r(b,a.pointerId,"pointerId");e&Ea&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ga|Ha)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Za={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},$a="touchstart",_a="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Za[a.type];if(b===Ea&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ga|Ha)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}}});var ab={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},bb="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=ab[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}});var cb=2500,db=25;i(R,x,{handler:function(a,b,c){var d=c.pointerType==za,e=c.pointerType==Ba;if(!(e&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(d)S.call(this,b,c);else if(e&&U.call(this,c))return;this.callback(a,b,c)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var eb=u(na.style,"touchAction"),fb=eb!==d,gb="compute",hb="auto",ib="manipulation",jb="none",kb="pan-x",lb="pan-y",mb=X();V.prototype={set:function(a){a==gb&&(a=this.compute()),fb&&this.manager.element.style&&mb[a]&&(this.manager.element.style[eb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),W(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,jb)&&!mb[jb],f=p(d,lb)&&!mb[lb],g=p(d,kb)&&!mb[kb];if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}return g&&f?void 0:e||f&&c&Na||g&&c&Oa?this.preventSrc(b):void 0},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var nb=1,ob=2,pb=4,qb=8,rb=qb,sb=16,tb=32;Y.prototype={defaults:{},set:function(a){return la(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=_(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=_(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=_(a,this),-1===r(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=_(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;qb>d&&b(c.options.event+Z(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=qb&&b(c.options.event+Z(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=tb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(tb|nb)))return!1;a++}return!0},recognize:function(a){var b=la({},a);return k(this.options.enable,[this,b])?(this.state&(rb|sb|tb)&&(this.state=nb),this.state=this.process(b),void(this.state&(ob|pb|qb|sb)&&this.tryEmit(b))):(this.reset(),void(this.state=tb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(aa,Y,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(ob|pb),e=this.attrTest(a);return d&&(c&Ha||!e)?b|sb:d||e?c&Ga?b|qb:b&ob?b|pb:ob:tb}}),i(ba,aa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pa},getTouchAction:function(){var a=this.options.direction,b=[];return a&Na&&b.push(lb),a&Oa&&b.push(kb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Na?(e=0===f?Ia:0>f?Ja:Ka,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ia:0>g?La:Ma,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return aa.prototype.attrTest.call(this,a)&&(this.state&ob||!(this.state&ob)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=$(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i(ca,aa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&ob)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(da,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ga|Ha)&&!f)this.reset();else if(a.eventType&Ea)this.reset(),this._timer=e(function(){this.state=rb,this.tryEmit()},b.time,this);else if(a.eventType&Ga)return rb;return tb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===rb&&(a&&a.eventType&Ga?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=ra(),this.manager.emit(this.options.event,this._input)))}}),i(ea,aa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&ob)}}),i(fa,aa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Na|Oa,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Na|Oa)?b=a.overallVelocity:c&Na?b=a.overallVelocityX:c&Oa&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&qa(b)>this.options.velocity&&a.eventType&Ga},emit:function(a){var b=$(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ga,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ib]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Ea&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ga)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=rb,this.tryEmit()},b.interval,this),ob):rb}return tb},failTimeout:function(){return this._timer=e(function(){this.state=tb},this.options.interval,this),tb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ha.VERSION="2.0.7",ha.defaults={domEvents:!1,touchAction:gb,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[ca,{enable:!1},["rotate"]],[fa,{direction:Na}],[ba,{direction:Na},["swipe"]],[ga],[ga,{event:"doubletap",taps:2},["tap"]],[da]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ub=1,vb=2;ia.prototype={set:function(a){return la(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?vb:ub},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&rb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===vb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(ob|pb|qb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof Y)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){if(a!==d&&b!==d){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this}},off:function(a,b){if(a!==d){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&ka(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},la(ha,{INPUT_START:Ea,INPUT_MOVE:Fa,INPUT_END:Ga,INPUT_CANCEL:Ha,STATE_POSSIBLE:nb,STATE_BEGAN:ob,STATE_CHANGED:pb,STATE_ENDED:qb,STATE_RECOGNIZED:rb,STATE_CANCELLED:sb,STATE_FAILED:tb,DIRECTION_NONE:Ia,DIRECTION_LEFT:Ja,DIRECTION_RIGHT:Ka,DIRECTION_UP:La,DIRECTION_DOWN:Ma,DIRECTION_HORIZONTAL:Na,DIRECTION_VERTICAL:Oa,DIRECTION_ALL:Pa,Manager:ia,Input:x,TouchAction:V,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:Y,AttrRecognizer:aa,Tap:ga,Pan:ba,Swipe:fa,Pinch:ca,Rotate:ea,Press:da,on:m,off:n,each:g,merge:ta,extend:sa,assign:la,inherit:i,bindFn:j,prefixed:u});var wb="undefined"!=typeof a?a:"undefined"!=typeof self?self:{};wb.Hammer=ha,"function"==typeof define&&define.amd?define(function(){return ha}):"undefined"!=typeof module&&module.exports?module.exports=ha:a[c]=ha}(window,document,"Hammer");
(function(factory) {if (typeof define === 'function' && define.amd) {define(['jquery', 'hammerjs'], factory);} else if (typeof exports === 'object') {factory(require('jquery'), require('hammerjs'));} else {factory(jQuery, Hammer);}}(function($, Hammer) {function hammerify(el, options) {var $el = $(el);if(!$el.data("hammer")) {$el.data("hammer", new Hammer($el[0], options));}}$.fn.hammer = function(options) {return this.each(function() {hammerify(this, options);});};Hammer.Manager.prototype.emit = (function(originalEmit) {return function(type, data) {originalEmit.call(this, type, data);$(this.element).trigger({type: type,gesture: data});};})(Hammer.Manager.prototype.emit);}));

/*!
 * Howler.JS v2.1.2
 * https://github.com/goldfire/howler.js
 *
 * Copyright (c) 2013-2019 James Simpson of GoldFire Studios
 * Licensed under MIT
 */
!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||n;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var o=this||n;if(e=parseFloat(e),o.ctx||_(),void 0!==e&&e>=0&&e<=1){if(o._volume=e,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e,n.ctx.currentTime);for(var t=0;t<o._howls.length;t++)if(!o._howls[t]._webAudio)for(var r=o._howls[t]._getSoundIds(),a=0;a<r.length;a++){var u=o._howls[t]._soundById(r[a]);u&&u._node&&(u._node.volume=u._volume*e)}return o}return o._volume},mute:function(e){var o=this||n;o.ctx||_(),o._muted=e,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e?0:o._volume,n.ctx.currentTime);for(var t=0;t<o._howls.length;t++)if(!o._howls[t]._webAudio)for(var r=o._howls[t]._getSoundIds(),a=0;a<r.length;a++){var u=o._howls[t]._soundById(r[a]);u&&u._node&&(u._node.muted=!!e||u._muted)}return o},unload:function(){for(var e=this||n,o=e._howls.length-1;o>=0;o--)e._howls[o].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,_()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||n;if(e.state=e.ctx?e.ctx.state||"suspended":"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{var o=new Audio;void 0===o.oncanplaythrough&&(e._canPlayEvent="canplay")}catch(n){e.noAudio=!0}else e.noAudio=!0;try{var o=new Audio;o.muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,o=null;try{o="undefined"!=typeof Audio?new Audio:null}catch(n){return e}if(!o||"function"!=typeof o.canPlayType)return e;var t=o.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),a=r&&parseInt(r[0].split("/")[1],10)<33;return e._codecs={mp3:!(a||!t&&!o.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!t,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!o.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||n;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function(n){for(var t=0;t<e.html5PoolSize;t++)try{var r=new Audio;r._unlocked=!0,e._releaseHtml5Audio(r)}catch(n){e.noAudio=!0}for(var t=0;t<e._howls.length;t++)if(!e._howls[t]._webAudio)for(var a=e._howls[t]._getSoundIds(),u=0;u<a.length;u++){var i=e._howls[t]._soundById(a[u]);i&&i._node&&!i._node._unlocked&&(i._node._unlocked=!0,i._node.load())}e._autoResume();var d=e.ctx.createBufferSource();d.buffer=e._scratchBuffer,d.connect(e.ctx.destination),void 0===d.start?d.noteOn(0):d.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),d.onended=function(){d.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),e}},_obtainHtml5Audio:function(){var e=this||n;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var o=(new Audio).play();return o&&"undefined"!=typeof Promise&&(o instanceof Promise||"function"==typeof o.then)&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var o=this||n;return e._unlocked&&o._html5AudioPool.push(e),o},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(var o=0;o<e._howls.length;o++)if(e._howls[o]._webAudio)for(var t=0;t<e._howls[o]._sounds.length;t++)if(!e._howls[o]._sounds[t]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(function(){e.state="running";for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e,o=function(e){var n=this;if(!e.src||0===e.src.length)return void console.error("An array of source files must be passed with any new Howl.");n.init(e)};o.prototype={init:function(e){var o=this;return n.ctx||_(),o._autoplay=e.autoplay||!1,o._format="string"!=typeof e.format?e.format:[e.format],o._html5=e.html5||!1,o._muted=e.mute||!1,o._loop=e.loop||!1,o._pool=e.pool||5,o._preload="boolean"!=typeof e.preload||e.preload,o._rate=e.rate||1,o._sprite=e.sprite||{},o._src="string"!=typeof e.src?e.src:[e.src],o._volume=void 0!==e.volume?e.volume:1,o._xhrWithCredentials=e.xhrWithCredentials||!1,o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=e.onend?[{fn:e.onend}]:[],o._onfade=e.onfade?[{fn:e.onfade}]:[],o._onload=e.onload?[{fn:e.onload}]:[],o._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],o._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],o._onpause=e.onpause?[{fn:e.onpause}]:[],o._onplay=e.onplay?[{fn:e.onplay}]:[],o._onstop=e.onstop?[{fn:e.onstop}]:[],o._onmute=e.onmute?[{fn:e.onmute}]:[],o._onvolume=e.onvolume?[{fn:e.onvolume}]:[],o._onrate=e.onrate?[{fn:e.onrate}]:[],o._onseek=e.onseek?[{fn:e.onseek}]:[],o._onunlock=e.onunlock?[{fn:e.onunlock}]:[],o._onresume=[],o._webAudio=n.usingWebAudio&&!o._html5,void 0!==n.ctx&&n.ctx&&n.autoUnlock&&n._unlockAudio(),n._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&o.load(),o},load:function(){var e=this,o=null;if(n.noAudio)return void e._emit("loaderror",null,"No audio support.");"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var u,i;if(e._format&&e._format[r])u=e._format[r];else{if("string"!=typeof(i=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}u=/^data:audio\/([^;,]+);/i.exec(i),u||(u=/\.([^.]+)$/.exec(i.split("?",1)[0])),u&&(u=u[1].toLowerCase())}if(u||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),u&&n.codecs(u)){o=e._src[r];break}}return o?(e._src=o,e._state="loading","https:"===window.location.protocol&&"http:"===o.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new t(e),e._webAudio&&a(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(e,o){var t=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===t._state&&!t._sprite[e])return null;if(void 0===e&&(e="__default",!t._playLock)){for(var a=0,u=0;u<t._sounds.length;u++)t._sounds[u]._paused&&!t._sounds[u]._ended&&(a++,r=t._sounds[u]._id);1===a?e=null:r=null}}var i=r?t._soundById(r):t._inactiveSound();if(!i)return null;if(r&&!e&&(e=i._sprite||"__default"),"loaded"!==t._state){i._sprite=e,i._ended=!1;var d=i._id;return t._queue.push({event:"play",action:function(){t.play(d)}}),d}if(r&&!i._paused)return o||t._loadQueue("play"),i._id;t._webAudio&&n._autoResume();var _=Math.max(0,i._seek>0?i._seek:t._sprite[e][0]/1e3),s=Math.max(0,(t._sprite[e][0]+t._sprite[e][1])/1e3-_),l=1e3*s/Math.abs(i._rate),c=t._sprite[e][0]/1e3,f=(t._sprite[e][0]+t._sprite[e][1])/1e3,p=!(!i._loop&&!t._sprite[e][2]);i._sprite=e,i._ended=!1;var m=function(){i._paused=!1,i._seek=_,i._start=c,i._stop=f,i._loop=p};if(_>=f)return void t._ended(i);var v=i._node;if(t._webAudio){var h=function(){t._playLock=!1,m(),t._refreshBuffer(i);var e=i._muted||t._muted?0:i._volume;v.gain.setValueAtTime(e,n.ctx.currentTime),i._playStart=n.ctx.currentTime,void 0===v.bufferSource.start?i._loop?v.bufferSource.noteGrainOn(0,_,86400):v.bufferSource.noteGrainOn(0,_,s):i._loop?v.bufferSource.start(0,_,86400):v.bufferSource.start(0,_,s),l!==1/0&&(t._endTimers[i._id]=setTimeout(t._ended.bind(t,i),l)),o||setTimeout(function(){t._emit("play",i._id),t._loadQueue()},0)};"running"===n.state?h():(t._playLock=!0,t.once("resume",h),t._clearTimer(i._id))}else{var y=function(){v.currentTime=_,v.muted=i._muted||t._muted||n._muted||v.muted,v.volume=i._volume*n.volume(),v.playbackRate=i._rate;try{var r=v.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(t._playLock=!0,m(),r.then(function(){t._playLock=!1,v._unlocked=!0,o||(t._emit("play",i._id),t._loadQueue())}).catch(function(){t._playLock=!1,t._emit("playerror",i._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),i._ended=!0,i._paused=!0})):o||(t._playLock=!1,m(),t._emit("play",i._id),t._loadQueue()),v.playbackRate=i._rate,v.paused)return void t._emit("playerror",i._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||i._loop?t._endTimers[i._id]=setTimeout(t._ended.bind(t,i),l):(t._endTimers[i._id]=function(){t._ended(i),v.removeEventListener("ended",t._endTimers[i._id],!1)},v.addEventListener("ended",t._endTimers[i._id],!1))}catch(e){t._emit("playerror",i._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===v.src&&(v.src=t._src,v.load());var g=window&&window.ejecta||!v.readyState&&n._navigator.isCocoonJS;if(v.readyState>=3||g)y();else{t._playLock=!0;var A=function(){y(),v.removeEventListener(n._canPlayEvent,A,!1)};v.addEventListener(n._canPlayEvent,A,!1),t._clearTimer(i._id)}}return i._id},pause:function(e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"pause",action:function(){n.pause(e)}}),n;for(var o=n._getSoundIds(e),t=0;t<o.length;t++){n._clearTimer(o[t]);var r=n._soundById(o[t]);if(r&&!r._paused&&(r._seek=n.seek(o[t]),r._rateSeek=0,r._paused=!0,n._stopFade(o[t]),r._node))if(n._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||n._emit("pause",r?r._id:null)}return n},stop:function(e,n){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var t=o._getSoundIds(e),r=0;r<t.length;r++){o._clearTimer(t[r]);var a=o._soundById(t[r]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,o._stopFade(t[r]),a._node&&(o._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),o._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&o._clearSound(a._node))),n||o._emit("stop",a._id))}return o},mute:function(e,o){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"mute",action:function(){t.mute(e,o)}}),t;if(void 0===o){if("boolean"!=typeof e)return t._muted;t._muted=e}for(var r=t._getSoundIds(o),a=0;a<r.length;a++){var u=t._soundById(r[a]);u&&(u._muted=e,u._interval&&t._stopFade(u._id),t._webAudio&&u._node?u._node.gain.setValueAtTime(e?0:u._volume,n.ctx.currentTime):u._node&&(u._node.muted=!!n._muted||e),t._emit("mute",u._id))}return t},volume:function(){var e,o,t=this,r=arguments;if(0===r.length)return t._volume;if(1===r.length||2===r.length&&void 0===r[1]){t._getSoundIds().indexOf(r[0])>=0?o=parseInt(r[0],10):e=parseFloat(r[0])}else r.length>=2&&(e=parseFloat(r[0]),o=parseInt(r[1],10));var a;if(!(void 0!==e&&e>=0&&e<=1))return a=o?t._soundById(o):t._sounds[0],a?a._volume:0;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,r)}}),t;void 0===o&&(t._volume=e),o=t._getSoundIds(o);for(var u=0;u<o.length;u++)(a=t._soundById(o[u]))&&(a._volume=e,r[2]||t._stopFade(o[u]),t._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(e,n.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=e*n.volume()),t._emit("volume",a._id));return t},fade:function(e,o,t,r){var a=this;if("loaded"!==a._state||a._playLock)return a._queue.push({event:"fade",action:function(){a.fade(e,o,t,r)}}),a;e=parseFloat(e),o=parseFloat(o),t=parseFloat(t),a.volume(e,r);for(var u=a._getSoundIds(r),i=0;i<u.length;i++){var d=a._soundById(u[i]);if(d){if(r||a._stopFade(u[i]),a._webAudio&&!d._muted){var _=n.ctx.currentTime,s=_+t/1e3;d._volume=e,d._node.gain.setValueAtTime(e,_),d._node.gain.linearRampToValueAtTime(o,s)}a._startFadeInterval(d,e,o,t,u[i],void 0===r)}}return a},_startFadeInterval:function(e,n,o,t,r,a){var u=this,i=n,d=o-n,_=Math.abs(d/.01),s=Math.max(4,_>0?t/_:t),l=Date.now();e._fadeTo=o,e._interval=setInterval(function(){var r=(Date.now()-l)/t;l=Date.now(),i+=d*r,i=Math.max(0,i),i=Math.min(1,i),i=Math.round(100*i)/100,u._webAudio?e._volume=i:u.volume(i,e._id,!0),a&&(u._volume=i),(o<n&&i<=o||o>n&&i>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,u.volume(o,e._id),u._emit("fade",e._id))},s)},_stopFade:function(e){var o=this,t=o._soundById(e);return t&&t._interval&&(o._webAudio&&t._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(t._interval),t._interval=null,o.volume(t._fadeTo,e),t._fadeTo=null,o._emit("fade",e)),o},loop:function(){var e,n,o,t=this,r=arguments;if(0===r.length)return t._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(o=t._soundById(parseInt(r[0],10)))&&o._loop;e=r[0],t._loop=e}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var a=t._getSoundIds(n),u=0;u<a.length;u++)(o=t._soundById(a[u]))&&(o._loop=e,t._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop)));return t},rate:function(){var e,o,t=this,r=arguments;if(0===r.length)o=t._sounds[0]._id;else if(1===r.length){var a=t._getSoundIds(),u=a.indexOf(r[0]);u>=0?o=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));var i;if("number"!=typeof e)return i=t._soundById(o),i?i._rate:t._rate;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,r)}}),t;void 0===o&&(t._rate=e),o=t._getSoundIds(o);for(var d=0;d<o.length;d++)if(i=t._soundById(o[d])){t.playing(o[d])&&(i._rateSeek=t.seek(o[d]),i._playStart=t._webAudio?n.ctx.currentTime:i._playStart),i._rate=e,t._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(e,n.ctx.currentTime):i._node&&(i._node.playbackRate=e);var _=t.seek(o[d]),s=(t._sprite[i._sprite][0]+t._sprite[i._sprite][1])/1e3-_,l=1e3*s/Math.abs(i._rate);!t._endTimers[o[d]]&&i._paused||(t._clearTimer(o[d]),t._endTimers[o[d]]=setTimeout(t._ended.bind(t,i),l)),t._emit("rate",i._id)}return t},seek:function(){var e,o,t=this,r=arguments;if(0===r.length)o=t._sounds[0]._id;else if(1===r.length){var a=t._getSoundIds(),u=a.indexOf(r[0]);u>=0?o=parseInt(r[0],10):t._sounds.length&&(o=t._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));if(void 0===o)return t;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"seek",action:function(){t.seek.apply(t,r)}}),t;var i=t._soundById(o);if(i){if(!("number"==typeof e&&e>=0)){if(t._webAudio){var d=t.playing(o)?n.ctx.currentTime-i._playStart:0,_=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(_+d*Math.abs(i._rate))}return i._node.currentTime}var s=t.playing(o);s&&t.pause(o,!0),i._seek=e,i._ended=!1,t._clearTimer(o),t._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var l=function(){t._emit("seek",o),s&&t.play(o,!0)};if(s&&!t._webAudio){var c=function(){t._playLock?setTimeout(c,0):l()};setTimeout(c,0)}else l()}return t},playing:function(e){var n=this;if("number"==typeof e){var o=n._soundById(e);return!!o&&!o._paused}for(var t=0;t<n._sounds.length;t++)if(!n._sounds[t]._paused)return!0;return!1},duration:function(e){var n=this,o=n._duration,t=n._soundById(e);return t&&(o=n._sprite[t._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,o=e._sounds,t=0;t<o.length;t++)o[t]._paused||e.stop(o[t]._id),e._webAudio||(e._clearSound(o[t]._node),o[t]._node.removeEventListener("error",o[t]._errorFn,!1),o[t]._node.removeEventListener(n._canPlayEvent,o[t]._loadFn,!1),n._releaseHtml5Audio(o[t]._node)),delete o[t]._node,e._clearTimer(o[t]._id);var a=n._howls.indexOf(e);a>=0&&n._howls.splice(a,1);var u=!0;for(t=0;t<n._howls.length;t++)if(n._howls[t]._src===e._src||e._src.indexOf(n._howls[t]._src)>=0){u=!1;break}return r&&u&&delete r[e._src],n.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,n,o,t){var r=this,a=r["_on"+e];return"function"==typeof n&&a.push(t?{id:o,fn:n,once:t}:{id:o,fn:n}),r},off:function(e,n,o){var t=this,r=t["_on"+e],a=0;if("number"==typeof n&&(o=n,n=null),n||o)for(a=0;a<r.length;a++){var u=o===r[a].id;if(n===r[a].fn&&u||!n&&u){r.splice(a,1);break}}else if(e)t["_on"+e]=[];else{var i=Object.keys(t);for(a=0;a<i.length;a++)0===i[a].indexOf("_on")&&Array.isArray(t[i[a]])&&(t[i[a]]=[])}return t},once:function(e,n,o){var t=this;return t.on(e,n,o,1),t},_emit:function(e,n,o){for(var t=this,r=t["_on"+e],a=r.length-1;a>=0;a--)r[a].id&&r[a].id!==n&&"load"!==e||(setTimeout(function(e){e.call(this,n,o)}.bind(t,r[a].fn),0),r[a].once&&t.off(e,r[a].fn,r[a].id));return t._loadQueue(e),t},_loadQueue:function(e){var n=this;if(n._queue.length>0){var o=n._queue[0];o.event===e&&(n._queue.shift(),n._loadQueue()),e||o.action()}return n},_ended:function(e){var o=this,t=e._sprite;if(!o._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(o._ended.bind(o,e),100),o;var r=!(!e._loop&&!o._sprite[t][2]);if(o._emit("end",e._id),!o._webAudio&&r&&o.stop(e._id,!0).play(e._id),o._webAudio&&r){o._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var a=1e3*(e._stop-e._start)/Math.abs(e._rate);o._endTimers[e._id]=setTimeout(o._ended.bind(o,e),a)}return o._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,o._clearTimer(e._id),o._cleanBuffer(e._node),n._autoSuspend()),o._webAudio||r||o.stop(e._id,!0),o},_clearTimer:function(e){var n=this;if(n._endTimers[e]){if("function"!=typeof n._endTimers[e])clearTimeout(n._endTimers[e]);else{var o=n._soundById(e);o&&o._node&&o._node.removeEventListener("ended",n._endTimers[e],!1)}delete n._endTimers[e]}return n},_soundById:function(e){for(var n=this,o=0;o<n._sounds.length;o++)if(e===n._sounds[o]._id)return n._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var n=0;n<e._sounds.length;n++)if(e._sounds[n]._ended)return e._sounds[n].reset();return new t(e)},_drain:function(){var e=this,n=e._pool,o=0,t=0;if(!(e._sounds.length<n)){for(t=0;t<e._sounds.length;t++)e._sounds[t]._ended&&o++;for(t=e._sounds.length-1;t>=0;t--){if(o<=n)return;e._sounds[t]._ended&&(e._webAudio&&e._sounds[t]._node&&e._sounds[t]._node.disconnect(0),e._sounds.splice(t,1),o--)}}},_getSoundIds:function(e){var n=this;if(void 0===e){for(var o=[],t=0;t<n._sounds.length;t++)o.push(n._sounds[t]._id);return o}return[e]},_refreshBuffer:function(e){var o=this;return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=r[o._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,n.ctx.currentTime),o},_cleanBuffer:function(e){var o=this,t=n._navigator&&n._navigator.vendor.indexOf("Apple")>=0;if(n._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=n._scratchBuffer}catch(e){}return e.bufferSource=null,o},_clearSound:function(e){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var t=function(e){this._parent=e,this.init()};t.prototype={init:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,o._sounds.push(e),e.create(),e},create:function(){var e=this,o=e._parent,t=n._muted||e._muted||e._parent._muted?0:e._volume;return o._webAudio?(e._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(t,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):(e._node=n._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._node.src=o._src,e._node.preload="auto",e._node.volume=t*n.volume(),e._node.load()),e},reset:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,o=e._parent;o._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(o._sprite).length&&(o._sprite={__default:[0,1e3*o._duration]}),"loaded"!==o._state&&(o._state="loaded",o._emit("load"),o._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)}};var r={},a=function(e){var n=e._src;if(r[n])return e._duration=r[n].duration,void d(e);if(/^data:[^;]+;base64,/.test(n)){for(var o=atob(n.split(",")[1]),t=new Uint8Array(o.length),a=0;a<o.length;++a)t[a]=o.charCodeAt(a);i(t.buffer,e)}else{var _=new XMLHttpRequest;_.open("GET",n,!0),_.withCredentials=e._xhrWithCredentials,_.responseType="arraybuffer",_.onload=function(){var n=(_.status+"")[0];if("0"!==n&&"2"!==n&&"3"!==n)return void e._emit("loaderror",null,"Failed loading audio file with status: "+_.status+".");i(_.response,e)},_.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[n],e.load())},u(_)}},u=function(e){try{e.send()}catch(n){e.onerror()}},i=function(e,o){var t=function(){o._emit("loaderror",null,"Decoding audio data failed.")},a=function(e){e&&o._sounds.length>0?(r[o._src]=e,d(o,e)):t()};"undefined"!=typeof Promise&&1===n.ctx.decodeAudioData.length?n.ctx.decodeAudioData(e).then(a).catch(t):n.ctx.decodeAudioData(e,a,t)},d=function(e,n){n&&!e._duration&&(e._duration=n.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},_=function(){if(n.usingWebAudio){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}n.ctx||(n.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),o=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),t=o?parseInt(o[1],10):null;if(e&&t&&t<9){var r=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());(n._navigator&&n._navigator.standalone&&!r||n._navigator&&!n._navigator.standalone&&!r)&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:1,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()}};"function"==typeof define&&define.amd&&define([],function(){return{Howler:n,Howl:o}}),"undefined"!=typeof exports&&(exports.Howler=n,exports.Howl=o),"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=n,window.Howl=o,window.Sound=t):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=n,global.Howl=o,global.Sound=t)}();
!function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var t=n._howls.length-1;t>=0;t--)n._howls[t].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,t){var r=this;return r.ctx&&r.ctx.listener?(n="number"!=typeof n?r._pos[1]:n,t="number"!=typeof t?r._pos[2]:t,"number"!=typeof e?r._pos:(r._pos=[e,n,t],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,n,t,r,o,i){var a=this;if(!a.ctx||!a.ctx.listener)return a;var s=a._orientation;return n="number"!=typeof n?s[1]:n,t="number"!=typeof t?s[2]:t,r="number"!=typeof r?s[3]:r,o="number"!=typeof o?s[4]:o,i="number"!=typeof i?s[5]:i,"number"!=typeof e?s:(a._orientation=[e,n,t,r,o,i],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(t,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,n,t,r,o,i),a)},Howl.prototype.init=function(e){return function(n){var t=this;return t._orientation=n.orientation||[1,0,0],t._stereo=n.stereo||null,t._pos=n.pos||null,t._pannerAttr={coneInnerAngle:void 0!==n.coneInnerAngle?n.coneInnerAngle:360,coneOuterAngle:void 0!==n.coneOuterAngle?n.coneOuterAngle:360,coneOuterGain:void 0!==n.coneOuterGain?n.coneOuterGain:0,distanceModel:void 0!==n.distanceModel?n.distanceModel:"inverse",maxDistance:void 0!==n.maxDistance?n.maxDistance:1e4,panningModel:void 0!==n.panningModel?n.panningModel:"HRTF",refDistance:void 0!==n.refDistance?n.refDistance:1,rolloffFactor:void 0!==n.rolloffFactor?n.rolloffFactor:1},t._onstereo=n.onstereo?[{fn:n.onstereo}]:[],t._onpos=n.onpos?[{fn:n.onpos}]:[],t._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(n,t){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(n,t)}}),r;var o=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===t){if("number"!=typeof n)return r._stereo;r._stereo=n,r._pos=[n,0,0]}for(var i=r._getSoundIds(t),a=0;a<i.length;a++){var s=r._soundById(i[a]);if(s){if("number"!=typeof n)return s._stereo;s._stereo=n,s._pos=[n,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||e(s,o),"spatial"===o?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(n,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(n,0,0):s._panner.pan.setValueAtTime(n,Howler.ctx.currentTime)),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(n,t,r,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(n,t,r,o)}}),i;if(t="number"!=typeof t?0:t,r="number"!=typeof r?-.5:r,void 0===o){if("number"!=typeof n)return i._pos;i._pos=[n,t,r]}for(var a=i._getSoundIds(o),s=0;s<a.length;s++){var p=i._soundById(a[s]);if(p){if("number"!=typeof n)return p._pos;p._pos=[n,t,r],p._node&&(p._panner&&!p._panner.pan||e(p,"spatial"),void 0!==p._panner.positionX?(p._panner.positionX.setValueAtTime(n,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(t,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):p._panner.setPosition(n,t,r)),i._emit("pos",p._id)}}return i},Howl.prototype.orientation=function(n,t,r,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(n,t,r,o)}}),i;if(t="number"!=typeof t?i._orientation[1]:t,r="number"!=typeof r?i._orientation[2]:r,void 0===o){if("number"!=typeof n)return i._orientation;i._orientation=[n,t,r]}for(var a=i._getSoundIds(o),s=0;s<a.length;s++){var p=i._soundById(a[s]);if(p){if("number"!=typeof n)return p._orientation;p._orientation=[n,t,r],p._node&&(p._panner||(p._pos||(p._pos=i._pos||[0,0,-.5]),e(p,"spatial")),void 0!==p._panner.orientationX?(p._panner.orientationX.setValueAtTime(n,Howler.ctx.currentTime),p._panner.orientationY.setValueAtTime(t,Howler.ctx.currentTime),p._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):p._panner.setOrientation(n,t,r)),i._emit("orientation",p._id)}}return i},Howl.prototype.pannerAttr=function(){var n,t,r,o=this,i=arguments;if(!o._webAudio)return o;if(0===i.length)return o._pannerAttr;if(1===i.length){if("object"!=typeof i[0])return r=o._soundById(parseInt(i[0],10)),r?r._pannerAttr:o._pannerAttr;n=i[0],void 0===t&&(n.pannerAttr||(n.pannerAttr={coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,distanceModel:n.distanceModel,maxDistance:n.maxDistance,refDistance:n.refDistance,rolloffFactor:n.rolloffFactor,panningModel:n.panningModel}),o._pannerAttr={coneInnerAngle:void 0!==n.pannerAttr.coneInnerAngle?n.pannerAttr.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:void 0!==n.pannerAttr.coneOuterAngle?n.pannerAttr.coneOuterAngle:o._coneOuterAngle,coneOuterGain:void 0!==n.pannerAttr.coneOuterGain?n.pannerAttr.coneOuterGain:o._coneOuterGain,distanceModel:void 0!==n.pannerAttr.distanceModel?n.pannerAttr.distanceModel:o._distanceModel,maxDistance:void 0!==n.pannerAttr.maxDistance?n.pannerAttr.maxDistance:o._maxDistance,refDistance:void 0!==n.pannerAttr.refDistance?n.pannerAttr.refDistance:o._refDistance,rolloffFactor:void 0!==n.pannerAttr.rolloffFactor?n.pannerAttr.rolloffFactor:o._rolloffFactor,panningModel:void 0!==n.pannerAttr.panningModel?n.pannerAttr.panningModel:o._panningModel})}else 2===i.length&&(n=i[0],t=parseInt(i[1],10));for(var a=o._getSoundIds(t),s=0;s<a.length;s++)if(r=o._soundById(a[s])){var p=r._pannerAttr;p={coneInnerAngle:void 0!==n.coneInnerAngle?n.coneInnerAngle:p.coneInnerAngle,coneOuterAngle:void 0!==n.coneOuterAngle?n.coneOuterAngle:p.coneOuterAngle,coneOuterGain:void 0!==n.coneOuterGain?n.coneOuterGain:p.coneOuterGain,distanceModel:void 0!==n.distanceModel?n.distanceModel:p.distanceModel,maxDistance:void 0!==n.maxDistance?n.maxDistance:p.maxDistance,refDistance:void 0!==n.refDistance?n.refDistance:p.refDistance,rolloffFactor:void 0!==n.rolloffFactor?n.rolloffFactor:p.rolloffFactor,panningModel:void 0!==n.panningModel?n.panningModel:p.panningModel};var c=r._panner;c?(c.coneInnerAngle=p.coneInnerAngle,c.coneOuterAngle=p.coneOuterAngle,c.coneOuterGain=p.coneOuterGain,c.distanceModel=p.distanceModel,c.maxDistance=p.maxDistance,c.refDistance=p.refDistance,c.rolloffFactor=p.rolloffFactor,c.panningModel=p.panningModel):(r._pos||(r._pos=o._pos||[0,0,-.5]),e(r,"spatial"))}return o},Sound.prototype.init=function(e){return function(){var n=this,t=n._parent;n._orientation=t._orientation,n._stereo=t._stereo,n._pos=t._pos,n._pannerAttr=t._pannerAttr,e.call(this),n._stereo?t.stereo(n._stereo):n._pos&&t.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var n=this,t=n._parent;return n._orientation=t._orientation,n._stereo=t._stereo,n._pos=t._pos,n._pannerAttr=t._pannerAttr,n._stereo?t.stereo(n._stereo):n._pos?t.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,t._refreshBuffer(n)),e.call(this)}}(Sound.prototype.reset);var e=function(e,n){n=n||"spatial","spatial"===n?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();

/*! 
 * Rangeslider.js v2.3.0
 * https://github.com/andreruffert/rangeslider.js
 * 
 * Copyright (c) 2016 André Ruffert
 * Licensed under MIT 
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";function b(){var a=document.createElement("input");return a.setAttribute("type","range"),"text"!==a.type}function c(a,b){var c=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)}function d(a,b){return b=b||100,function(){if(!a.debouncing){var c=Array.prototype.slice.apply(arguments);a.lastReturnVal=a.apply(window,c),a.debouncing=!0}return clearTimeout(a.debounceTimeout),a.debounceTimeout=setTimeout(function(){a.debouncing=!1},b),a.lastReturnVal}}function e(a){return a&&(0===a.offsetWidth||0===a.offsetHeight||a.open===!1)}function f(a){for(var b=[],c=a.parentNode;e(c);)b.push(c),c=c.parentNode;return b}function g(a,b){function c(a){"undefined"!=typeof a.open&&(a.open=!a.open)}var d=f(a),e=d.length,g=[],h=a[b];if(e){for(var i=0;i<e;i++)g[i]=d[i].style.cssText,d[i].style.setProperty?d[i].style.setProperty("display","block","important"):d[i].style.cssText+=";display: block !important",d[i].style.height="0",d[i].style.overflow="hidden",d[i].style.visibility="hidden",c(d[i]);h=a[b];for(var j=0;j<e;j++)d[j].style.cssText=g[j],c(d[j])}return h}function h(a,b){var c=parseFloat(a);return Number.isNaN(c)?b:c}function i(a){return a.charAt(0).toUpperCase()+a.substr(1)}function j(b,e){if(this.$window=a(window),this.$document=a(document),this.$element=a(b),this.options=a.extend({},n,e),this.polyfill=this.options.polyfill,this.orientation=this.$element[0].getAttribute("data-orientation")||this.options.orientation,this.onInit=this.options.onInit,this.onSlide=this.options.onSlide,this.onSlideEnd=this.options.onSlideEnd,this.DIMENSION=o.orientation[this.orientation].dimension,this.DIRECTION=o.orientation[this.orientation].direction,this.DIRECTION_STYLE=o.orientation[this.orientation].directionStyle,this.COORDINATE=o.orientation[this.orientation].coordinate,this.polyfill&&m)return!1;this.identifier="js-"+k+"-"+l++,this.startEvent=this.options.startEvent.join("."+this.identifier+" ")+"."+this.identifier,this.moveEvent=this.options.moveEvent.join("."+this.identifier+" ")+"."+this.identifier,this.endEvent=this.options.endEvent.join("."+this.identifier+" ")+"."+this.identifier,this.toFixed=(this.step+"").replace(".","").length-1,this.$fill=a('<div class="'+this.options.fillClass+'" />'),this.$handle=a('<div class="'+this.options.handleClass+'" />'),this.$range=a('<div class="'+this.options.rangeClass+" "+this.options[this.orientation+"Class"]+'" id="'+this.identifier+'" />').insertAfter(this.$element).prepend(this.$fill,this.$handle),this.$element.css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"}),this.handleDown=a.proxy(this.handleDown,this),this.handleMove=a.proxy(this.handleMove,this),this.handleEnd=a.proxy(this.handleEnd,this),this.init();var f=this;this.$window.on("resize."+this.identifier,d(function(){c(function(){f.update(!1,!1)},300)},20)),this.$document.on(this.startEvent,"#"+this.identifier+":not(."+this.options.disabledClass+")",this.handleDown),this.$element.on("change."+this.identifier,function(a,b){if(!b||b.origin!==f.identifier){var c=a.target.value,d=f.getPositionFromValue(c);f.setPosition(d)}})}Number.isNaN=Number.isNaN||function(a){return"number"==typeof a&&a!==a};var k="rangeslider",l=0,m=b(),n={polyfill:!0,orientation:"horizontal",rangeClass:"rangeslider",disabledClass:"rangeslider--disabled",activeClass:"rangeslider--active",horizontalClass:"rangeslider--horizontal",verticalClass:"rangeslider--vertical",fillClass:"rangeslider__fill",handleClass:"rangeslider__handle",startEvent:["mousedown","touchstart","pointerdown"],moveEvent:["mousemove","touchmove","pointermove"],endEvent:["mouseup","touchend","pointerup"]},o={orientation:{horizontal:{dimension:"width",direction:"left",directionStyle:"left",coordinate:"x"},vertical:{dimension:"height",direction:"top",directionStyle:"bottom",coordinate:"y"}}};return j.prototype.init=function(){this.update(!0,!1),this.onInit&&"function"==typeof this.onInit&&this.onInit()},j.prototype.update=function(a,b){a=a||!1,a&&(this.min=h(this.$element[0].getAttribute("min"),0),this.max=h(this.$element[0].getAttribute("max"),100),this.value=h(this.$element[0].value,Math.round(this.min+(this.max-this.min)/2)),this.step=h(this.$element[0].getAttribute("step"),1)),this.handleDimension=g(this.$handle[0],"offset"+i(this.DIMENSION)),this.rangeDimension=g(this.$range[0],"offset"+i(this.DIMENSION)),this.maxHandlePos=this.rangeDimension-this.handleDimension,this.grabPos=this.handleDimension/2,this.position=this.getPositionFromValue(this.value),this.$element[0].disabled?this.$range.addClass(this.options.disabledClass):this.$range.removeClass(this.options.disabledClass),this.setPosition(this.position,b)},j.prototype.handleDown=function(a){if(a.preventDefault(),this.$document.on(this.moveEvent,this.handleMove),this.$document.on(this.endEvent,this.handleEnd),this.$range.addClass(this.options.activeClass),!((" "+a.target.className+" ").replace(/[\n\t]/g," ").indexOf(this.options.handleClass)>-1)){var b=this.getRelativePosition(a),c=this.$range[0].getBoundingClientRect()[this.DIRECTION],d=this.getPositionFromNode(this.$handle[0])-c,e="vertical"===this.orientation?this.maxHandlePos-(b-this.grabPos):b-this.grabPos;this.setPosition(e),b>=d&&b<d+this.handleDimension&&(this.grabPos=b-d)}},j.prototype.handleMove=function(a){a.preventDefault();var b=this.getRelativePosition(a),c="vertical"===this.orientation?this.maxHandlePos-(b-this.grabPos):b-this.grabPos;this.setPosition(c)},j.prototype.handleEnd=function(a){a.preventDefault(),this.$document.off(this.moveEvent,this.handleMove),this.$document.off(this.endEvent,this.handleEnd),this.$range.removeClass(this.options.activeClass),this.$element.trigger("change",{origin:this.identifier}),this.onSlideEnd&&"function"==typeof this.onSlideEnd&&this.onSlideEnd(this.position,this.value)},j.prototype.cap=function(a,b,c){return a<b?b:a>c?c:a},j.prototype.setPosition=function(a,b){var c,d;void 0===b&&(b=!0),c=this.getValueFromPosition(this.cap(a,0,this.maxHandlePos)),d=this.getPositionFromValue(c),this.$fill[0].style[this.DIMENSION]=d+this.grabPos+"px",this.$handle[0].style[this.DIRECTION_STYLE]=d+"px",this.setValue(c),this.position=d,this.value=c,b&&this.onSlide&&"function"==typeof this.onSlide&&this.onSlide(d,c)},j.prototype.getPositionFromNode=function(a){for(var b=0;null!==a;)b+=a.offsetLeft,a=a.offsetParent;return b},j.prototype.getRelativePosition=function(a){var b=i(this.COORDINATE),c=this.$range[0].getBoundingClientRect()[this.DIRECTION],d=0;return"undefined"!=typeof a.originalEvent["client"+b]?d=a.originalEvent["client"+b]:a.originalEvent.touches&&a.originalEvent.touches[0]&&"undefined"!=typeof a.originalEvent.touches[0]["client"+b]?d=a.originalEvent.touches[0]["client"+b]:a.currentPoint&&"undefined"!=typeof a.currentPoint[this.COORDINATE]&&(d=a.currentPoint[this.COORDINATE]),d-c},j.prototype.getPositionFromValue=function(a){var b,c;return b=(a-this.min)/(this.max-this.min),c=Number.isNaN(b)?0:b*this.maxHandlePos},j.prototype.getValueFromPosition=function(a){var b,c;return b=a/(this.maxHandlePos||1),c=this.step*Math.round(b*(this.max-this.min)/this.step)+this.min,Number(c.toFixed(this.toFixed))},j.prototype.setValue=function(a){a===this.value&&""!==this.$element[0].value||this.$element.val(a).trigger("input",{origin:this.identifier})},j.prototype.destroy=function(){this.$document.off("."+this.identifier),this.$window.off("."+this.identifier),this.$element.off("."+this.identifier).removeAttr("style").removeData("plugin_"+k),this.$range&&this.$range.length&&this.$range[0].parentNode.removeChild(this.$range[0])},a.fn[k]=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),e=d.data("plugin_"+k);e||d.data("plugin_"+k,e=new j(this,b)),"string"==typeof b&&e[b].apply(e,c)})},"rangeslider.js is available in jQuery context e.g $(selector).rangeslider(options);"});

/*!
 * Screenfull v5.0.2
 * https://github.com/sindresorhus/screenfull.js/
 * 
 * Copyright (c) Sindre Sorhus
 * Licensed under MIT
 */
!function(){"use strict";var u="undefined"!=typeof window&&void 0!==window.document?window.document:{},e="undefined"!=typeof module&&module.exports,c=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,l=n.length,t={};r<l;r++)if((e=n[r])&&e[1]in u){for(r=0;r<e.length;r++)t[n[0][r]]=e[r];return t}return!1}(),l={change:c.fullscreenchange,error:c.fullscreenerror},n={request:function(t){return new Promise(function(e,n){var r=function(){this.off("change",r),e()}.bind(this);this.on("change",r);var l=(t=t||u.documentElement)[c.requestFullscreen]();l instanceof Promise&&l.then(r).catch(n)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var r=function(){this.off("change",r),e()}.bind(this);this.on("change",r);var l=u[c.exitFullscreen]();l instanceof Promise&&l.then(r).catch(n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=l[e];r&&u.addEventListener(r,n,!1)},off:function(e,n){var r=l[e];r&&u.removeEventListener(r,n,!1)},raw:c};c?(Object.defineProperties(n,{isFullscreen:{get:function(){return Boolean(u[c.fullscreenElement])}},element:{enumerable:!0,get:function(){return u[c.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(u[c.fullscreenEnabled])}}}),e?module.exports=n:window.screenfull=n):e?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}();

/*EOF*/